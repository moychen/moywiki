{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to MoyWiki \u00b6 For full documentation visit mkdocs.org . Commands \u00b6 mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit. Project layout \u00b6 mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Home"},{"location":"#welcome-to-moywiki","text":"For full documentation visit mkdocs.org .","title":"Welcome to MoyWiki"},{"location":"#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit.","title":"Commands"},{"location":"#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"about/","text":"MoyWiki \u00b6","title":"About"},{"location":"about/#moywiki","text":"","title":"MoyWiki"},{"location":"CC%2B%2B/MallocInternals/","text":"Malloc Internals \u00b6 Overview of Malloc \u00b6 The GNU C library's (glibc's) malloc library contains a handful of functions that manage allocated memory in the application's address space. The glibc malloc is derived from ptmalloc (pthreads malloc), which is derived from dlmalloc (Doug Lea malloc). This malloc is a \"heap\" style malloc, which means that chunks of various sizes exist within a larger region of memory (a \"heap\") as opposed to, for example, an implementation that uses bitmaps and arrays, or regions of same-sized blocks, etc. In ancient times, there was one heap per application, but glibc's malloc allows for multiple heaps, each of which grows within its address space. Thus, within this document, we refer to some common terms: Arena A structure that is shared among one or more threads which contains references to one or more heaps, as well as linked lists of chunks within those heaps which are \"free\". Threads assigned to each arena will allocate memory from that arena's free lists. Heap A contiguous region of memory that is subdivided into chunks to be allocated. Each heap belongs to exactly one arena. Chunk A small range of memory that can be allocated (owned by the application), freed (owned by glibc), or combined with adjacent chunks into larger ranges. Note that a chunk is a wrapper around the block of memory that is given to the application. Each chunk exists in one heap and belongs to one arena. Memory A portion of the application's address space which is typically backed by RAM or swap. Note that, in this document, we only refer to \"memory\" as a generic term. While there is some code in glibc's malloc to work with the Linux kernel (or other OS) to hint at what memory should be mapped/backed and what can be returned to the kernel, such discrimination between \"real memory\" and \"virtual memory\" is irrelevant to the discussion herein, unless explicitly called out. What is a Chunk? \u00b6 Glibc's malloc is chunk-oriented. It divides a large region of memory (a \"heap\") into chunks of various sizes. Each chunk includes meta-data about how big it is (via a size field in the chunk header), and thus where the adjacent chunks are. When a chunk is in use by the application, the only data that's \"remembered\" is the size of the chunk. When the chunk is free'd, the memory that used to be application data is re-purposed for additional arena-related information, such as pointers within linked lists, such that suitable chunks can quickly be found and re-used when needed. Also, the last word in a free'd chunk contains a copy of the chunk size (with the three LSBs set to zeros, vs the three LSBs of the size at the front of the chunk which are used for flags). Within the malloc library, a \"chunk pointer\" or mchunkptr does not point to the beginning of the chunk, but to the last word in the previous chunk - i.e. the first field in mchunkptr is not valid unless you know the previous chunk is free. Since all chunks are multiples of 8 bytes, the 3 LSBs of the chunk size can be used for flags. These three flags are defined as follows: A (0x04) Allocated Arena - the main arena uses the application's heap. Other arenas use mmap'd heaps. To map a chunk to a heap, you need to know which case applies. If this bit is 0, the chunk comes from the main arena and the main heap. If this bit is 1, the chunk comes from mmap'd memory and the location of the heap can be computed from the chunk's address. M (0x02) MMap'd chunk - this chunk was allocated with a single call to mmap and is not part of a heap at all. P (0x01) Previous chunk is in use - if set, the previous chunk is still being used by the application, and thus the prev_size field is invalid. Note - some chunks, such as those in fastbins (see below) will have this bit set despite being free'd by the application. This bit really means that the previous chunk should not be considered a candidate for coalescing - it's \"in use\" by either the application or some other optimization layered atop malloc's original code In order to ensure that a chunk's payload area is large enough to hold the overhead needed by malloc, the minimum size of a chunk is 4*sizeof(void*) (unless size_t is not the same size as void* ). The minimum size may be larger if the ABI of the platform requires additional alignment. Note that prev_size does not increase the minimum chunk size to 5*sizeof(void*) because when the chunk is small the bk_nextsize pointer is unused, and when the chunk is large enough to use it there is more than enough space at the end. In-use Chunk Free Chunk Note that, since chunks are adjacent to each other in memory, if you know the address of the first chunk (lowest address) in a heap, you can iterate through all the chunks in the heap by using the size information, but only by increasing address, although it may be difficult to detect when you've hit the last chunk in the heap. Allocated heaps are always aligned to a power-of-two address. Thus, when a chunk is in an allocated heap (i.e. the A bit is set), the address of the heap_info for that heap can be computed based on the address of the chunk: Chunk to Heap Arenas and Heaps \u00b6 In order to efficiently handle multi-threaded applications, glibc's malloc allows for more than one region of memory to be active at a time. Thus, different threads can access different regions of memory without interfering with each other. These regions of memory are collectively called \"arenas\". There is one arena, the \"main arena\", that corresponds to the application's initial heap. There's a static variable in the malloc code that points to this arena, and each arena has a next pointer to link additional arenas. As pressure from thread collisions increases, additional arenas are created via mmap to relieve the pressure. The number of arenas is capped at eight times the number of CPUs in the system (unless the user specifies otherwise, see mallopt ), which means a heavily threaded application will still see some contention, but the trade-off is that there will be less fragmentation. Each arena structure has a mutex in it which is used to control access to that arena. Note that some operations, such as access to the fastbins, can be done with atomic operations and do not need to lock the arena. All other operations require that the thread take a lock on the arena. Contention for this mutex is the reason why multiple arenas are created - threads assigned to different arenas need not wait for each other. Threads will automatically switch to unused (unlocked) arenas if contention requires it. Each arena obtains memory from one or more heaps. The main arena uses the program's initial heap (starting right after .bss et al). Additional arenas allocate memory for their heaps via mmap, adding more heaps to their list of heaps as older heaps are used up. Each arena keeps track of a special \"top\" chunk, which is typically the biggest available chunk, and also refers to the most recently allocated heap. Memory for allocated arenas is, conveniently, taken from the initial heap for that arena: Heaps and Arenas Within each arena, chunks are either in use by the application or they're free (available). In-use chunks are not tracked by the arena. Free chunks are stored in various lists based on size and history, so that the library can quickly find suitable chunks to satisfy allocation requests. The lists, called \"bins\", are: Fast Small chunks are stored in size-specific bins. Chunks added to a fast bin (\"fastbin\") are not combined with adjacent chunks - the logic is minimal to keep access fast (hence the name). Chunks in the fastbins may be moved to other bins as needed. Fastbin chunks are stored in a single linked list, since they're all the same size and chunks in the middle of the list need never be accessed. Unsorted When chunks are free'd they're initially stored in a single bin. They're sorted later, in malloc, in order to give them one chance to be quickly re-used. This also means that the sorting logic only needs to exist at one point - everyone else just puts free'd chunks into this bin, and they'll get sorted later. The \"unsorted\" bin is simply the first of the regular bins. Small The normal bins are divided into \"small\" bins, where each chunk is the same size, and \"large\" bins, where chunks are a range of sizes. When a chunk is added to these bins, they're first combined with adjacent chunks to \"coalesce\" them into larger chunks. Thus, these chunks are never adjacent to other such chunks (although they may be adjacent to fast or unsorted chunks, and of course in-use chunks). Small and large chunks are doubly-linked so that chunks may be removed from the middle (such as when they're combined with newly free'd chunks). Large A chunk is \"large\" if its bin may contain more than one size. For small bins, you can pick the first chunk and just use it. For large bins, you have to find the \"best\" chunk, and possibly split it into two chunks (one the size you need, and one for the remainder). Free, Unsorted, Small, and Large Bin Chains Note: in the diagram above (and below), all the pointers are to a \"chunk\" ( mchunkptr ). Since the bins are not chunks (they're arrays of fwd / bck pointers), a hack is used to provide an mchunkptr to a chunk-like object which overlaps the bins \"just right\" so that the mchunkptr 's fwd and bck fields can be used to access the appropriate bin. Because of the need to find the \"best\" fit for large chunks, large chunks have an additional doubly-linked list linking the first of each size in the list, and chunks are sorted by size, largest through smallest. This allows malloc to quickly scan for the first chunk that's big enough. Note: if multiple chunks of a given size are present, the second one is typically the chosen one, so that the next-size linked list need not be adjusted. Chunks inserted into the list are added after a chunk of the same size, for the same reason. Large Bin \"Next Size\" Chains Thread Local Cache (tcache) \u00b6 While this malloc is aware of multiple threads, that's pretty much the extent of its awareness - it knows there are multiple threads. There is no code in this malloc to optimize it for NUMA architectures, coordinate thread locality, sort threads by core, etc. It is assumed that the kernel will handle those issues sufficiently well. Each thread has a thread-local variable that remembers which arena it last used. If that arena is in use when a thread needs to use it the thread will block to wait for the arena to become free. If the thread has never used an arena before then it may try to reuse an unused one, create a new one, or pick the next one on the global list. Each thread has a per-thread cache (called the tcache ) containing a small collection of chunks which can be accessed without needing to lock an arena. These chunks are stored as an array of singly-linked lists, like fastbins, but with links pointing to the payload (user area) not the chunk header. Each bin contains one size chunk, so the array is indexed (indirectly) by chunk size. Unlike fastbins, the tcache is limited in how many chunks are allowed in each bin ( tcache_count ). If the tcache bin is empty for a given requested size, the next larger sized chunk is not used (could cause internal fragmentation), instead the fallback is to use the normal malloc routines i.e. locking the thread's arena and working from there. Per-thread Cache (tcache) Malloc Algorithm \u00b6 In a nutshell, malloc works like this: If there is a suitable (exact match only) chunk in the tcache, it is returned to the caller. No attempt is made to use an available chunk from a larger-sized bin. If the request is large enough, mmap() is used to request memory directly from the operating system. Note that the threshold for mmap'ing is dynamic, unless overridden by M_MMAP_THRESHOLD (see mallopt() documentation), and there may be a limit to how many such mappings there can be at one time. If the appropriate fastbin has a chunk in it, use that. If additional chunks are available, also pre-fill the tcache. If the appropriate smallbin has a chunk in it, use that, possibly pre-filling the tcache here also. If the request is \"large\", take a moment to take everything in the fastbins and move them to the unsorted bin, coalescing them as you go. Start taking chunks off the unsorted list, and moving them to small/large bins, coalescing as you go (note that this is the only place in the code that puts chunks into the small/large bins). If a chunk of the right size is seen, use that. If the request is \"large\", search the appropriate large bin, and successively larger bins, until a large-enough chunk is found. If we still have chunks in the fastbins (this may happen for \"small\" requests), consolidate those and repeat the previous two steps. Split off part of the \"top\" chunk, possibly enlarging \"top\" beforehand. For an over-aligned malloc, such as valloc , pvalloc , or memalign , an overly-large chunk is located (using the malloc algorithm above) and divided into two or more chunks in such a way that most of the chunk is now suitably aligned (and returned to the caller), and the excess before and after that portion is returned to the unsorted list to be re-used later. Free Algorithm \u00b6 Note that, in general, \"freeing\" memory does not actually return it to the operating system for other applications to use. The free() call marks a chunk of memory as \"free to be reused\" by the application, but from the operating system's point of view, the memory still \"belongs\" to the application. However, if the top chunk in a heap - the portion adjacent to unmapped memory - becomes large enough, some of that memory may be unmapped and returned to the operating system. In a nutshell, free works like this: If there is room in the tcache, store the chunk there and return. If the chunk is small enough, place it in the appropriate fastbin. If the chunk was mmap'd, munmap it. See if this chunk is adjacent to another free chunk and coalesce if it is. Place the chunk in the unsorted list, unless it's now the \"top\" chunk. If the chunk is large enough, coalesce any fastbins and see if the top chunk is large enough to give some memory back to the system. Note that this step might be deferred, for performance reasons, and happen during a malloc or other call. Realloc Algorithm \u00b6 Note that realloc of NULL and realloc to zero size are handled separately and as per the relevant specs. In a nutshell, realloc works like this: For MMAP'd chunks... Allocations that are serviced via individual mmap calls (i.e. large ones) are realloc'd by mremap() if available, which may or may not result in the new memory being at a different address than the old memory, depending on what the kernel does. If the system does not support munmap() and the new size is smaller than the old size, nothing happens and the old address is returned, else a malloc-copy-free happens. For arena chunks... If the size of the allocation is being reduced by enough to be \"worth it\", the chunk is split into two chunks. The first half (which has the old address) is returned, and the second half is returned to the arena as a free chunk. Slight reductions are treated as \"the same size\". If the allocation is growing, the next (adjacent) chunk is checked. If it is free, or the \"top\" block (representing the expandable part of the heap), and large enough, then that chunk and the current are merged, producing a large-enough block which can be possibly split (as above). In this case, the old pointer is returned. If the allocation is growing and there's no way to use the existing/following chunk, then a malloc-copy-free sequence is used. Switching arenas \u00b6 The arena to which a thread is attached is generally viewed as an invariant that does not change over the lifetime of the process. This invariant, while useful for explaining general concepts, is not true. The scenario for changing arenas looks like this: Thread fails to allocate memory from the attached arena. Assumes we tried coalescing, searched free list, processed unsorted list etc. Assumes we tried to expand the heap but either the sbrk failed or creating the new mapping failed. If previously using a non-main arena with mmap 'd heaps the thread is switched via arena_get_retry to the main arena with an sbrk -based heap, or switched to non-main arena (from free list or a new one) if previously using the main arena. As an optimization this is not done if the process is single threaded, and we fail at this point returning ENOMEM (it is assumed that if sbrk did not work, and we tried mmap to extend the main arena, that a non-main arena will not work either). Note that a thread may change frequently between arenas in low-memory conditions, switching from main-arena which sbrk -based to a non-main arena which is mmap -based, all in an attempt to find a heap with enough space to satisfy the allocation. Platform-specific Thresholds and Constants \u00b6 These values are provided for entertainment purposes only, and are not guarateed to be correct, but they should have been at one point, at least in general. Parameter 32 bit i386 64 bit MALLOC_ALIGNMENT 8 16 16 MIN_CHUNK_SIZE 16 16 32 MAX_FAST_SIZE 80 80 160 MAX_TCACHE_SIZE 516 1,020 1,032 MIN_LARGE_SIZE 512 1,008 1,024 DEFAULT_MMAP_THRESHOLD 131,072 131,072 131,072 DEFAULT_MMAP_THRESHOLD_MAX 524,288 524,288 33,554,432 HEAP_MIN_SIZE 32,768 32,768 32,768 HEAP_MAX_SIZE 1,048,576 1,048,576 67,108,864 TBD \u00b6 Tunables Remainder of API calls Colophon \u00b6 The images in this document were created with LibreOffice Draw. For each *.svg file, there is a *.odg file which is the source.","title":"Malloc Internals"},{"location":"CC%2B%2B/MallocInternals/#malloc-internals","text":"","title":"Malloc Internals"},{"location":"CC%2B%2B/MallocInternals/#overview-of-malloc","text":"The GNU C library's (glibc's) malloc library contains a handful of functions that manage allocated memory in the application's address space. The glibc malloc is derived from ptmalloc (pthreads malloc), which is derived from dlmalloc (Doug Lea malloc). This malloc is a \"heap\" style malloc, which means that chunks of various sizes exist within a larger region of memory (a \"heap\") as opposed to, for example, an implementation that uses bitmaps and arrays, or regions of same-sized blocks, etc. In ancient times, there was one heap per application, but glibc's malloc allows for multiple heaps, each of which grows within its address space. Thus, within this document, we refer to some common terms: Arena A structure that is shared among one or more threads which contains references to one or more heaps, as well as linked lists of chunks within those heaps which are \"free\". Threads assigned to each arena will allocate memory from that arena's free lists. Heap A contiguous region of memory that is subdivided into chunks to be allocated. Each heap belongs to exactly one arena. Chunk A small range of memory that can be allocated (owned by the application), freed (owned by glibc), or combined with adjacent chunks into larger ranges. Note that a chunk is a wrapper around the block of memory that is given to the application. Each chunk exists in one heap and belongs to one arena. Memory A portion of the application's address space which is typically backed by RAM or swap. Note that, in this document, we only refer to \"memory\" as a generic term. While there is some code in glibc's malloc to work with the Linux kernel (or other OS) to hint at what memory should be mapped/backed and what can be returned to the kernel, such discrimination between \"real memory\" and \"virtual memory\" is irrelevant to the discussion herein, unless explicitly called out.","title":"Overview of Malloc"},{"location":"CC%2B%2B/MallocInternals/#what-is-a-chunk","text":"Glibc's malloc is chunk-oriented. It divides a large region of memory (a \"heap\") into chunks of various sizes. Each chunk includes meta-data about how big it is (via a size field in the chunk header), and thus where the adjacent chunks are. When a chunk is in use by the application, the only data that's \"remembered\" is the size of the chunk. When the chunk is free'd, the memory that used to be application data is re-purposed for additional arena-related information, such as pointers within linked lists, such that suitable chunks can quickly be found and re-used when needed. Also, the last word in a free'd chunk contains a copy of the chunk size (with the three LSBs set to zeros, vs the three LSBs of the size at the front of the chunk which are used for flags). Within the malloc library, a \"chunk pointer\" or mchunkptr does not point to the beginning of the chunk, but to the last word in the previous chunk - i.e. the first field in mchunkptr is not valid unless you know the previous chunk is free. Since all chunks are multiples of 8 bytes, the 3 LSBs of the chunk size can be used for flags. These three flags are defined as follows: A (0x04) Allocated Arena - the main arena uses the application's heap. Other arenas use mmap'd heaps. To map a chunk to a heap, you need to know which case applies. If this bit is 0, the chunk comes from the main arena and the main heap. If this bit is 1, the chunk comes from mmap'd memory and the location of the heap can be computed from the chunk's address. M (0x02) MMap'd chunk - this chunk was allocated with a single call to mmap and is not part of a heap at all. P (0x01) Previous chunk is in use - if set, the previous chunk is still being used by the application, and thus the prev_size field is invalid. Note - some chunks, such as those in fastbins (see below) will have this bit set despite being free'd by the application. This bit really means that the previous chunk should not be considered a candidate for coalescing - it's \"in use\" by either the application or some other optimization layered atop malloc's original code In order to ensure that a chunk's payload area is large enough to hold the overhead needed by malloc, the minimum size of a chunk is 4*sizeof(void*) (unless size_t is not the same size as void* ). The minimum size may be larger if the ABI of the platform requires additional alignment. Note that prev_size does not increase the minimum chunk size to 5*sizeof(void*) because when the chunk is small the bk_nextsize pointer is unused, and when the chunk is large enough to use it there is more than enough space at the end. In-use Chunk Free Chunk Note that, since chunks are adjacent to each other in memory, if you know the address of the first chunk (lowest address) in a heap, you can iterate through all the chunks in the heap by using the size information, but only by increasing address, although it may be difficult to detect when you've hit the last chunk in the heap. Allocated heaps are always aligned to a power-of-two address. Thus, when a chunk is in an allocated heap (i.e. the A bit is set), the address of the heap_info for that heap can be computed based on the address of the chunk: Chunk to Heap","title":"What is a Chunk?"},{"location":"CC%2B%2B/MallocInternals/#arenas-and-heaps","text":"In order to efficiently handle multi-threaded applications, glibc's malloc allows for more than one region of memory to be active at a time. Thus, different threads can access different regions of memory without interfering with each other. These regions of memory are collectively called \"arenas\". There is one arena, the \"main arena\", that corresponds to the application's initial heap. There's a static variable in the malloc code that points to this arena, and each arena has a next pointer to link additional arenas. As pressure from thread collisions increases, additional arenas are created via mmap to relieve the pressure. The number of arenas is capped at eight times the number of CPUs in the system (unless the user specifies otherwise, see mallopt ), which means a heavily threaded application will still see some contention, but the trade-off is that there will be less fragmentation. Each arena structure has a mutex in it which is used to control access to that arena. Note that some operations, such as access to the fastbins, can be done with atomic operations and do not need to lock the arena. All other operations require that the thread take a lock on the arena. Contention for this mutex is the reason why multiple arenas are created - threads assigned to different arenas need not wait for each other. Threads will automatically switch to unused (unlocked) arenas if contention requires it. Each arena obtains memory from one or more heaps. The main arena uses the program's initial heap (starting right after .bss et al). Additional arenas allocate memory for their heaps via mmap, adding more heaps to their list of heaps as older heaps are used up. Each arena keeps track of a special \"top\" chunk, which is typically the biggest available chunk, and also refers to the most recently allocated heap. Memory for allocated arenas is, conveniently, taken from the initial heap for that arena: Heaps and Arenas Within each arena, chunks are either in use by the application or they're free (available). In-use chunks are not tracked by the arena. Free chunks are stored in various lists based on size and history, so that the library can quickly find suitable chunks to satisfy allocation requests. The lists, called \"bins\", are: Fast Small chunks are stored in size-specific bins. Chunks added to a fast bin (\"fastbin\") are not combined with adjacent chunks - the logic is minimal to keep access fast (hence the name). Chunks in the fastbins may be moved to other bins as needed. Fastbin chunks are stored in a single linked list, since they're all the same size and chunks in the middle of the list need never be accessed. Unsorted When chunks are free'd they're initially stored in a single bin. They're sorted later, in malloc, in order to give them one chance to be quickly re-used. This also means that the sorting logic only needs to exist at one point - everyone else just puts free'd chunks into this bin, and they'll get sorted later. The \"unsorted\" bin is simply the first of the regular bins. Small The normal bins are divided into \"small\" bins, where each chunk is the same size, and \"large\" bins, where chunks are a range of sizes. When a chunk is added to these bins, they're first combined with adjacent chunks to \"coalesce\" them into larger chunks. Thus, these chunks are never adjacent to other such chunks (although they may be adjacent to fast or unsorted chunks, and of course in-use chunks). Small and large chunks are doubly-linked so that chunks may be removed from the middle (such as when they're combined with newly free'd chunks). Large A chunk is \"large\" if its bin may contain more than one size. For small bins, you can pick the first chunk and just use it. For large bins, you have to find the \"best\" chunk, and possibly split it into two chunks (one the size you need, and one for the remainder). Free, Unsorted, Small, and Large Bin Chains Note: in the diagram above (and below), all the pointers are to a \"chunk\" ( mchunkptr ). Since the bins are not chunks (they're arrays of fwd / bck pointers), a hack is used to provide an mchunkptr to a chunk-like object which overlaps the bins \"just right\" so that the mchunkptr 's fwd and bck fields can be used to access the appropriate bin. Because of the need to find the \"best\" fit for large chunks, large chunks have an additional doubly-linked list linking the first of each size in the list, and chunks are sorted by size, largest through smallest. This allows malloc to quickly scan for the first chunk that's big enough. Note: if multiple chunks of a given size are present, the second one is typically the chosen one, so that the next-size linked list need not be adjusted. Chunks inserted into the list are added after a chunk of the same size, for the same reason. Large Bin \"Next Size\" Chains","title":"Arenas and Heaps"},{"location":"CC%2B%2B/MallocInternals/#thread-local-cache-tcache","text":"While this malloc is aware of multiple threads, that's pretty much the extent of its awareness - it knows there are multiple threads. There is no code in this malloc to optimize it for NUMA architectures, coordinate thread locality, sort threads by core, etc. It is assumed that the kernel will handle those issues sufficiently well. Each thread has a thread-local variable that remembers which arena it last used. If that arena is in use when a thread needs to use it the thread will block to wait for the arena to become free. If the thread has never used an arena before then it may try to reuse an unused one, create a new one, or pick the next one on the global list. Each thread has a per-thread cache (called the tcache ) containing a small collection of chunks which can be accessed without needing to lock an arena. These chunks are stored as an array of singly-linked lists, like fastbins, but with links pointing to the payload (user area) not the chunk header. Each bin contains one size chunk, so the array is indexed (indirectly) by chunk size. Unlike fastbins, the tcache is limited in how many chunks are allowed in each bin ( tcache_count ). If the tcache bin is empty for a given requested size, the next larger sized chunk is not used (could cause internal fragmentation), instead the fallback is to use the normal malloc routines i.e. locking the thread's arena and working from there. Per-thread Cache (tcache)","title":"Thread Local Cache (tcache)"},{"location":"CC%2B%2B/MallocInternals/#malloc-algorithm","text":"In a nutshell, malloc works like this: If there is a suitable (exact match only) chunk in the tcache, it is returned to the caller. No attempt is made to use an available chunk from a larger-sized bin. If the request is large enough, mmap() is used to request memory directly from the operating system. Note that the threshold for mmap'ing is dynamic, unless overridden by M_MMAP_THRESHOLD (see mallopt() documentation), and there may be a limit to how many such mappings there can be at one time. If the appropriate fastbin has a chunk in it, use that. If additional chunks are available, also pre-fill the tcache. If the appropriate smallbin has a chunk in it, use that, possibly pre-filling the tcache here also. If the request is \"large\", take a moment to take everything in the fastbins and move them to the unsorted bin, coalescing them as you go. Start taking chunks off the unsorted list, and moving them to small/large bins, coalescing as you go (note that this is the only place in the code that puts chunks into the small/large bins). If a chunk of the right size is seen, use that. If the request is \"large\", search the appropriate large bin, and successively larger bins, until a large-enough chunk is found. If we still have chunks in the fastbins (this may happen for \"small\" requests), consolidate those and repeat the previous two steps. Split off part of the \"top\" chunk, possibly enlarging \"top\" beforehand. For an over-aligned malloc, such as valloc , pvalloc , or memalign , an overly-large chunk is located (using the malloc algorithm above) and divided into two or more chunks in such a way that most of the chunk is now suitably aligned (and returned to the caller), and the excess before and after that portion is returned to the unsorted list to be re-used later.","title":"Malloc Algorithm"},{"location":"CC%2B%2B/MallocInternals/#free-algorithm","text":"Note that, in general, \"freeing\" memory does not actually return it to the operating system for other applications to use. The free() call marks a chunk of memory as \"free to be reused\" by the application, but from the operating system's point of view, the memory still \"belongs\" to the application. However, if the top chunk in a heap - the portion adjacent to unmapped memory - becomes large enough, some of that memory may be unmapped and returned to the operating system. In a nutshell, free works like this: If there is room in the tcache, store the chunk there and return. If the chunk is small enough, place it in the appropriate fastbin. If the chunk was mmap'd, munmap it. See if this chunk is adjacent to another free chunk and coalesce if it is. Place the chunk in the unsorted list, unless it's now the \"top\" chunk. If the chunk is large enough, coalesce any fastbins and see if the top chunk is large enough to give some memory back to the system. Note that this step might be deferred, for performance reasons, and happen during a malloc or other call.","title":"Free Algorithm"},{"location":"CC%2B%2B/MallocInternals/#realloc-algorithm","text":"Note that realloc of NULL and realloc to zero size are handled separately and as per the relevant specs. In a nutshell, realloc works like this: For MMAP'd chunks... Allocations that are serviced via individual mmap calls (i.e. large ones) are realloc'd by mremap() if available, which may or may not result in the new memory being at a different address than the old memory, depending on what the kernel does. If the system does not support munmap() and the new size is smaller than the old size, nothing happens and the old address is returned, else a malloc-copy-free happens. For arena chunks... If the size of the allocation is being reduced by enough to be \"worth it\", the chunk is split into two chunks. The first half (which has the old address) is returned, and the second half is returned to the arena as a free chunk. Slight reductions are treated as \"the same size\". If the allocation is growing, the next (adjacent) chunk is checked. If it is free, or the \"top\" block (representing the expandable part of the heap), and large enough, then that chunk and the current are merged, producing a large-enough block which can be possibly split (as above). In this case, the old pointer is returned. If the allocation is growing and there's no way to use the existing/following chunk, then a malloc-copy-free sequence is used.","title":"Realloc Algorithm"},{"location":"CC%2B%2B/MallocInternals/#switching-arenas","text":"The arena to which a thread is attached is generally viewed as an invariant that does not change over the lifetime of the process. This invariant, while useful for explaining general concepts, is not true. The scenario for changing arenas looks like this: Thread fails to allocate memory from the attached arena. Assumes we tried coalescing, searched free list, processed unsorted list etc. Assumes we tried to expand the heap but either the sbrk failed or creating the new mapping failed. If previously using a non-main arena with mmap 'd heaps the thread is switched via arena_get_retry to the main arena with an sbrk -based heap, or switched to non-main arena (from free list or a new one) if previously using the main arena. As an optimization this is not done if the process is single threaded, and we fail at this point returning ENOMEM (it is assumed that if sbrk did not work, and we tried mmap to extend the main arena, that a non-main arena will not work either). Note that a thread may change frequently between arenas in low-memory conditions, switching from main-arena which sbrk -based to a non-main arena which is mmap -based, all in an attempt to find a heap with enough space to satisfy the allocation.","title":"Switching arenas"},{"location":"CC%2B%2B/MallocInternals/#platform-specific-thresholds-and-constants","text":"These values are provided for entertainment purposes only, and are not guarateed to be correct, but they should have been at one point, at least in general. Parameter 32 bit i386 64 bit MALLOC_ALIGNMENT 8 16 16 MIN_CHUNK_SIZE 16 16 32 MAX_FAST_SIZE 80 80 160 MAX_TCACHE_SIZE 516 1,020 1,032 MIN_LARGE_SIZE 512 1,008 1,024 DEFAULT_MMAP_THRESHOLD 131,072 131,072 131,072 DEFAULT_MMAP_THRESHOLD_MAX 524,288 524,288 33,554,432 HEAP_MIN_SIZE 32,768 32,768 32,768 HEAP_MAX_SIZE 1,048,576 1,048,576 67,108,864","title":"Platform-specific Thresholds and Constants"},{"location":"CC%2B%2B/MallocInternals/#tbd","text":"Tunables Remainder of API calls","title":"TBD"},{"location":"CC%2B%2B/MallocInternals/#colophon","text":"The images in this document were created with LibreOffice Draw. For each *.svg file, there is a *.odg file which is the source.","title":"Colophon"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/","text":"Go\u5185\u5b58\u7ba1\u7406 \u00b6 \u5185\u5b58\u5206\u914d \u00b6 \u57fa\u672c\u6982\u5ff5 \u00b6 \u9003\u9038\u5206\u6790 \u00b6 \u5783\u573e\u56de\u6536 \u00b6 gc\u7b97\u6cd5 \u00b6 \u539f\u6587\u5730\u5740\uff1a https://zhuanlan.zhihu.com/p/338200412?utm_source=ZHShareTargetIDMore&utm_medium=social&utm_oi=710816085917569024 \u7a0b\u5e8f\u4e2d\u7528\u7684\u5230\u7684\u6570\u636e\uff0c\u4e00\u5b9a\u662f\u4ece\u6808\u3001\u6570\u636e\u6bb5\u8fd9\u4e9b\u5730\u65b9\u8ffd\u8e2a\u5f97\u5230\u7684\u6570\u636e\u3002\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u4ece\u8fd9\u4e9b\u5730\u65b9\u76f4\u63a5\u8ffd\u8e2a\u5230\u7684\u53d8\u91cf\u4f5c\u4e3a\u6839\u8282\u70b9\uff0c\u53ef\u4ee5\u8ffd\u8e2a\u5230\u6570\u636e\u8303\u56f4\u5927\u4e8e\u7b49\u4e8e\u771f\u6b63\u7684\u6709\u7528\u6570\u636e\u3002\u867d\u7136\u8ffd\u8e2a\u5230\u4e0d\u8868\u793a\u540e\u9762\u4e00\u5b9a\u4f1a\u7528\u5230\uff0c\u4f46\u662f\u8ffd\u8e2a\u4e0d\u5230\u5c31\u4e00\u5b9a\u4e0d\u4f1a\u7528\u5230\uff0c\u5373\u662f\u65e0\u7528\u7684\u5783\u573e\u3002\u6240\u4ee5\u76ee\u524d\u4e3b\u6d41\u7684\u5783\u573e\u56de\u6536\u7b97\u6cd5\uff0c\u90fd\u662f\u4f7f\u7528\u6570\u636e\u201c\u53ef\u8fbe\u6027\u201d\u8fd1\u4f3c\u7b49\u4ef7\u4e8e\u6570\u636e\u6709\u7528\u6027\u7684\u3002 STW\uff08stop the world\uff09 \u6807\u8bb0-\u6e05\u9664 \u00b6 \u6807\u8bb0\u7684\u8fc7\u7a0b\u9700\u8981\u626b\u63cf\u6570\u636e\u6bb5\u548c\u6808\u4e0a\u7684\u6570\u636e\uff0c\u628a\u80fd\u591f\u76f4\u63a5\u8ffd\u8e2a\u5230\u7684\u6570\u636e\u4f5c\u4e3aroot\uff0c\u57fa\u4e8e\u8fd9\u4e9broot\u8fdb\u4e00\u6b65\u8ffd\u8e2a\uff0c\u628a\u80fd\u8ffd\u8e2a\u5230\u7684\u6570\u636e\u90fd\u8fdb\u884c\u6807\u8bb0\uff0c\u90a3\u5269\u4e0b\u7684\u6ca1\u8ffd\u8e2a\u5230\u7684\u5c31\u662f\u5783\u573e\u4e86\u3002 **\u4e09\u8272\u62bd\u8c61**\u53ef\u4ee5\u6e05\u6670\u7684\u5c55\u73b0\u8ffd\u8e2a\u8fc7\u7a0b\u4e2d\u6570\u636e\u6807\u8bb0\u7684\u53d8\u5316\uff1a \uff081\uff09\u5783\u573e\u56de\u6536\u5f00\u59cb\u4f1a\u628a\u6240\u6709\u6570\u636e\u90fd\u6807\u8bb0\u4e3a\u767d\u8272\uff1b \uff082\uff09\u7136\u540e\u628a\u76f4\u63a5\u8ffd\u8e2a\u5230\u7684root\u8282\u70b9\u90fd\u6807\u8bb0\u4e3a\u7070\u8272\uff0c\u7070\u8272\u4ee3\u8868\u57fa\u4e8e\u5f53\u524d\u8282\u70b9\u5c55\u5f00\u7684\u8ffd\u8e2a\u8fd8\u672a\u5b8c\u6210\uff1b \uff083\uff09\u5f53\u57fa\u4e8e\u67d0\u4e2a\u8282\u70b9\u7684\u8ffd\u8e2a\u4efb\u52a1\u5b8c\u6210\u540e\uff0c\u4fbf\u4f1a\u628a\u8be5\u8282\u70b9\u6807\u8bb0\u4e3a\u9ed1\u8272\uff0c\u8868\u793a\u5b83\u662f\u6709\u7528\u6570\u636e\uff0c\u800c\u4e14\u65e0\u9700\u57fa\u4e8e\u5b83\u518d\u6b21\u8fdb\u884c\u8ffd\u8e2a\u4e86\u3002 \uff084\uff09\u5f53\u6ca1\u6709\u7070\u8272\u8282\u70b9\u65f6\uff0c\u5c31\u610f\u5473\u7740\u6807\u8bb0\u5de5\u4f5c\u53ef\u4ee5\u7ed3\u675f\u4e86\u3002\u6b64\u65f6\u6709\u7528\u6570\u636e\u90fd\u4e3a\u9ed1\u8272\uff0c\u5783\u573e\u90fd\u4e3a\u767d\u8272\uff0c\u5728\u6e05\u9664\u9636\u6bb5\u56de\u6536\u8fd9\u4e9b\u767d\u8272\u7684\u5783\u573e\u5373\u53ef\u3002 \u6807\u8bb0\u6e05\u9664\u7b97\u6cd5\u5b9e\u73b0\u8d77\u6765\u76f8\u5bf9\u7b80\u5355\uff0c\u4f46\u662f\u6bd4\u8f83\u5bb9\u6613\u9020\u6210\u5185\u5b58\u788e\u7247\u5316\uff0c\u800c\u788e\u7247\u5316\u4f1a\u5f71\u54cd\u5185\u5b58\u5206\u914d\u4e0e\u7a0b\u5e8f\u6267\u884c\u7684\u6548\u7387\u3002 \u8fd9\u4e00\u95ee\u9898\uff0c\u53ef\u4ee5\u914d\u5408\u76f8\u5e94\u7684\u5185\u5b58\u7ba1\u7406\u6a21\u578b\u6765\u7f13\u89e3\u3002\u4f8b\u5982Tcmalloc\u5185\u5b58\u7ba1\u7406\u6a21\u578b\u8fd9\u6837\uff0c\u628a\u5185\u5b58\u5757\u5206\u6210\u4e0d\u540c\u7684\u89c4\u683c\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\uff0c\u53ef\u4ee5\u5f88\u597d\u7684\u5e94\u5bf9\u788e\u7247\u5316\u95ee\u9898\u3002\u8fd8\u6709\u4eba\u63d0\u51fa\u4e86\u6807\u8bb0\u2014\u2014\u538b\u7f29\uff08\u6574\u7406\uff09\u7b97\u6cd5\u3002 BiBOP\uff08Big back of pages\uff09 \u5f31\u4e09\u8272\u4e0d\u53d8\u5f0f \u5f3a\u4e09\u8272\u4e0d\u53d8\u5f0f \u8bfb\u5199\u5c4f\u969c \u5199\u5c4f\u969c\u4f1a\u5728\u5199\u64cd\u4f5c\u4e2d\u63d2\u5165\u6307\u4ee4\uff0c\u76ee\u7684\u5c31\u662f\u628a\u6570\u636e\u4fee\u6539\u901a\u77e5\u5783\u573e\u56de\u6536\u5668\uff0c\u6240\u4ee5\u5199\u5c4f\u969c\u901a\u5e38\u90fd\u6709\u4e00\u4e2a\u8bb0\u5f55\u96c6\u3002 \u6807\u8bb0-\u538b\u7f29\uff08\u6574\u7406\uff09 \u00b6 \u6807\u8bb0\u2014\u2014\u538b\u7f29\u7b97\u6cd5\u7684\u6807\u8bb0\u9636\u6bb5\u4e0e\u6807\u8bb0\u2014\u2014\u6e05\u9664\u7b97\u6cd5\u76f8\u540c\uff0c\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u4f1a\u5728\u5b8c\u6210\u6807\u8bb0\u5de5\u4f5c\u540e\u5bf9\u5806\u5185\u5b58\u7684\u4f7f\u7528\u8fdb\u884c\u538b\u7f29\u3002\u6240\u8c13\u7684\u538b\u7f29\uff0c\u5c31\u662f\u79fb\u52a8\u975e\u5783\u573e\u6570\u636e\uff0c\u4f7f\u5b83\u4eec\u5c3d\u53ef\u80fd\u7d27\u51d1\u7684\u653e\u5728\u5185\u5b58\u4e2d\u3002 \u867d\u7136\u6807\u8bb0\u2014\u538b\u7f29\u7b97\u6cd5\u6709\u6548\u89e3\u51b3\u4e86\u5185\u5b58\u788e\u7247\u5316\u7684\u95ee\u9898\uff0c\u4f46\u662f\u5e26\u6765\u7684\u591a\u6b21\u626b\u63cf\u4e0e\u79fb\u52a8\u5f00\u9500\u4e5f\u4e0d\u5bb9\u5c0f\u89d1\u3002 \u6807\u8bb0\u2014\u538b\u7f29\u7b97\u6cd5\u6bd4\u8f83\u9c9c\u660e\u7684\u7279\u70b9\u4fbf\u662f\u5b83\u4f1a\u79fb\u52a8\u6570\u636e\u6765\u51cf\u5c11\u788e\u7247\u5316\uff0c\u8fd8\u6709\u4e00\u79cd\u590d\u5236\u5f0f\u56de\u6536\u7b97\u6cd5\uff0c\u4e5f\u4f1a\u79fb\u52a8\u6570\u636e\u3002 \u590d\u5236\u5f0f\u56de\u6536 \u00b6 \uff081\uff09\u590d\u5236\u5f0f\u56de\u6536\u7b97\u6cd5\u4f1a\u628a\u5806\u5185\u5b58\u5212\u5206\u6210\u4e24\u4e2a\u76f8\u7b49\u7684\u7a7a\u95f4\uff0cFrom\u548cTo\u3002\u7a0b\u5e8f\u6267\u884c\u65f6\u4f7f\u7528From\u7a7a\u95f4\uff1b \uff082\uff09\u5783\u573e\u56de\u6536\u6267\u884c\u65f6\u4f1a\u626b\u63cfFrom\u7a7a\u95f4\uff0c\u628a\u80fd\u8ffd\u8e2a\u5230\u7684\u6570\u636e\u590d\u5236\u5230To\u7a7a\u95f4\u3002 \uff083\uff09\u5f53\u6240\u6709\u6709\u7528\u7684\u6570\u636e\u90fd\u590d\u5236\u5230To\u7a7a\u95f4\u540e\uff0c\u628aFrom\u548cTo\u7a7a\u95f4\u7684\u89d2\u8272\u4ea4\u6362\u4e00\u4e0b\u3002\u539f\u6765\u7684To\u7a7a\u95f4\u7528\u4f5cFrom\uff0c\u539f\u6765\u7684From\u7a7a\u95f4\u5219\u53ef\u4ee5\u5168\u90e8\u56de\u6536\u4f5c\u4e3a\u65b0\u7684To\u7a7a\u95f4\u3002 \u6bcf\u4e00\u8f6e\u5783\u573e\u56de\u6536\u90fd\u662f\u5982\u6b64\uff0c\u8fd9\u79cd\u590d\u5236\u5f0f\u56de\u6536\u4e5f\u4e0d\u4f1a\u5e26\u6765\u788e\u7247\u5316\u95ee\u9898\uff0c\u800c\u4e14\u56e0\u7740\u4f7f\u7528\u8fde\u7eed\u7684\u5185\u5b58\u5757\uff0c\u53ef\u4ee5\u5b9e\u73b0\u9ad8\u901f\u7684\u5185\u5b58\u5206\u914d\u3002\u4f46\u662f\u660e\u663e\u7684\u4e0d\u8db3\u4e4b\u5904\u5c31\u662f\u53ea\u6709\u4e00\u534a\u7684\u5806\u5185\u5b58\u53ef\u4ee5\u88ab\u4f7f\u7528\u3002 \u4e3a\u4e86\u63d0\u9ad8\u5806\u5185\u5b58\u7684\u4f7f\u7528\u7387\uff0c\u901a\u5e38\u4f1a\u548c\u5176\u5b83\u5783\u573e\u56de\u6536\u7b97\u6cd5\u642d\u914d\u4f7f\u7528\uff0c\u53ea\u5728\u4e00\u90e8\u5206\u5806\u5185\u5b58\u4e2d\u4f7f\u7528\u590d\u5236\u5f0f\u56de\u6536\u3002\u4f8b\u5982\u5728\u5206\u4ee3\u56de\u6536\u4e2d\u5c31\u7ecf\u5e38\u642d\u914d\u4f7f\u7528\u590d\u5236\u5f0f\u56de\u6536\u3002 \u5206\u4ee3\u5f0f\u56de\u6536 \u00b6 \u5206\u4ee3\u56de\u6536\u7684\u63d0\u51fa\uff0c\u4e3b\u8981\u662f\u57fa\u4e8e\u5f31\u5206\u4ee3\u5047\u8bf4\uff08weak generational hypothesis\uff09\uff1a \u201c**\u5927\u90e8\u5206\u5bf9\u8c61\u90fd\u5728\u5e74\u8f7b\u65f6\u6b7b\u4ea1 \u201d** \u5982\u679c\u6211\u4eec\u628a\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u79f0\u4e3a\u201c\u65b0\u751f\u4ee3\u5bf9\u8c61\u201d\uff0c\u628a\u7ecf\u53d7\u4f4f\u7279\u5b9a\u6b21\u6570\u7684\u5783\u573e\u56de\u6536\u800c\u4f9d\u7136\u5b58\u6d3b\u7684\u5bf9\u8c61\u79f0\u4e3a\u201c\u8001\u5e74\u4ee3\u5bf9\u8c61\u201d\u3002 \u57fa\u4e8e\u5f31\u5206\u4ee3\u5047\u8bf4\uff0c\u65b0\u751f\u4ee3\u5bf9\u8c61\u6210\u4e3a\u5783\u573e\u7684\u6982\u7387\u9ad8\u4e8e\u8001\u5e74\u4ee3\u5bf9\u8c61\uff0c\u6240\u4ee5\u53ef\u4ee5\u628a\u6570\u636e\u5212\u5206\u4e3a\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u964d\u4f4e\u8001\u5e74\u4ee3\u6267\u884c\u5783\u573e\u56de\u6536\u7684\u9891\u7387\u3002 \u5bf9\u4e8e\u6807\u8bb0\u3001\u590d\u5236\u5f0f\u7b49\u8ffd\u8e2a\u7c7b\u56de\u6536\u7b97\u6cd5\u800c\u8a00\uff0c\u4e0d\u7528\u6bcf\u6b21\u90fd\u626b\u63cf\u6240\u6709\u6570\u636e\uff0c\u5c06\u660e\u663e\u63d0\u5347\u5783\u573e\u56de\u6536\u6267\u884c\u7684\u6548\u7387\uff0c\u800c\u4e14\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\u8fd8\u53ef\u4ee5\u5206\u522b\u91c7\u7528\u4e0d\u540c\u7684\u56de\u6536\u7b56\u7565\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u56de\u6536\u6548\u76ca\u5e76\u51cf\u5c11\u5f00\u9500\u3002 \u5206\u4ee3\u56de\u6536\u7b97\u6cd5\u5927\u591a\u901a\u8fc7\u590d\u5236\u5f0f\u56de\u6536\u6765\u5904\u7406\u65b0\u751f\u4ee3\u5bf9\u8c61\uff0c\u53ea\u6709\u7ecf\u5386\u8fc7\u4e00\u5b9a\u6b21\u6570\u7684\u5783\u573e\u56de\u6536\u8fd8\u80fd\u4f9d\u7136\u5b58\u6d3b\u7684\u65b0\u751f\u4ee3\u5bf9\u8c61\u624d\u4f1a\u88ab\u664b\u5347\u4e3a\u8001\u5e74\u4ee3\u5bf9\u8c61\u3002\u867d\u7136\u5206\u4ee3\u56de\u6536\u7b97\u6cd5\u5c06\u56de\u6536\u7684\u6ce8\u610f\u529b\u4e3b\u8981\u96c6\u4e2d\u5728\u65b0\u751f\u4ee3\u5bf9\u8c61\u4e0a\uff0c\u4f46\u662f\u8003\u8651\u5230\u8001\u5e74\u4ee3\u5230\u65b0\u751f\u4ee3\u7684\u5f15\u7528\uff0c\u4e5f\u4f9d\u7136\u505a\u4e0d\u5230\u53ea\u626b\u63cf\u65b0\u751f\u4ee3\u5c31\u628a\u56de\u6536\u5de5\u4f5c\u5b8c\u6210\u7684\u5730\u6b65\u3002 \u5230\u76ee\u524d\u4e3a\u6b62\u6211\u4eec\u4ecb\u7ecd\u7684\u591a\u4e3a\u8ffd\u8e2a\u5f0f\u56de\u6536\uff0c\u90fd\u9700\u8981\u5728\u6267\u884c\u5783\u573e\u56de\u6536\u65f6\u626b\u63cf\u6570\u636e\u8bc6\u522b\u5783\u573e\u5bf9\u8c61\uff0c\u800c\u5f15\u7528\u8ba1\u6570\u5f0f\u5783\u573e\u56de\u6536\u6709\u6240\u4e0d\u540c\u3002 \u5f15\u7528\u8ba1\u6570 \u00b6 \u5f15\u7528\u8ba1\u6570\u6307\u7684\u662f\u4e00\u4e2a\u6570\u636e\u5bf9\u8c61\u88ab\u5f15\u7528\u7684\u6b21\u6570\uff0c\u7a0b\u5e8f\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u66f4\u65b0\u5bf9\u8c61\u53ca\u5176\u5b50\u5bf9\u8c61\u7684\u5f15\u7528\u8ba1\u6570\u3002\u5f53\u5f15\u7528\u8ba1\u6570\u66f4\u65b0\u52300\u65f6\uff0c\u5c31\u8868\u793a\u8fd9\u4e2a\u5bf9\u8c61\u4e0d\u518d\u6709\u7528\uff0c\u53ef\u4ee5\u56de\u6536\u5b83\u5360\u7528\u7684\u5185\u5b58\u4e86\u3002 \u6240\u4ee5\uff0c\u5f15\u7528\u8ba1\u6570\u6cd5\u4e0d\u7528\u4e13\u95e8\u6267\u884c\u626b\u63cf\u4efb\u52a1\uff0c\u56e0\u4e3a\u5783\u573e\u8bc6\u522b\u7684\u4efb\u52a1\u5df2\u7ecf\u5206\u644a\u5230\u6bcf\u4e00\u6b21\u5bf9\u6570\u636e\u5bf9\u8c61\u7684\u64cd\u4f5c\u4e2d\u4e86\u3002 \u8fd9\u6837\u8bf4\u8d77\u6765\u7b80\u5355\uff0c\u4f46\u5b9e\u73b0\u8d77\u6765\u5374\u5e76\u4e0d\u5bb9\u6613\u3002\u867d\u7136\u5f15\u7528\u8ba1\u6570\u6cd5\u53ef\u4ee5\u53ca\u65f6\u56de\u6536\u65e0\u7528\u5185\u5b58\uff0c\u4f46\u662f\u9ad8\u9891\u7387\u7684\u66f4\u65b0\u5f15\u7528\u8ba1\u6570\u4e5f\u4f1a\u9020\u6210\u4e0d\u5c0f\u7684\u5f00\u9500\u3002\u800c\u4e14\u8fd8\u8981\u4e13\u95e8\u60f3\u529e\u6cd5\u8bc6\u522b\u5faa\u73af\u5f15\u7528\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u5faa\u73af\u5f15\u7528\u4f1a\u5bfc\u81f4\u5f15\u7528\u8ba1\u6570\u65e0\u6cd5\u66f4\u65b0\u52300\uff0c\u9020\u6210\u5bf9\u5e94\u7684\u5185\u5b58\u65e0\u6cd5\u88ab\u56de\u6536\u7684\u60c5\u51b5\u3002","title":"Go\u5185\u5b58\u7ba1\u7406"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#go","text":"","title":"Go\u5185\u5b58\u7ba1\u7406"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#_1","text":"","title":"\u5185\u5b58\u5206\u914d"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#_2","text":"","title":"\u57fa\u672c\u6982\u5ff5"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#_3","text":"","title":"\u9003\u9038\u5206\u6790"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#_4","text":"","title":"\u5783\u573e\u56de\u6536"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#gc","text":"\u539f\u6587\u5730\u5740\uff1a https://zhuanlan.zhihu.com/p/338200412?utm_source=ZHShareTargetIDMore&utm_medium=social&utm_oi=710816085917569024 \u7a0b\u5e8f\u4e2d\u7528\u7684\u5230\u7684\u6570\u636e\uff0c\u4e00\u5b9a\u662f\u4ece\u6808\u3001\u6570\u636e\u6bb5\u8fd9\u4e9b\u5730\u65b9\u8ffd\u8e2a\u5f97\u5230\u7684\u6570\u636e\u3002\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u4ece\u8fd9\u4e9b\u5730\u65b9\u76f4\u63a5\u8ffd\u8e2a\u5230\u7684\u53d8\u91cf\u4f5c\u4e3a\u6839\u8282\u70b9\uff0c\u53ef\u4ee5\u8ffd\u8e2a\u5230\u6570\u636e\u8303\u56f4\u5927\u4e8e\u7b49\u4e8e\u771f\u6b63\u7684\u6709\u7528\u6570\u636e\u3002\u867d\u7136\u8ffd\u8e2a\u5230\u4e0d\u8868\u793a\u540e\u9762\u4e00\u5b9a\u4f1a\u7528\u5230\uff0c\u4f46\u662f\u8ffd\u8e2a\u4e0d\u5230\u5c31\u4e00\u5b9a\u4e0d\u4f1a\u7528\u5230\uff0c\u5373\u662f\u65e0\u7528\u7684\u5783\u573e\u3002\u6240\u4ee5\u76ee\u524d\u4e3b\u6d41\u7684\u5783\u573e\u56de\u6536\u7b97\u6cd5\uff0c\u90fd\u662f\u4f7f\u7528\u6570\u636e\u201c\u53ef\u8fbe\u6027\u201d\u8fd1\u4f3c\u7b49\u4ef7\u4e8e\u6570\u636e\u6709\u7528\u6027\u7684\u3002 STW\uff08stop the world\uff09","title":"gc\u7b97\u6cd5"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#-","text":"\u6807\u8bb0\u7684\u8fc7\u7a0b\u9700\u8981\u626b\u63cf\u6570\u636e\u6bb5\u548c\u6808\u4e0a\u7684\u6570\u636e\uff0c\u628a\u80fd\u591f\u76f4\u63a5\u8ffd\u8e2a\u5230\u7684\u6570\u636e\u4f5c\u4e3aroot\uff0c\u57fa\u4e8e\u8fd9\u4e9broot\u8fdb\u4e00\u6b65\u8ffd\u8e2a\uff0c\u628a\u80fd\u8ffd\u8e2a\u5230\u7684\u6570\u636e\u90fd\u8fdb\u884c\u6807\u8bb0\uff0c\u90a3\u5269\u4e0b\u7684\u6ca1\u8ffd\u8e2a\u5230\u7684\u5c31\u662f\u5783\u573e\u4e86\u3002 **\u4e09\u8272\u62bd\u8c61**\u53ef\u4ee5\u6e05\u6670\u7684\u5c55\u73b0\u8ffd\u8e2a\u8fc7\u7a0b\u4e2d\u6570\u636e\u6807\u8bb0\u7684\u53d8\u5316\uff1a \uff081\uff09\u5783\u573e\u56de\u6536\u5f00\u59cb\u4f1a\u628a\u6240\u6709\u6570\u636e\u90fd\u6807\u8bb0\u4e3a\u767d\u8272\uff1b \uff082\uff09\u7136\u540e\u628a\u76f4\u63a5\u8ffd\u8e2a\u5230\u7684root\u8282\u70b9\u90fd\u6807\u8bb0\u4e3a\u7070\u8272\uff0c\u7070\u8272\u4ee3\u8868\u57fa\u4e8e\u5f53\u524d\u8282\u70b9\u5c55\u5f00\u7684\u8ffd\u8e2a\u8fd8\u672a\u5b8c\u6210\uff1b \uff083\uff09\u5f53\u57fa\u4e8e\u67d0\u4e2a\u8282\u70b9\u7684\u8ffd\u8e2a\u4efb\u52a1\u5b8c\u6210\u540e\uff0c\u4fbf\u4f1a\u628a\u8be5\u8282\u70b9\u6807\u8bb0\u4e3a\u9ed1\u8272\uff0c\u8868\u793a\u5b83\u662f\u6709\u7528\u6570\u636e\uff0c\u800c\u4e14\u65e0\u9700\u57fa\u4e8e\u5b83\u518d\u6b21\u8fdb\u884c\u8ffd\u8e2a\u4e86\u3002 \uff084\uff09\u5f53\u6ca1\u6709\u7070\u8272\u8282\u70b9\u65f6\uff0c\u5c31\u610f\u5473\u7740\u6807\u8bb0\u5de5\u4f5c\u53ef\u4ee5\u7ed3\u675f\u4e86\u3002\u6b64\u65f6\u6709\u7528\u6570\u636e\u90fd\u4e3a\u9ed1\u8272\uff0c\u5783\u573e\u90fd\u4e3a\u767d\u8272\uff0c\u5728\u6e05\u9664\u9636\u6bb5\u56de\u6536\u8fd9\u4e9b\u767d\u8272\u7684\u5783\u573e\u5373\u53ef\u3002 \u6807\u8bb0\u6e05\u9664\u7b97\u6cd5\u5b9e\u73b0\u8d77\u6765\u76f8\u5bf9\u7b80\u5355\uff0c\u4f46\u662f\u6bd4\u8f83\u5bb9\u6613\u9020\u6210\u5185\u5b58\u788e\u7247\u5316\uff0c\u800c\u788e\u7247\u5316\u4f1a\u5f71\u54cd\u5185\u5b58\u5206\u914d\u4e0e\u7a0b\u5e8f\u6267\u884c\u7684\u6548\u7387\u3002 \u8fd9\u4e00\u95ee\u9898\uff0c\u53ef\u4ee5\u914d\u5408\u76f8\u5e94\u7684\u5185\u5b58\u7ba1\u7406\u6a21\u578b\u6765\u7f13\u89e3\u3002\u4f8b\u5982Tcmalloc\u5185\u5b58\u7ba1\u7406\u6a21\u578b\u8fd9\u6837\uff0c\u628a\u5185\u5b58\u5757\u5206\u6210\u4e0d\u540c\u7684\u89c4\u683c\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\uff0c\u53ef\u4ee5\u5f88\u597d\u7684\u5e94\u5bf9\u788e\u7247\u5316\u95ee\u9898\u3002\u8fd8\u6709\u4eba\u63d0\u51fa\u4e86\u6807\u8bb0\u2014\u2014\u538b\u7f29\uff08\u6574\u7406\uff09\u7b97\u6cd5\u3002 BiBOP\uff08Big back of pages\uff09 \u5f31\u4e09\u8272\u4e0d\u53d8\u5f0f \u5f3a\u4e09\u8272\u4e0d\u53d8\u5f0f \u8bfb\u5199\u5c4f\u969c \u5199\u5c4f\u969c\u4f1a\u5728\u5199\u64cd\u4f5c\u4e2d\u63d2\u5165\u6307\u4ee4\uff0c\u76ee\u7684\u5c31\u662f\u628a\u6570\u636e\u4fee\u6539\u901a\u77e5\u5783\u573e\u56de\u6536\u5668\uff0c\u6240\u4ee5\u5199\u5c4f\u969c\u901a\u5e38\u90fd\u6709\u4e00\u4e2a\u8bb0\u5f55\u96c6\u3002","title":"\u6807\u8bb0-\u6e05\u9664"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#-_1","text":"\u6807\u8bb0\u2014\u2014\u538b\u7f29\u7b97\u6cd5\u7684\u6807\u8bb0\u9636\u6bb5\u4e0e\u6807\u8bb0\u2014\u2014\u6e05\u9664\u7b97\u6cd5\u76f8\u540c\uff0c\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u4f1a\u5728\u5b8c\u6210\u6807\u8bb0\u5de5\u4f5c\u540e\u5bf9\u5806\u5185\u5b58\u7684\u4f7f\u7528\u8fdb\u884c\u538b\u7f29\u3002\u6240\u8c13\u7684\u538b\u7f29\uff0c\u5c31\u662f\u79fb\u52a8\u975e\u5783\u573e\u6570\u636e\uff0c\u4f7f\u5b83\u4eec\u5c3d\u53ef\u80fd\u7d27\u51d1\u7684\u653e\u5728\u5185\u5b58\u4e2d\u3002 \u867d\u7136\u6807\u8bb0\u2014\u538b\u7f29\u7b97\u6cd5\u6709\u6548\u89e3\u51b3\u4e86\u5185\u5b58\u788e\u7247\u5316\u7684\u95ee\u9898\uff0c\u4f46\u662f\u5e26\u6765\u7684\u591a\u6b21\u626b\u63cf\u4e0e\u79fb\u52a8\u5f00\u9500\u4e5f\u4e0d\u5bb9\u5c0f\u89d1\u3002 \u6807\u8bb0\u2014\u538b\u7f29\u7b97\u6cd5\u6bd4\u8f83\u9c9c\u660e\u7684\u7279\u70b9\u4fbf\u662f\u5b83\u4f1a\u79fb\u52a8\u6570\u636e\u6765\u51cf\u5c11\u788e\u7247\u5316\uff0c\u8fd8\u6709\u4e00\u79cd\u590d\u5236\u5f0f\u56de\u6536\u7b97\u6cd5\uff0c\u4e5f\u4f1a\u79fb\u52a8\u6570\u636e\u3002","title":"\u6807\u8bb0-\u538b\u7f29\uff08\u6574\u7406\uff09"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#_5","text":"\uff081\uff09\u590d\u5236\u5f0f\u56de\u6536\u7b97\u6cd5\u4f1a\u628a\u5806\u5185\u5b58\u5212\u5206\u6210\u4e24\u4e2a\u76f8\u7b49\u7684\u7a7a\u95f4\uff0cFrom\u548cTo\u3002\u7a0b\u5e8f\u6267\u884c\u65f6\u4f7f\u7528From\u7a7a\u95f4\uff1b \uff082\uff09\u5783\u573e\u56de\u6536\u6267\u884c\u65f6\u4f1a\u626b\u63cfFrom\u7a7a\u95f4\uff0c\u628a\u80fd\u8ffd\u8e2a\u5230\u7684\u6570\u636e\u590d\u5236\u5230To\u7a7a\u95f4\u3002 \uff083\uff09\u5f53\u6240\u6709\u6709\u7528\u7684\u6570\u636e\u90fd\u590d\u5236\u5230To\u7a7a\u95f4\u540e\uff0c\u628aFrom\u548cTo\u7a7a\u95f4\u7684\u89d2\u8272\u4ea4\u6362\u4e00\u4e0b\u3002\u539f\u6765\u7684To\u7a7a\u95f4\u7528\u4f5cFrom\uff0c\u539f\u6765\u7684From\u7a7a\u95f4\u5219\u53ef\u4ee5\u5168\u90e8\u56de\u6536\u4f5c\u4e3a\u65b0\u7684To\u7a7a\u95f4\u3002 \u6bcf\u4e00\u8f6e\u5783\u573e\u56de\u6536\u90fd\u662f\u5982\u6b64\uff0c\u8fd9\u79cd\u590d\u5236\u5f0f\u56de\u6536\u4e5f\u4e0d\u4f1a\u5e26\u6765\u788e\u7247\u5316\u95ee\u9898\uff0c\u800c\u4e14\u56e0\u7740\u4f7f\u7528\u8fde\u7eed\u7684\u5185\u5b58\u5757\uff0c\u53ef\u4ee5\u5b9e\u73b0\u9ad8\u901f\u7684\u5185\u5b58\u5206\u914d\u3002\u4f46\u662f\u660e\u663e\u7684\u4e0d\u8db3\u4e4b\u5904\u5c31\u662f\u53ea\u6709\u4e00\u534a\u7684\u5806\u5185\u5b58\u53ef\u4ee5\u88ab\u4f7f\u7528\u3002 \u4e3a\u4e86\u63d0\u9ad8\u5806\u5185\u5b58\u7684\u4f7f\u7528\u7387\uff0c\u901a\u5e38\u4f1a\u548c\u5176\u5b83\u5783\u573e\u56de\u6536\u7b97\u6cd5\u642d\u914d\u4f7f\u7528\uff0c\u53ea\u5728\u4e00\u90e8\u5206\u5806\u5185\u5b58\u4e2d\u4f7f\u7528\u590d\u5236\u5f0f\u56de\u6536\u3002\u4f8b\u5982\u5728\u5206\u4ee3\u56de\u6536\u4e2d\u5c31\u7ecf\u5e38\u642d\u914d\u4f7f\u7528\u590d\u5236\u5f0f\u56de\u6536\u3002","title":"\u590d\u5236\u5f0f\u56de\u6536"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#_6","text":"\u5206\u4ee3\u56de\u6536\u7684\u63d0\u51fa\uff0c\u4e3b\u8981\u662f\u57fa\u4e8e\u5f31\u5206\u4ee3\u5047\u8bf4\uff08weak generational hypothesis\uff09\uff1a \u201c**\u5927\u90e8\u5206\u5bf9\u8c61\u90fd\u5728\u5e74\u8f7b\u65f6\u6b7b\u4ea1 \u201d** \u5982\u679c\u6211\u4eec\u628a\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u79f0\u4e3a\u201c\u65b0\u751f\u4ee3\u5bf9\u8c61\u201d\uff0c\u628a\u7ecf\u53d7\u4f4f\u7279\u5b9a\u6b21\u6570\u7684\u5783\u573e\u56de\u6536\u800c\u4f9d\u7136\u5b58\u6d3b\u7684\u5bf9\u8c61\u79f0\u4e3a\u201c\u8001\u5e74\u4ee3\u5bf9\u8c61\u201d\u3002 \u57fa\u4e8e\u5f31\u5206\u4ee3\u5047\u8bf4\uff0c\u65b0\u751f\u4ee3\u5bf9\u8c61\u6210\u4e3a\u5783\u573e\u7684\u6982\u7387\u9ad8\u4e8e\u8001\u5e74\u4ee3\u5bf9\u8c61\uff0c\u6240\u4ee5\u53ef\u4ee5\u628a\u6570\u636e\u5212\u5206\u4e3a\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u964d\u4f4e\u8001\u5e74\u4ee3\u6267\u884c\u5783\u573e\u56de\u6536\u7684\u9891\u7387\u3002 \u5bf9\u4e8e\u6807\u8bb0\u3001\u590d\u5236\u5f0f\u7b49\u8ffd\u8e2a\u7c7b\u56de\u6536\u7b97\u6cd5\u800c\u8a00\uff0c\u4e0d\u7528\u6bcf\u6b21\u90fd\u626b\u63cf\u6240\u6709\u6570\u636e\uff0c\u5c06\u660e\u663e\u63d0\u5347\u5783\u573e\u56de\u6536\u6267\u884c\u7684\u6548\u7387\uff0c\u800c\u4e14\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\u8fd8\u53ef\u4ee5\u5206\u522b\u91c7\u7528\u4e0d\u540c\u7684\u56de\u6536\u7b56\u7565\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u56de\u6536\u6548\u76ca\u5e76\u51cf\u5c11\u5f00\u9500\u3002 \u5206\u4ee3\u56de\u6536\u7b97\u6cd5\u5927\u591a\u901a\u8fc7\u590d\u5236\u5f0f\u56de\u6536\u6765\u5904\u7406\u65b0\u751f\u4ee3\u5bf9\u8c61\uff0c\u53ea\u6709\u7ecf\u5386\u8fc7\u4e00\u5b9a\u6b21\u6570\u7684\u5783\u573e\u56de\u6536\u8fd8\u80fd\u4f9d\u7136\u5b58\u6d3b\u7684\u65b0\u751f\u4ee3\u5bf9\u8c61\u624d\u4f1a\u88ab\u664b\u5347\u4e3a\u8001\u5e74\u4ee3\u5bf9\u8c61\u3002\u867d\u7136\u5206\u4ee3\u56de\u6536\u7b97\u6cd5\u5c06\u56de\u6536\u7684\u6ce8\u610f\u529b\u4e3b\u8981\u96c6\u4e2d\u5728\u65b0\u751f\u4ee3\u5bf9\u8c61\u4e0a\uff0c\u4f46\u662f\u8003\u8651\u5230\u8001\u5e74\u4ee3\u5230\u65b0\u751f\u4ee3\u7684\u5f15\u7528\uff0c\u4e5f\u4f9d\u7136\u505a\u4e0d\u5230\u53ea\u626b\u63cf\u65b0\u751f\u4ee3\u5c31\u628a\u56de\u6536\u5de5\u4f5c\u5b8c\u6210\u7684\u5730\u6b65\u3002 \u5230\u76ee\u524d\u4e3a\u6b62\u6211\u4eec\u4ecb\u7ecd\u7684\u591a\u4e3a\u8ffd\u8e2a\u5f0f\u56de\u6536\uff0c\u90fd\u9700\u8981\u5728\u6267\u884c\u5783\u573e\u56de\u6536\u65f6\u626b\u63cf\u6570\u636e\u8bc6\u522b\u5783\u573e\u5bf9\u8c61\uff0c\u800c\u5f15\u7528\u8ba1\u6570\u5f0f\u5783\u573e\u56de\u6536\u6709\u6240\u4e0d\u540c\u3002","title":"\u5206\u4ee3\u5f0f\u56de\u6536"},{"location":"Golang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#_7","text":"\u5f15\u7528\u8ba1\u6570\u6307\u7684\u662f\u4e00\u4e2a\u6570\u636e\u5bf9\u8c61\u88ab\u5f15\u7528\u7684\u6b21\u6570\uff0c\u7a0b\u5e8f\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u66f4\u65b0\u5bf9\u8c61\u53ca\u5176\u5b50\u5bf9\u8c61\u7684\u5f15\u7528\u8ba1\u6570\u3002\u5f53\u5f15\u7528\u8ba1\u6570\u66f4\u65b0\u52300\u65f6\uff0c\u5c31\u8868\u793a\u8fd9\u4e2a\u5bf9\u8c61\u4e0d\u518d\u6709\u7528\uff0c\u53ef\u4ee5\u56de\u6536\u5b83\u5360\u7528\u7684\u5185\u5b58\u4e86\u3002 \u6240\u4ee5\uff0c\u5f15\u7528\u8ba1\u6570\u6cd5\u4e0d\u7528\u4e13\u95e8\u6267\u884c\u626b\u63cf\u4efb\u52a1\uff0c\u56e0\u4e3a\u5783\u573e\u8bc6\u522b\u7684\u4efb\u52a1\u5df2\u7ecf\u5206\u644a\u5230\u6bcf\u4e00\u6b21\u5bf9\u6570\u636e\u5bf9\u8c61\u7684\u64cd\u4f5c\u4e2d\u4e86\u3002 \u8fd9\u6837\u8bf4\u8d77\u6765\u7b80\u5355\uff0c\u4f46\u5b9e\u73b0\u8d77\u6765\u5374\u5e76\u4e0d\u5bb9\u6613\u3002\u867d\u7136\u5f15\u7528\u8ba1\u6570\u6cd5\u53ef\u4ee5\u53ca\u65f6\u56de\u6536\u65e0\u7528\u5185\u5b58\uff0c\u4f46\u662f\u9ad8\u9891\u7387\u7684\u66f4\u65b0\u5f15\u7528\u8ba1\u6570\u4e5f\u4f1a\u9020\u6210\u4e0d\u5c0f\u7684\u5f00\u9500\u3002\u800c\u4e14\u8fd8\u8981\u4e13\u95e8\u60f3\u529e\u6cd5\u8bc6\u522b\u5faa\u73af\u5f15\u7528\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u5faa\u73af\u5f15\u7528\u4f1a\u5bfc\u81f4\u5f15\u7528\u8ba1\u6570\u65e0\u6cd5\u66f4\u65b0\u52300\uff0c\u9020\u6210\u5bf9\u5e94\u7684\u5185\u5b58\u65e0\u6cd5\u88ab\u56de\u6536\u7684\u60c5\u51b5\u3002","title":"\u5f15\u7528\u8ba1\u6570"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/","text":"Go\u7a0b\u5e8f\u662f\u5982\u4f55\u542f\u52a8\u7684 \u00b6 \u7406\u89e3\u53ef\u6267\u884c\u6587\u4ef6 \u00b6 \u7a0b\u5e8f\u6784\u5efa\u8fc7\u7a0b \u00b6 $ go build -x go\u6587\u4ef6 # -x \u6253\u5370\u6784\u5efa\u8be6\u7ec6\u8fc7\u7a0b $ go build -x demo.go WORK=/tmp/go-build650300936 mkdir -p $WORK/b001/ cat >$WORK/b001/importcfg << 'EOF' # internal # import config packagefile fmt=/usr/local/go/pkg/linux_amd64/fmt.a packagefile runtime=/usr/local/go/pkg/linux_amd64/runtime.a EOF cd /root/moychen/demo -------------------------------\u7f16\u8bd1----------------------------------- /usr/local/go/pkg/tool/linux_amd64/compile -o $WORK/b001/_pkg_.a -trimpath \"$WORK/b001=>\" -p main -complete -buildid IHvcy5J3sPf6q7qSX-yU/IHvcy5J3sPf6q7qSX-yU -goversion go1.15.2 -D _/root/moychen/demo -importcfg $WORK/b001/importcfg -pack ./demo.go /usr/local/go/pkg/tool/linux_amd64/buildid -w $WORK/b001/_pkg_.a # internal cp $WORK/b001/_pkg_.a /root/.cache/go-build/5d/5d735f650ab1e82b957e556236d1f63ac6f76a8dcd5e347a1f7c98d556a8b37f-d # internal cat >$WORK/b001/importcfg.link << 'EOF' # internal packagefile command-line-arguments=$WORK/b001/_pkg_.a ... packagefile internal/race=/usr/local/go/pkg/linux_amd64/internal/race.a EOF mkdir -p $WORK/b001/exe/ cd . -------------------------------- \u94fe\u63a5---------------------------------- /usr/local/go/pkg/tool/linux_amd64/link -o $WORK/b001/exe/a.out -importcfg $WORK/b001/importcfg.link -buildmode=exe -buildid=VljoluUulGgW80qhU4WS/IHvcy5J3sPf6q7qSX-yU/CUJ3YEw9E6g_F0Y_-2iM/VljoluUulGgW80qhU4WS -extld=gcc $WORK/b001/_pkg_.a /usr/local/go/pkg/tool/linux_amd64/buildid -w $WORK/b001/exe/a.out # internal mv $WORK/b001/exe/a.out demo rm -r $WORK/b001/ \u53ef\u6267\u884c\u6587\u4ef6 \u00b6 \u53ef\u6267\u884c\u6587\u4ef6\u5728\u4e0d\u540c\u5e73\u53f0\u683c\u5f0f\u89c4\u8303\u4e5f\u4e0d\u4e00\u81f4\u3002\u4ee5Linux\u4e0bELF\uff08Executable and Linkable Format\uff09\u4e3a\u4f8b\uff0c\u8be6\u7ec6\u5185\u5bb9\u53c2\u8003 ELF\u89c4\u8303\u53c2\u8003\u6587\u6863 \uff0cELF\u6587\u4ef6\u4e3b\u8981\u7ec4\u6210\u90e8\u5206\u6709\uff1a ELF header Section header Sections \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u901a\u8fc7ELF header\u4e2d\u7684 entry point \u80fd\u591f\u627e\u5230 Go \u8fdb\u7a0b\u7684\u6267\u884c\u5165\u53e3\u3002Linux\u4e0b\u8fd0\u884c\u53ef\u6267\u884c\u6587\u4ef6\u7684\u6b65\u9aa4\u5927\u81f4\u5982\u4e0b\uff1a graph LR; \u89e3\u6790ELF-Header --> \u52a0\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u5185\u5bb9\u81f3\u5185\u5b58 --> \u4eceentry-point\u5f00\u59cb\u6267\u884c\u4ee3\u7801; Go\u8fdb\u7a0b\u7684\u542f\u52a8\u548c\u521d\u59cb\u5316 \u00b6 \u751f\u6210\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u540e\uff0c\u542f\u52a8\u65f6\u8ba1\u7b97\u673a\u901a\u8fc7\u6267\u884c\u4e8c\u8fdb\u5236\u673a\u5668\u7801\u6307\u4ee4\u8fd0\u884c\u7a0b\u5e8f\uff0c\u6bcf\u6267\u884c\u4e00\u6761\u8bed\u53e5pc\u5bc4\u5b58\u5668\u5c31\u6307\u5411\u4e0b\u4e00\u6761\u6307\u4ee4\u3002\u5728 64 \u4f4d\u5e73\u53f0\u4e0a pc \u5bc4\u5b58\u5668 = rip\u3002 // demo.go package main import ( \"fmt\" ) func main () { fmt . Println ( \"hello world\" ) } go build \u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6demo\uff0c\u7136\u540e\u901a\u8fc7readelf -h demo\u627e\u5230\u53ef\u6267\u884c\u6587\u4ef6demo\u7684entry point\u627e\u5230\u7a0b\u5e8f\u5165\u53e3\uff0c\u4f7f\u7528dlv\u8c03\u8bd5\u7a0b\u5e8f\u3002 \u4e2d\u95f4\u7701\u7565\u4e00\u4e0b\u6ca1\u6709\u7528\u7684\u4fe1\u606f\u3002 \u4ece\u4e0a\u56fe\u7684\u7ed3\u679c\u6765\u770bgo\u542f\u52a8\u6d41\u7a0b\u5927\u81f4\u4e3a\uff1a graph TD; _rt0_amd64_linux --> _rt0_amd64 --> runtime.rt0_go; runtime.rt0_go\u4e2d\u4e3b\u8981\u5de5\u4f5c\u6709\uff1a graph LR; argc/argv\u5904\u7406 --> \u5168\u5c40m0/g0\u521d\u59cb\u5316 --> \u83b7\u53d6cpu\u6838\u5fc3\u6570 --> \u521d\u59cb\u5316\u5185\u90e8\u6570\u636e\u7ed3\u6784 --> \u5f00\u59cb\u6267\u884cmain\u51fd\u6570; \u8c03\u5ea6\u7ec4\u4ef6\u4e0e\u8c03\u5ea6\u5faa\u73af \u00b6 G\uff08goroutine\uff09 \uff1a\u2f00\u4e2a\u8ba1\u7b97\u4efb\u52a1\u3002\u7531\u9700\u8981\u6267\u2f8f\u7684\u4ee3\u7801\u548c\u5176\u4e0a\u4e0b\u2f42\u7ec4\u6210\uff0c\u4e0a\u4e0b\u2f42\u5305\u62ec\uff1a\u5f53\u524d\u4ee3\u7801\u4f4d\u7f6e\u3001\u6808\u9876\u3001\u6808\u5e95\u5730\u5740\u3001\u72b6\u6001\u7b49\u3002 M\uff08machine\uff09 \uff1a\u7cfb\u7edf\u7ebf\u7a0b\uff0c\u6267\u2f8f\u5b9e\u4f53\uff0c\u60f3\u8981\u5728 CPU \u4e0a\u6267\u2f8f\u4ee3\u7801\uff0c\u5fc5\u987b\u6709\u7ebf\u7a0b\uff0c\u4e0e C \u8bed\u2f94\u4e2d\u7684\u7ebf\u7a0b\u76f8\u540c\uff0c\u901a\u8fc7\u7cfb\u7edf\u8c03\u2f64 clone \u6765\u521b\u5efa\u3002 P\uff08processor\uff09 \uff1a\u865a\u62df\u5904\u7406\u5668\uff0cM \u5fc5\u987b\u83b7\u5f97 P \u624d\u80fd\u6267\u884c\u4ee3\u7801\uff0c\u5426\u5219\u5fc5\u987b\u9677\u2f0a\u4f11\u7720\uff08\u540e\u53f0\u76d1\u63a7\u7ebf\u7a0b\u9664\u5916\uff09\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5c06\u5176\u7406\u89e3\u4e3a\u2f00\u79cd token\uff0c\u6709\u8fd9\u4e2a token\uff0c\u624d\u6709\u5728\u7269\u7406 CPU \u6838\u5fc3\u4e0a\u6267\u884c\u7684\u6743\u5229\u3002 \u8c03\u5ea6\u6d41\u7a0b \u00b6 Go\u7684\u8c03\u5ea6\u6d41\u7a0b\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u751f\u4ea7-\u6d88\u8d39\u6d41\u7a0b\uff0c\u5f53\u6211\u4eec\u65b0\u589e\u4e00\u4e2ago routine\u7684\u65f6\u5019\u5b9e\u9645\u4e0a\u662f\u5411runtime \u8c03\u5ea6\u7ec4\u4ef6\u4e2d\u65b0\u589e\u4e00\u4e2atask\u3002 \u751f\u4ea7\u8005 \u00b6 \u6d88\u8d39\u8005 \u00b6 M \u6267\u2f8f\u8c03\u5ea6\u5faa\u73af\u65f6\uff0c\u5fc5\u987b\u4e0e\u2f00\u4e2a P \u7ed1\u5b9a Work stealing \u5c31\u662f\u8bf4\u7684 runqsteal -> runqgrab \u8fd9\u4e2a\u6d41\u7a0b \u5904\u7406\u963b\u585e \u00b6 Go\u4e2d\u963b\u585e\u5927\u6982\u6709\u8fd9\u4e48\u51e0\u79cd\u573a\u666f\uff1a channel send/recv sleep select lock \u7f51\u7edcIO \u5f53\u4e0a\u8ff0\u963b\u585e\u573a\u666f\u4e4b\u4e00\u53d1\u751f\u65f6\uff0cGo\u4f1a\u5c06\u8be5goroutine\u6302\u8d77\uff0c\u4e0d\u4f1a\u963b\u585eGo\u7684\u8c03\u5ea6\u6d41\u7a0b\u3002\u6302\u8d77\u6307\u7684\u662f\u8c03\u5ea6\u7ec4\u4ef6\u4f1a\u5c06\u8be5goroutine\u653e\u5165\u7b49\u5f85\u961f\u5217\uff0c\u5f85\u53ef\u6267\u884c\u65f6\uff0c\u5f85ready\u540e\u518d\u7ee7\u7eed\u6267\u884c\uff0c\u4e0d\u4f1a\u5360\u7528\u7ebf\u7a0b\u3002 \u53ef\u62e6\u622a\u7684\u963b\u585e \u00b6 channel send/recv \u00b6 time.Sleep \u00b6 select \u00b6 lock \u00b6 \u7f51\u7edcIO \u00b6 \u4e0d\u53ef\u62e6\u622a\u7684\u963b\u585e \u00b6 cgo syscall \u7cfb\u7edf\u8c03\u7528 \u2ed3\u65f6\u95f4\u8fd0\u2f8f\u9700\u8981\u5265\u79bb P \u6267\u2f8f sysmon \u00b6 sysmon\u662fruntime\u4e2d\u7684system monitor\uff0c\u5177\u6709\u9ad8\u4f18\u5148\u7ea7\uff0c\u5728\u4e13\u6709\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u7ed1\u5b9aP\u3002 checkdead\uff1a\u5e38\u89c1\u8bef\u89e3\u2014\u8fd9\u4e2a\u53ef\u4ee5\u68c0\u67e5\u6b7b\u9501 netpoll\uff1ainject g list to global run queue retake\uff1a\u5982\u679csyscall\u5361\u4e86\u5f88\u4e45\uff0c\u5c31\u628a\u5265\u79bb\uff08handoff p\uff09 \u200b \u5982\u679c\u7528\u6237g\u8fd0\u884c\u5f88\u4e45\uff0c\u90a3\u4e48\u53d1\u4fe1\u53f7SIGURG\u62a2\u5360 \u4e0e\u8c03\u5ea6\u6709\u5173\u7684\u5e38\u89c1\u95ee\u9898 \u00b6","title":"Go\u7a0b\u5e8f\u662f\u5982\u4f55\u542f\u52a8\u7684"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#go","text":"","title":"Go\u7a0b\u5e8f\u662f\u5982\u4f55\u542f\u52a8\u7684"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_1","text":"","title":"\u7406\u89e3\u53ef\u6267\u884c\u6587\u4ef6"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_2","text":"$ go build -x go\u6587\u4ef6 # -x \u6253\u5370\u6784\u5efa\u8be6\u7ec6\u8fc7\u7a0b $ go build -x demo.go WORK=/tmp/go-build650300936 mkdir -p $WORK/b001/ cat >$WORK/b001/importcfg << 'EOF' # internal # import config packagefile fmt=/usr/local/go/pkg/linux_amd64/fmt.a packagefile runtime=/usr/local/go/pkg/linux_amd64/runtime.a EOF cd /root/moychen/demo -------------------------------\u7f16\u8bd1----------------------------------- /usr/local/go/pkg/tool/linux_amd64/compile -o $WORK/b001/_pkg_.a -trimpath \"$WORK/b001=>\" -p main -complete -buildid IHvcy5J3sPf6q7qSX-yU/IHvcy5J3sPf6q7qSX-yU -goversion go1.15.2 -D _/root/moychen/demo -importcfg $WORK/b001/importcfg -pack ./demo.go /usr/local/go/pkg/tool/linux_amd64/buildid -w $WORK/b001/_pkg_.a # internal cp $WORK/b001/_pkg_.a /root/.cache/go-build/5d/5d735f650ab1e82b957e556236d1f63ac6f76a8dcd5e347a1f7c98d556a8b37f-d # internal cat >$WORK/b001/importcfg.link << 'EOF' # internal packagefile command-line-arguments=$WORK/b001/_pkg_.a ... packagefile internal/race=/usr/local/go/pkg/linux_amd64/internal/race.a EOF mkdir -p $WORK/b001/exe/ cd . -------------------------------- \u94fe\u63a5---------------------------------- /usr/local/go/pkg/tool/linux_amd64/link -o $WORK/b001/exe/a.out -importcfg $WORK/b001/importcfg.link -buildmode=exe -buildid=VljoluUulGgW80qhU4WS/IHvcy5J3sPf6q7qSX-yU/CUJ3YEw9E6g_F0Y_-2iM/VljoluUulGgW80qhU4WS -extld=gcc $WORK/b001/_pkg_.a /usr/local/go/pkg/tool/linux_amd64/buildid -w $WORK/b001/exe/a.out # internal mv $WORK/b001/exe/a.out demo rm -r $WORK/b001/","title":"\u7a0b\u5e8f\u6784\u5efa\u8fc7\u7a0b"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_3","text":"\u53ef\u6267\u884c\u6587\u4ef6\u5728\u4e0d\u540c\u5e73\u53f0\u683c\u5f0f\u89c4\u8303\u4e5f\u4e0d\u4e00\u81f4\u3002\u4ee5Linux\u4e0bELF\uff08Executable and Linkable Format\uff09\u4e3a\u4f8b\uff0c\u8be6\u7ec6\u5185\u5bb9\u53c2\u8003 ELF\u89c4\u8303\u53c2\u8003\u6587\u6863 \uff0cELF\u6587\u4ef6\u4e3b\u8981\u7ec4\u6210\u90e8\u5206\u6709\uff1a ELF header Section header Sections \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u901a\u8fc7ELF header\u4e2d\u7684 entry point \u80fd\u591f\u627e\u5230 Go \u8fdb\u7a0b\u7684\u6267\u884c\u5165\u53e3\u3002Linux\u4e0b\u8fd0\u884c\u53ef\u6267\u884c\u6587\u4ef6\u7684\u6b65\u9aa4\u5927\u81f4\u5982\u4e0b\uff1a graph LR; \u89e3\u6790ELF-Header --> \u52a0\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u5185\u5bb9\u81f3\u5185\u5b58 --> \u4eceentry-point\u5f00\u59cb\u6267\u884c\u4ee3\u7801;","title":"\u53ef\u6267\u884c\u6587\u4ef6"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#go_1","text":"\u751f\u6210\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u540e\uff0c\u542f\u52a8\u65f6\u8ba1\u7b97\u673a\u901a\u8fc7\u6267\u884c\u4e8c\u8fdb\u5236\u673a\u5668\u7801\u6307\u4ee4\u8fd0\u884c\u7a0b\u5e8f\uff0c\u6bcf\u6267\u884c\u4e00\u6761\u8bed\u53e5pc\u5bc4\u5b58\u5668\u5c31\u6307\u5411\u4e0b\u4e00\u6761\u6307\u4ee4\u3002\u5728 64 \u4f4d\u5e73\u53f0\u4e0a pc \u5bc4\u5b58\u5668 = rip\u3002 // demo.go package main import ( \"fmt\" ) func main () { fmt . Println ( \"hello world\" ) } go build \u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6demo\uff0c\u7136\u540e\u901a\u8fc7readelf -h demo\u627e\u5230\u53ef\u6267\u884c\u6587\u4ef6demo\u7684entry point\u627e\u5230\u7a0b\u5e8f\u5165\u53e3\uff0c\u4f7f\u7528dlv\u8c03\u8bd5\u7a0b\u5e8f\u3002 \u4e2d\u95f4\u7701\u7565\u4e00\u4e0b\u6ca1\u6709\u7528\u7684\u4fe1\u606f\u3002 \u4ece\u4e0a\u56fe\u7684\u7ed3\u679c\u6765\u770bgo\u542f\u52a8\u6d41\u7a0b\u5927\u81f4\u4e3a\uff1a graph TD; _rt0_amd64_linux --> _rt0_amd64 --> runtime.rt0_go; runtime.rt0_go\u4e2d\u4e3b\u8981\u5de5\u4f5c\u6709\uff1a graph LR; argc/argv\u5904\u7406 --> \u5168\u5c40m0/g0\u521d\u59cb\u5316 --> \u83b7\u53d6cpu\u6838\u5fc3\u6570 --> \u521d\u59cb\u5316\u5185\u90e8\u6570\u636e\u7ed3\u6784 --> \u5f00\u59cb\u6267\u884cmain\u51fd\u6570;","title":"Go\u8fdb\u7a0b\u7684\u542f\u52a8\u548c\u521d\u59cb\u5316"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_4","text":"G\uff08goroutine\uff09 \uff1a\u2f00\u4e2a\u8ba1\u7b97\u4efb\u52a1\u3002\u7531\u9700\u8981\u6267\u2f8f\u7684\u4ee3\u7801\u548c\u5176\u4e0a\u4e0b\u2f42\u7ec4\u6210\uff0c\u4e0a\u4e0b\u2f42\u5305\u62ec\uff1a\u5f53\u524d\u4ee3\u7801\u4f4d\u7f6e\u3001\u6808\u9876\u3001\u6808\u5e95\u5730\u5740\u3001\u72b6\u6001\u7b49\u3002 M\uff08machine\uff09 \uff1a\u7cfb\u7edf\u7ebf\u7a0b\uff0c\u6267\u2f8f\u5b9e\u4f53\uff0c\u60f3\u8981\u5728 CPU \u4e0a\u6267\u2f8f\u4ee3\u7801\uff0c\u5fc5\u987b\u6709\u7ebf\u7a0b\uff0c\u4e0e C \u8bed\u2f94\u4e2d\u7684\u7ebf\u7a0b\u76f8\u540c\uff0c\u901a\u8fc7\u7cfb\u7edf\u8c03\u2f64 clone \u6765\u521b\u5efa\u3002 P\uff08processor\uff09 \uff1a\u865a\u62df\u5904\u7406\u5668\uff0cM \u5fc5\u987b\u83b7\u5f97 P \u624d\u80fd\u6267\u884c\u4ee3\u7801\uff0c\u5426\u5219\u5fc5\u987b\u9677\u2f0a\u4f11\u7720\uff08\u540e\u53f0\u76d1\u63a7\u7ebf\u7a0b\u9664\u5916\uff09\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5c06\u5176\u7406\u89e3\u4e3a\u2f00\u79cd token\uff0c\u6709\u8fd9\u4e2a token\uff0c\u624d\u6709\u5728\u7269\u7406 CPU \u6838\u5fc3\u4e0a\u6267\u884c\u7684\u6743\u5229\u3002","title":"\u8c03\u5ea6\u7ec4\u4ef6\u4e0e\u8c03\u5ea6\u5faa\u73af"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_5","text":"Go\u7684\u8c03\u5ea6\u6d41\u7a0b\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u751f\u4ea7-\u6d88\u8d39\u6d41\u7a0b\uff0c\u5f53\u6211\u4eec\u65b0\u589e\u4e00\u4e2ago routine\u7684\u65f6\u5019\u5b9e\u9645\u4e0a\u662f\u5411runtime \u8c03\u5ea6\u7ec4\u4ef6\u4e2d\u65b0\u589e\u4e00\u4e2atask\u3002","title":"\u8c03\u5ea6\u6d41\u7a0b"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_6","text":"","title":"\u751f\u4ea7\u8005"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_7","text":"M \u6267\u2f8f\u8c03\u5ea6\u5faa\u73af\u65f6\uff0c\u5fc5\u987b\u4e0e\u2f00\u4e2a P \u7ed1\u5b9a Work stealing \u5c31\u662f\u8bf4\u7684 runqsteal -> runqgrab \u8fd9\u4e2a\u6d41\u7a0b","title":"\u6d88\u8d39\u8005"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_8","text":"Go\u4e2d\u963b\u585e\u5927\u6982\u6709\u8fd9\u4e48\u51e0\u79cd\u573a\u666f\uff1a channel send/recv sleep select lock \u7f51\u7edcIO \u5f53\u4e0a\u8ff0\u963b\u585e\u573a\u666f\u4e4b\u4e00\u53d1\u751f\u65f6\uff0cGo\u4f1a\u5c06\u8be5goroutine\u6302\u8d77\uff0c\u4e0d\u4f1a\u963b\u585eGo\u7684\u8c03\u5ea6\u6d41\u7a0b\u3002\u6302\u8d77\u6307\u7684\u662f\u8c03\u5ea6\u7ec4\u4ef6\u4f1a\u5c06\u8be5goroutine\u653e\u5165\u7b49\u5f85\u961f\u5217\uff0c\u5f85\u53ef\u6267\u884c\u65f6\uff0c\u5f85ready\u540e\u518d\u7ee7\u7eed\u6267\u884c\uff0c\u4e0d\u4f1a\u5360\u7528\u7ebf\u7a0b\u3002","title":"\u5904\u7406\u963b\u585e"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_9","text":"","title":"\u53ef\u62e6\u622a\u7684\u963b\u585e"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#channel-sendrecv","text":"","title":"channel send/recv"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#timesleep","text":"","title":"time.Sleep"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#select","text":"","title":"select"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#lock","text":"","title":"lock"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#io","text":"","title":"\u7f51\u7edcIO"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_10","text":"cgo syscall \u7cfb\u7edf\u8c03\u7528 \u2ed3\u65f6\u95f4\u8fd0\u2f8f\u9700\u8981\u5265\u79bb P \u6267\u2f8f","title":"\u4e0d\u53ef\u62e6\u622a\u7684\u963b\u585e"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#sysmon","text":"sysmon\u662fruntime\u4e2d\u7684system monitor\uff0c\u5177\u6709\u9ad8\u4f18\u5148\u7ea7\uff0c\u5728\u4e13\u6709\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u7ed1\u5b9aP\u3002 checkdead\uff1a\u5e38\u89c1\u8bef\u89e3\u2014\u8fd9\u4e2a\u53ef\u4ee5\u68c0\u67e5\u6b7b\u9501 netpoll\uff1ainject g list to global run queue retake\uff1a\u5982\u679csyscall\u5361\u4e86\u5f88\u4e45\uff0c\u5c31\u628a\u5265\u79bb\uff08handoff p\uff09 \u200b \u5982\u679c\u7528\u6237g\u8fd0\u884c\u5f88\u4e45\uff0c\u90a3\u4e48\u53d1\u4fe1\u53f7SIGURG\u62a2\u5360","title":"sysmon"},{"location":"Golang/Go%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84/#_11","text":"","title":"\u4e0e\u8c03\u5ea6\u6709\u5173\u7684\u5e38\u89c1\u95ee\u9898"},{"location":"Golang/Go%E8%AF%AD%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86/","text":"Go\u8bed\u6cd5\u80cc\u540e\u7684\u79d8\u5bc6 \u00b6 \u7f16\u8bd1\u4e0e\u53cd\u7f16\u8bd1 \u00b6 \u7f16\u8bd1\uff08go tool compile\uff09 \u00b6 \u53cd\u7f16\u8bd1\uff08go tool objdump\uff09 \u00b6 \u8bed\u6cd5\u80cc\u540e\u7684\u79d8\u5bc6 \u00b6 go func \u00b6 channel send & recv \u00b6 \u975e\u963b\u585erecv \u00b6 \u51fd\u6570\u8c03\u7528\u89c4\u7ea6 \u00b6","title":"Go\u8bed\u6cd5\u80cc\u540e\u7684\u79d8\u5bc6"},{"location":"Golang/Go%E8%AF%AD%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86/#go","text":"","title":"Go\u8bed\u6cd5\u80cc\u540e\u7684\u79d8\u5bc6"},{"location":"Golang/Go%E8%AF%AD%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86/#_1","text":"","title":"\u7f16\u8bd1\u4e0e\u53cd\u7f16\u8bd1"},{"location":"Golang/Go%E8%AF%AD%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86/#go-tool-compile","text":"","title":"\u7f16\u8bd1\uff08go tool compile\uff09"},{"location":"Golang/Go%E8%AF%AD%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86/#go-tool-objdump","text":"","title":"\u53cd\u7f16\u8bd1\uff08go tool objdump\uff09"},{"location":"Golang/Go%E8%AF%AD%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86/#_2","text":"","title":"\u8bed\u6cd5\u80cc\u540e\u7684\u79d8\u5bc6"},{"location":"Golang/Go%E8%AF%AD%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86/#go-func","text":"","title":"go func"},{"location":"Golang/Go%E8%AF%AD%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86/#channel-send-recv","text":"","title":"channel send &amp; recv"},{"location":"Golang/Go%E8%AF%AD%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86/#recv","text":"","title":"\u975e\u963b\u585erecv"},{"location":"Golang/Go%E8%AF%AD%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86/#_3","text":"","title":"\u51fd\u6570\u8c03\u7528\u89c4\u7ea6"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/","text":"Go\u8bed\u8a00\u8c03\u8bd5 \u00b6 delve (dlv) \u00b6 dlv\u7b80\u4ecb \u00b6 Delve\u662f\u4e00\u4e2a\u7528\u4e8eGo\u7a0b\u5e8f\u7684\u6e90\u7801\u7ea7\u8c03\u8bd5\u5668\u3002Delve\u4f7f\u4f60\u80fd\u591f\u901a\u8fc7\u63a7\u5236\u7a0b\u5e8f\u7684\u6267\u884c\u3001\u8bc4\u4f30\u53d8\u91cf\u4ee5\u53ca\u63d0\u4f9b\u7ebf\u7a0b/ goroutine \u72b6\u6001\u3001CPU\u5bc4\u5b58\u5668\u72b6\u6001\u7b49\u4fe1\u606f\u4e0e\u4f60\u7684\u7a0b\u5e8f\u8fdb\u884c\u4ea4\u4e92\u3002 \u8c03\u8bd5\u65f6\u53ef\u4ee5\u4f7f\u7528 -- \u5411\u4f60\u8c03\u8bd5\u7684\u7a0b\u5e8f\u4f20\u9012\u53ef\u9009\u6807\u8bc6\uff0c\u4f8b\u5982\uff1a $ dlv exec ./hello -- server --config conf/config.toml \u53ef\u7528\u547d\u4ee4 dlv attach - \u9644\u52a0\u5230\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u5e76\u5f00\u59cb\u8c03\u8bd5\u3002 dlv connect - \u8fde\u63a5\u81f3 headless debug server \u3002 dlv core - \u68c0\u67e5coredump\u6587\u4ef6\u3002 dlv dap - [\u5b9e\u9a8c]\u542f\u52a8\u4e00\u4e2aTCP\u670d\u52a1\u5668\u5e76\u901a\u8fc7DAP\u534f\u8bae\uff08Debug Adaptor Protocol\uff09\u901a\u4fe1\u3002 dlv debug - \u7f16\u8bd1\u5e76\u5f00\u59cb\u8c03\u5f53\u524d\u76ee\u5f55\u4e0b\u7684main\u5305\u6216\u6307\u5b9a\u7684\u5305\u3002 dlv exec - \u6267\u884c\u53ef\u6267\u884c\u6587\u4ef6\u5e76\u5f00\u59cb\u8c03\u8bd5\u3002 dlv replay - \u56de\u653e\u4e00\u4e2arr\u8ddf\u8e2a\u3002 dlv run - \u5e9f\u5f03\u7684\u547d\u4ee4\uff0c\u4f7f\u7528 debug \u4ee3\u66ff\u3002 dlv test - \u7f16\u8bd1\u6d4b\u8bd5\u4e8c\u8fdb\u5236\u6587\u4ef6\u5e76\u5f00\u59cb\u8c03\u8bd5\u7a0b\u5e8f\u3002 dlv trace - \u7f16\u8bd1\u5e76\u5f00\u59cb\u8ffd\u8e2a\u7a0b\u5e8f\u3002 dlv version - \u6253\u5370\u7248\u672c\u3002 dlv log - Help about logging flags dlv backend - Help about the --backend flag dlv redirect - Help about file redirection \u4f7f\u7528\u201c dlv [command] --help \u201d\u67e5\u627e\u5173\u4e8e\u8fd9\u4e2a\u547d\u4ee4\u66f4\u591a\u7684\u4fe1\u606f\u3002 \u5168\u5c40\u9009\u9879 --accept-multiclient \u5141\u8bb8\u4e00\u4e2aheadless server\u652f\u6301\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5 --allow-non-terminal-interactive \u5141\u8bb8\u6ca1\u6709\u7ec8\u7aef\u7684Delve\u7684\u4ea4\u4e92\u5f0f\u4f1a\u8bdd\u4f5c\u4e3astdin\u3001stdout\u548cstderr\u3002 --api-version int \u9009\u62e9headless\u65f6\u7684API\u7248\u672c\u3002\u65b0\u5ba2\u6237\u7aef\u5e94\u8be5\u4f7f\u7528v2\u3002\u53ef\u4ee5\u901a\u8fc7RPCServer.SetApiVersion\u91cd\u7f6e\u3002\u53c2\u89c1Documentation/api/json-rpc/README.md\u3002(\u9ed8\u8ba4\u4e3a1) --backend string \u9009\u62e9\u540e\u7aef (see 'dlv help backend'). (default \"default\") --build-flags string \u4f20\u7ed9\u7f16\u8bd1\u5668\u6784\u5efa\u6807\u5fd7\uff0c\u4f8b\u5982: --build-flags=\"-tags=integration -mod=vendor -cover -v\" --check-go-version \u68c0\u67e5\u6b63\u5728\u4f7f\u7528\u7684Go\u7684\u7248\u672c\u662f\u5426\u4e0eDelve\u517c\u5bb9\u3002(\u9ed8\u8ba4\u4e3atrue) --disable-aslr \u7981\u7528\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316\uff08Address Space Layout Randomization\uff09 --headless \u53ea\u8fd0\u884c\u8c03\u8bd5\u670d\u52a1\u5668\uff0c\u5728headless\u6a21\u5f0f\u4e0b --init string \u542f\u52a8\u6587\u4ef6\uff0c\u7531\u7ec8\u7aef\u5ba2\u6237\u7aef\u6267\u884c -l, --listen string \u8c03\u8bd5\u670d\u52a1\u5668\u76d1\u542c\u5730\u5740(\u9ed8\u8ba4\u4e3a \"127.0.0.1:0\") --log \u542f\u7528\u8c03\u8bd5\u670d\u52a1\u5668\u65e5\u5fd7 --log-dest string \u5c06\u65e5\u5fd7\u5199\u5230\u6307\u5b9a\u7684\u6587\u4ef6\u6216\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e2d\uff08\u89c1'dlv help log'\uff09 --log-output string \u8bbe\u7f6e\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\u7684\u7ec4\u4ef6\uff0c\u7528\u9017\u53f7\u5206\u9694\uff08\u89c1\u2019dlv help log\u2018\uff09 --only-same-user \u53ea\u5141\u8bb8\u6765\u81ea\u542f\u52a8\u6b64Delve\u5b9e\u4f8b\u7684\u540c\u4e00\u7528\u6237\u7684\u8fde\u63a5(\u9ed8\u8ba4\u4e3atrue) -r, --redirect stringArray \u4e3a\u76ee\u6807\u8fdb\u7a0b\u6307\u5b9a\u91cd\u5b9a\u5411\u89c4\u5219\uff08\u89c1'dlv help redirect'\uff09 --wd string \u8fd0\u884c\u8be5\u7a0b\u5e8f\u7684\u5de5\u4f5c\u76ee\u5f55 dlv attach \u00b6 \u8fd9\u4e2a\u547d\u4ee4\u5c06\u4f7fDelve\u63a7\u5236\u4e00\u4e2a\u5df2\u7ecf\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5e76\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u4f1a\u8bdd\u3002\u5f53\u9000\u51fa\u8c03\u8bd5\u4f1a\u8bdd\u65f6\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u8ba9\u8be5\u8fdb\u7a0b\u7ee7\u7eed\u8fd0\u884c\u6216\u6740\u6b7b\u5b83\u3002 dlv attach pid [executable] \u9009\u9879 --continue \u5728\u542f\u52a8\u65f6\u7ee7\u7eed\u8fdb\u884c\u8c03\u8bd5\u8fdb\u7a0b dlv exec \u00b6 \u8fd9\u4e2a\u547d\u4ee4\u5c06\u4f7fDelve\u6267\u884c\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u7acb\u5373\u9644\u52a0\u5230\u8fdb\u7a0b\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u4f1a\u8bdd\u3002\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u4e8c\u8fdb\u5236\u6587\u4ef6\u5728\u7f16\u8bd1\u65f6\u6ca1\u6709\u7981\u7528\u4f18\u5316\u529f\u80fd\uff0c\u53ef\u80fd\u5f88\u96be\u6b63\u786e\u5730\u8c03\u8bd5\u5b83\u3002\u8bf7\u8003\u8651\u5728Go 1.10\u6216\u66f4\u9ad8\u7248\u672c\u4e0a\u7528-gcflags=\"all=-N -l \"\u7f16\u8bd1\u8c03\u8bd5\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5728Go\u7684\u65e9\u671f\u7248\u672c\u4e0a\u7528-gcflags=\"-N -l\"\u3002 dlv exec <path/to/binary> \u9009\u9879 --continue \u5728\u542f\u52a8\u65f6\u7ee7\u7eed\u8fdb\u884c\u8c03\u8bd5\u8fdb\u7a0b --tty string \u6307\u5b9a\u76ee\u6807\u7a0b\u5e8f\u8981\u4f7f\u7528\u7684tty dlv debug \u00b6 \u5728\u7981\u7528\u4f18\u5316\u7684\u60c5\u51b5\u4e0b\u7f16\u8bd1\u4f60\u7684\u7a0b\u5e8f\uff0c\u542f\u52a8\u5e76\u9644\u52a0\u5230\u5b83\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u6ca1\u6709\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\uff0cDelve\u5c06\u7f16\u8bd1\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 \"main \"\u5305\uff0c\u5e76\u5f00\u59cb\u8c03\u8bd5\u5b83\u3002\u6216\u8005\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u5305\u7684\u540d\u5b57\uff0cDelve\u5c06\u7f16\u8bd1\u8be5\u5305\uff0c\u5e76\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u4f1a\u8bdd\u3002 dlv debug [package] \u9009\u9879 --continue \u5728\u542f\u52a8\u65f6\u7ee7\u7eed\u8fdb\u884c\u8c03\u8bd5\u8fdb\u7a0b --output string \u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84(default \"./__debug_bin\") --tty string \u6307\u5b9a\u76ee\u6807\u7a0b\u5e8f\u8981\u4f7f\u7528\u7684tty dlv test \u00b6 \u7f16\u8bd1\u4e00\u4e2a\u7981\u7528\u4f18\u5316\u7684\u6d4b\u8bd5\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u4f1a\u8bdd\u3002 test\u547d\u4ee4\u5141\u8bb8\u4f60\u5728\u5355\u5143\u6d4b\u8bd5\u7684\u80cc\u666f\u4e0b\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u4f1a\u8bdd\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cDelve\u5c06\u8c03\u8bd5\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6d4b\u8bd5\u7a0b\u5e8f\u3002\u53e6\u5916\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u5305\u7684\u540d\u79f0\uff0cDelve\u5c06\u5728\u8be5\u5305\u4e2d\u8c03\u8bd5\u6d4b\u8bd5\u7a0b\u5e8f\u3002\u53cc\u7834\u6298\u53f7 -- \u53ef\u4ee5\u7528\u6765\u4f20\u9012\u53c2\u6570\u7ed9\u6d4b\u8bd5\u7a0b\u5e8f\u3002 dlv test [package] -- -test.v -other-argument \u53e6\u89c1\uff1a\u201cgo help testflag\u201d\u3002 dlv test [package] \u9009\u9879 --output string \u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84(default \"debug.test\") \u5f00\u59cb\u4f7f\u7528 \u00b6 \u8c03\u8bd5main\u5305 \u00b6 \u6211\u4eec\u8981\u63a2\u8ba8\u7684\u7b2c\u4e00\u4e2aCLI\u5b50\u547d\u4ee4\u662f debug \u3002\u5982\u679c\u4f60\u548c\u4f60\u7684`main'\u5305\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\u4e0b\uff0c\u8fd9\u4e2a\u5b50\u547d\u4ee4\u53ef\u4ee5\u4e0d\u9700\u8981\u53c2\u6570\u8fd0\u884c\u3002 \u5426\u5219\uff0c\u5b83\u9700\u8981\u6307\u5b9a\u5305\u7684\u8def\u5f84\u3002\u4f8b\u5982\uff0c\u57fa\u4e8e\u4e0b\u9762\u8fd9\u4e2a\u9879\u76ee\u7684\u5e03\u5c40\uff1a . \u251c\u2500\u2500 github.com/me/foo \u251c\u2500\u2500 cmd \u2502 \u2514\u2500\u2500 foo \u2502 \u2514\u2500\u2500 main.go \u251c\u2500\u2500 pkg \u2502 \u2514\u2500\u2500 baz \u2502 \u251c\u2500\u2500 bar.go \u2502 \u2514\u2500\u2500 bar_test.go \u5982\u679c\u4f60\u5f53\u524d\u662f\u5728\u76ee\u5f55 github.com/me/foo/cmd/foo \u4e2d\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728\u547d\u4ee4\u884c\u6267\u884c dlv debug \u3002\u5728\u5176\u4ed6\u4efb\u4f55\u4f4d\u7f6e\uff0c\u6bd4\u5982\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u4f60\u9700\u8981\u63d0\u4f9b\u5305\u540d\uff1a dlv debug github.com/me/foo/cmd/foo \u3002\u8981\u5411\u4f60\u7684\u7a0b\u5e8f\u4f20\u9012\u6807\u5fd7\u7528 -- \u5206\u5f00\uff1a dlv debug github.com/me/foo/cmd/foo -- --arg1 value \u3002 \u8c03\u7528\u8be5\u547d\u4ee4\u5c06\u4f7fDelve\u4ee5\u6700\u9002\u5408\u8c03\u8bd5\u7684\u65b9\u5f0f\u7f16\u8bd1\u7a0b\u5e8f\u3002\u7136\u540e\uff0c\u5b83\u5c06\u6267\u884c\u5e76\u9644\u52a0\u5230\u7a0b\u5e8f\u4e0a\uff0c\u5e76\u5f00\u59cb\u4e00\u4e2a\u8c03\u8bd5\u4f1a\u8bdd\u3002\u73b0\u5728\uff0c\u5f53\u8c03\u8bd5\u4f1a\u8bdd\u5f00\u59cb\u65f6\uff0c\u4f60\u5c31\u5904\u4e8e\u7a0b\u5e8f\u521d\u59cb\u5316\u7684\u6700\u5f00\u59cb\u3002\u4e3a\u4e86\u8fdb\u5165\u4e00\u4e2a\u66f4\u6709\u7528\u7684\u5730\u65b9\u4f60\u4f1a\u60f3\u8bbe\u7f6e\u4e00\u4e2a\u6216\u4e24\u4e2a\u65ad\u70b9\uff0c\u7136\u540e\u7ee7\u7eed\u6267\u884c\u5230\u8be5\u65ad\u70b9\u3002 \u4f8b\u5982\uff0c\u7ee7\u7eed\u6267\u884c\u5230\u4f60\u7684\u7a0b\u5e8f\u7684 main \u51fd\u6570\u3002 $ dlv debug github.com/me/foo/cmd/foo Type 'help' for list of commands. ( dlv ) break main.main Breakpoint 1 set at 0x49ecf3 for main.main () ./test.go:5 ( dlv ) continue > main.main () ./test.go:5 ( hits goroutine ( 1 ) :1 total:1 ) ( PC: 0x49ecf3 ) 1 : package main 2 : 3 : import \"fmt\" 4 : = > 5 : func main () { 6 : fmt.Println ( \"delve test\" ) 7 : } ( dlv ) \u8c03\u8bd5\u6d4b\u8bd5\u7a0b\u5e8f \u00b6 \u8003\u8651\u5230\u4e0e\u4e0a\u9762\u76f8\u540c\u7684\u76ee\u5f55\u7ed3\u6784\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u4f60\u7684\u6d4b\u8bd5\u5957\u4ef6\u6765\u8c03\u8bd5\u4f60\u7684\u4ee3\u7801\u3002\u4e3a\u6b64\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 dlv test \u5b50\u547d\u4ee4\uff0c\u5b83\u9700\u8981\u4e0e dlv debug \u4e00\u6837\u7684\u53ef\u9009\u5305\u8def\u5f84\uff0c\u5982\u679c\u4e0d\u4f20\u9012\u4efb\u4f55\u53c2\u6570\uff0c\u5219\u4f1a\u6784\u5efa\u5f53\u524d\u76ee\u5f55\u7684\u5305\u3002 $ dlv test github.com/me/foo/pkg/baz Type 'help' for list of commands. ( dlv ) funcs test.Test* /home/me/go/src/github.com/me/foo/pkg/baz/test.TestHi ( dlv ) break TestHi Breakpoint 1 set at 0x536513 for /home/me/go/src/github.com/me/foo/pkg/baz/test.TestHi () ./test_test.go:5 ( dlv ) continue > /home/me/go/src/github.com/me/foo/pkg/baz/test.TestHi () ./bar_test.go:5 ( hits goroutine ( 5 ) :1 total:1 ) ( PC: 0x536513 ) 1 : package baz 2 : 3 : import \"testing\" 4 : = > 5 : func TestHi ( t *testing.T ) { 6 : t.Fatal ( \"implement me!\" ) 7 : } ( dlv ) \u6b63\u5982\u4f60\u6240\u770b\u5230\u7684\uff0c\u6211\u4eec\u5f00\u59cb\u8c03\u8bd5\u6d4b\u8bd5\u4e8c\u8fdb\u5236\uff0c\u901a\u8fc7 funcs \u547d\u4ee4\u627e\u5230\u6211\u4eec\u7684\u6d4b\u8bd5\u51fd\u6570\u3002 funcs \u547d\u4ee4\u627e\u5230\u4e86\u6211\u4eec\u7684\u6d4b\u8bd5\u51fd\u6570\uff0c\u8be5\u547d\u4ee4\u4f7f\u7528\u4e00\u4e2aregexp\u6765\u8fc7\u6ee4\u51fd\u6570\u5217\u8868\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u65ad\u70b9\uff0c\u7136\u540e\u7ee7\u7eed\u6267\u884c\uff0c\u76f4\u5230\u6211\u4eec\u547d\u4e2d\u8fd9\u4e2a\u65ad\u70b9\u3002 \u53ef\u4ee5\u4f7f\u7528 dlv help \u83b7\u53d6\u66f4\u591a\u5173\u4e8e\u5b50\u547d\u4ee4\u7684\u4fe1\u606f\uff0c\u4e00\u65e6\u8fdb\u5165\u8c03\u8bd5\u4f1a\u8bdd\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u952e\u5165 help \u770b\u5230\u6240\u6709\u53ef\u7528\u7684\u547d\u4ee4\u3002 \u5c31\u53ef\u4ee5\u770b\u5230\u6240\u6709\u53ef\u7528\u7684\u547d\u4ee4\u3002 \u8c03\u8bd5\u7f16\u8bd1\u5668 \u00b6 \u914d\u7f6e\u548c\u5386\u53f2\u547d\u4ee4 \u00b6 \u5982\u679c $XDG_CONFIG_HOME \u88ab\u8bbe\u7f6e\uff0c\u90a3\u4e48\u914d\u7f6e\u548c\u547d\u4ee4\u5386\u53f2\u6587\u4ef6\u5c31\u4f4d\u4e8e $XDG_CONFIG_HOME/dlv \u3002\u5426\u5219\uff0c\u5b83\u4eec\u5728Linux\u4e0a\u4f4d\u4e8e $HOME/.config/dlv \uff0c\u5728\u5176\u4ed6\u7cfb\u7edf\u4e0a\u4f4d\u4e8e $HOME/.dlv \u3002 \u914d\u7f6e\u6587\u4ef6 config.yml \u5305\u542b\u6240\u6709\u53ef\u914d\u7f6e\u7684\u9009\u9879\u548c\u5b83\u4eec\u7684\u9ed8\u8ba4\u503c\u3002\u547d\u4ee4\u5386\u53f2\u88ab\u4fdd\u5b58\u5728 .dbg_history \u4e2d\u3002 \u8c03\u8bd5\u547d\u4ee4 \u00b6 \u8fd0\u884c\u7a0b\u5e8f \u00b6 Command Description call \u6062\u590d\u8fdb\u7a0b\uff0c\u6ce8\u5165\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\uff08\u5b9e\u9a8c\u6027\u7684\uff01\uff01\uff01\uff09 continue \u8fd0\u884c\u5230\u65ad\u70b9\u6216\u7a0b\u5e8f\u7ed3\u675f next \u8df3\u8f6c\u5230\u4e0b\u4e00\u4e2a\u4ee3\u7801\u884c rebuild \u91cd\u65b0\u6784\u5efa\u76ee\u6807\u53ef\u6267\u884c\u6587\u4ef6\u5e76\u91cd\u65b0\u542f\u52a8\u5b83\u3002\u5982\u679c\u8be5\u53ef\u6267\u884c\u6587\u4ef6\u4e0d\u662f\u7531delve\u6784\u5efa\u7684\uff0c\u5b83\u5c31\u4e0d\u8d77\u4f5c\u7528 restart \u91cd\u542f\u8fdb\u7a0b step \u5355\u6b65\u8c03\u8bd5 step-instruction \u5355\u6b65\u8c03\u8bd5CPU\u6307\u4ee4 stepout \u8df3\u51fa\u5f53\u524d\u51fd\u6570 \u64cd\u4f5c\u65ad\u70b9 \u00b6 Command Description break \u8bbe\u7f6e\u65ad\u70b9 breakpoints \u6253\u5370\u51fa\u751f\u6548\u65ad\u70b9\u7684\u4fe1\u606f clear \u5220\u9664\u65ad\u70b9 clearall \u5220\u9664\u591a\u4e2a\u65ad\u70b9 condition \u8bbe\u7f6e\u65ad\u70b9\u6761\u4ef6 on \u5f53\u4e00\u4e2a\u65ad\u70b9\u88ab\u51fb\u4e2d\u65f6\uff0c\u6267\u884c\u4e00\u4e2a\u547d\u4ee4 toggle \u6253\u5f00\u6216\u5173\u95ed\u4e00\u4e2a\u65ad\u70b9 trace \u8bbe\u7f6e\u8ddf\u8e2a\u70b9 watch \u8bbe\u7f6e\u76d1\u63a7\u70b9 \u67e5\u770b\u7a0b\u5e8f\u53d8\u91cf\u548c\u5185\u5b58 \u00b6 Command Description args \u6253\u5370\u51fd\u6570\u53c2\u6570 display \u6bcf\u6b21\u7a0b\u5e8f\u505c\u6b62\u65f6\uff0c\u6253\u5370\u4e00\u4e2a\u8868\u8fbe\u5f0f\u7684\u503c examinemem \u68c0\u67e5\u5185\u5b58 locals \u6253\u5370\u672c\u5730\u53d8\u91cf print \u8ba1\u7b97\u8868\u8fbe\u5f0f regs \u6253\u5370\u5bc4\u5b58\u5668\u7684\u503c set \u4fee\u6539\u53d8\u91cf\u503c vars \u6253\u5370\u5305\u53d8\u91cf whatis \u83b7\u53d6\u8868\u8fbe\u5f0f\u7c7b\u578b \u67e5\u770b\u548c\u5207\u6362goroutine\u548c\u7ebf\u7a0b \u00b6 Command Description goroutine \u663e\u793a\u6216\u5207\u6362\u5f53\u524d\u7684Goroutine goroutines \u5217\u51fa\u7a0b\u5e8f\u6240\u6709goroutine thread \u5207\u6362\u5230\u6307\u5b9a\u7ebf\u7a0b threads \u6253\u5370\u51fa\u6bcf\u4e2a\u88ab\u8ffd\u8e2a\u7ebf\u7a0b\u7684\u4fe1\u606f\u3002 \u67e5\u770b\u8c03\u7528\u5806\u6808\u548c\u9009\u62e9\u6808\u5e27 \u00b6 Command Description deferred \u5728\u4e00\u4e2a\u5ef6\u8fdf\u8c03\u7528\u7684\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u547d\u4ee4\u3002 down \u5c06\u5f53\u524d\u5e27\u5411\u4e0b\u79fb\u52a8 frame \u8bbe\u7f6e\u5f53\u524d\u5e27\uff0c\u6216\u5728\u4e0d\u540c\u7684\u5e27\u4e0a\u6267\u884c\u547d\u4ee4 stack \u6253\u5370\u5806\u6808\u8bb0\u5f55 up \u5c06\u5f53\u524d\u5e27\u5411\u4e0a\u79fb\u52a8 \u5176\u4ed6\u547d\u4ee4 \u00b6 Command Description check \u5728\u5f53\u524d\u4f4d\u7f6e\u521b\u5efa\u4e00\u4e2a\u68c0\u67e5\u70b9 checkpoints \u6253\u5370\u51fa\u73b0\u6709\u68c0\u67e5\u70b9\u7684\u4fe1\u606f clear-checkpoint \u5220\u9664\u68c0\u67e5\u70b9 config \u6539\u53d8\u914d\u7f6e\u53c2\u6570 disassemble \u53cd\u6c47\u7f16 dump \u4ece\u5f53\u524d\u8fdb\u7a0b\u72b6\u6001\u521b\u5efa\u4e00\u4e2acoredump edit Open where you are in $DELVE_EDITOR or $EDITOR exit \u9000\u51fa funcs \u6253\u5370\u51fd\u6570\u5217\u8868 help \u6253\u5370\u5e2e\u52a9\u4fe1\u606f libraries \u5217\u51fa\u52a0\u8f7d\u7684\u52a8\u6001\u5e93 list \u663e\u793a\u6e90\u7801 source \u6267\u884c\u4e00\u4e2a\u5305\u542bdlv\u547d\u4ee4\u5217\u8868\u7684\u6587\u4ef6 sources \u6253\u5370\u6e90\u6587\u4ef6\u5217\u8868 types \u6253\u5370\u7c7b\u578b\u5217\u8868 args \u00b6 \u6253\u5370\u51fd\u6570\u53c2\u6570\u3002 [goroutine <n>] [frame <m>] args [-v] [<regex>] \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u540d\u79f0\u4e0e\u4e4b\u5339\u914d\u7684\u51fd\u6570\u53c2\u6570\u624d\u4f1a\u88ab\u8fd4\u56de\u3002\u5982\u679c\u6307\u5b9a\u4e86-v\uff0c\u5c06\u663e\u793a\u6bcf\u4e2a\u51fd\u6570\u53c2\u6570\u7684\u66f4\u591a\u4fe1\u606f\u3002 break \u00b6 \u8bbe\u7f6e\u65ad\u70b9\u3002 break [name] <linespec> \u53c2\u89c1 Documentation/cli/locspec.md \u4e86\u89e3linespec\u7684\u8bed\u6cd5\u3002 \u4e5f\u8bf7\u53c2\u89c1\uff1a\u201dhelp on\u201c\u3001\u201chelp cond\u201d\u548c\u201chelp clear\u201d\u3002 \u522b\u540d: b breakpoints \u00b6 \u6253\u5370\u51fa\u751f\u6548\u65ad\u70b9\u7684\u4fe1\u606f\u3002 \u522b\u540d: bp call \u00b6 \u6062\u590d\u8fdb\u7a0b\uff0c\u6ce8\u5165\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\uff08\u5b9e\u9a8c\u6027\u7684\uff01\uff01\uff01\uff09 call [-unsafe] <function call expression> \u5f53\u524d\u9650\u5236: - \u53ea\u6709\u6307\u5411\u6808\u5206\u914d\u7684\u5bf9\u8c61\u7684\u6307\u9488\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002 - \u53ea\u652f\u6301\u4e00\u4e9b\u81ea\u52a8\u7c7b\u578b\u8f6c\u6362\u3002 - functions can only be called on running goroutines that are not executing the runtime. - \u5f53\u524d\u7684goroutine\u6808\u4e0a\u9700\u8981\u6709\u81f3\u5c11256\u5b57\u8282\u7684\u7a7a\u95f2\u7a7a\u95f4\u3002 - functions can only be called when the goroutine is stopped at a safe point. - \u8c03\u7528\u4e00\u4e2a\u51fd\u6570\u5c06\u6062\u590d\u6240\u6709goroutine\u7684\u6267\u884c\u3002 - \u53ea\u652f\u6301Linux\u7684\u672c\u5730\u540e\u7aef. check \u00b6 \u5728\u5f53\u524d\u4f4d\u7f6e\u521b\u5efa\u4e00\u4e2a\u68c0\u67e5\u70b9\u3002 checkpoint [note] \u201dnote\u201c\u662f\u4efb\u610f\u7684\u6587\u672c\uff0c\u53ef\u7528\u4e8e\u6807\u8bc6\u68c0\u67e5\u70b9\uff0c\u5982\u679c\u6ca1\u6709\u6307\u660e\uff0c\u5219\u9ed8\u8ba4\u4e3a\u201dfilename:line position\u201d\u3002 \u522b\u540d: checkpoint checkpoints \u00b6 \u6253\u5370\u51fa\u73b0\u6709\u68c0\u67e5\u70b9\u7684\u4fe1\u606f\u3002 clear \u00b6 \u5220\u9664\u65ad\u70b9\u3002 clear <breakpoint name or id> clear-checkpoint \u00b6 \u5220\u9664\u68c0\u67e5\u70b9\u3002 clear-checkpoint <id> \u5225\u540d: clearcheck clearall \u00b6 \u5220\u9664\u591a\u4e2a\u65ad\u70b9\u3002 clearall [<linespec>] If called with the linespec argument it will delete all the breakpoints matching the linespec. If linespec is omitted all breakpoints are deleted. \u5982\u679c\u8c03\u7528\u6307\u5b9alinespec\u53c2\u6570\uff0c\u5b83\u5c06\u5220\u9664\u6240\u6709\u4e0elinespec\u5339\u914d\u7684\u65ad\u70b9\u3002\u5982\u679c\u7701\u7565linespec\uff0c\u5219\u6240\u6709\u65ad\u70b9\u90fd\u4f1a\u88ab\u5220\u9664\u3002 condition \u00b6 \u8bbe\u7f6e\u65ad\u70b9\u6761\u4ef6\u3002 condition <breakpoint name or id> <boolean expression>. condition -hitcount <breakpoint name or id> <operator> <argument> \u6307\u5b9a\u65ad\u70b9\u3001\u8ddf\u8e2a\u70b9\u6216\u89c2\u5bdf\u70b9\u53ea\u6709\u5728\u5e03\u5c14\u8868\u8fbe\u5f0f\u4e3a\u771f\u65f6\u624d\u4f1a\u547d\u4e2d\u3002 \u901a\u8fc7-hitcount\u9009\u9879\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u65ad\u70b9\u6761\u4ef6\u7684\u547d\u4e2d\u6570\uff0c\u652f\u6301\u4ee5\u4e0b\u8fd0\u7b97\u7b26\uff1a condition -hitcount bp > n condition -hitcount bp >= n condition -hitcount bp < n condition -hitcount bp <= n condition -hitcount bp == n condition -hitcount bp != n condition -hitcount bp % n \u201c% n\u201d\u5f62\u5f0f\u610f\u5473\u7740\u5f53hitcount\u662fn\u7684\u500d\u6570\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u5728\u65ad\u70b9\u5904\u505c\u6b62\u3002 \u522b\u540d: cond config \u00b6 \u6539\u53d8\u914d\u7f6e\u53c2\u6570\u3002 config -list \u663e\u793a\u6240\u6709\u914d\u7f6e\u53c2\u6570\u3002 config -save \u5c06\u914d\u7f6e\u6587\u4ef6\u4fdd\u5b58\u5230\u78c1\u76d8\uff0c\u8986\u76d6\u5f53\u524d\u914d\u7f6e\u6587\u4ef6\u3002 config <parameter> <value> \u6539\u53d8\u914d\u7f6e\u53c2\u6570\u503c\u3002 config substitute-path <from> <to> config substitute-path <from> \u6dfb\u52a0\u6216\u5220\u9664\u4e00\u4e2a\u8def\u5f84\u66ff\u6362\u89c4\u5219\u3002 config alias <command> <alias> config alias <alias> \u5c06 \u5b9a\u4e49\u4e3a \u7684\u522b\u540d\u6216\u5220\u9664\u4e00\u4e2a\u522b\u540d\u3002 continue \u00b6 \u8fd0\u884c\u81f3\u65ad\u70b9\u6216\u7a0b\u5e8f\u7ec8\u6b62\u3002 continue [<linespec>] Optional linespec argument allows you to continue until a specific location is reached. The program will halt if a breakpoint is hit before reaching the specified location. \u53ef\u9009\u7684linespec\u53c2\u6570\u5141\u8bb8\u4f60\u7ee7\u7eed\u6267\u884c\u76f4\u5230\u5230\u8fbe\u4e00\u4e2a\u7279\u5b9a\u7684\u4f4d\u7f6e\u3002\u5982\u679c\u5728\u5230\u8fbe\u6307\u5b9a\u4f4d\u7f6e\u4e4b\u524d\u65ad\u70b9\u547d\u4e2d\uff0c\u7a0b\u5e8f\u5c06\u505c\u6b62\u8fd0\u884c\u3002 \u4f8b\u5982: continue main.main continue encoding/json.Marshal \u522b\u540d: c deferred \u00b6 \u5728\u4e00\u4e2a\u5ef6\u8fdf\u8c03\u7528\u7684\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u547d\u4ee4\u3002 deferred <n> <command> \u5728\u5f53\u524d\u5e27\u4e2d\u7b2cn\u4e2a\u5ef6\u8fdf\u8c03\u7528\u7684\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u6307\u5b9a\u7684\u547d\u4ee4\uff08print, args, locals\uff09\u3002 disassemble \u00b6 \u53cd\u6c47\u7f16\u3002 [goroutine <n>] [frame <m>] disassemble [-a <start> <end>] [-l <locspec>] \u5982\u679c\u6ca1\u6709\u6307\u5b9a\u53c2\u6570\uff0c\u5728\u9009\u5b9a\u7684\u6808\u5e27\u4e2d\u6b63\u5728\u6267\u884c\u7684\u51fd\u6570\u5c06\u88ab\u53cd\u6c47\u7f16\u3002 -a <start> <end> \u53cd\u6c47\u7f16\u6307\u5b9a\u7684\u5730\u5740\u8303\u56f4 -l <locspec> \u53cd\u6c47\u7f16\u6307\u5b9a\u7684\u51fd\u6570 \u522b\u540d: disass display \u00b6 \u6bcf\u6b21\u7a0b\u5e8f\u505c\u6b62\u65f6\uff0c\u6253\u5370\u8868\u8fbe\u5f0f\u7684\u503c\u3002 display -a [%format] <expression> display -d <number> \u9009\u9879'-a'\u5c06\u4e00\u4e2a\u8868\u8fbe\u5f0f\u6dfb\u52a0\u5230\u6bcf\u6b21\u7a0b\u5e8f\u505c\u6b62\u65f6\u6253\u5370\u7684\u8868\u8fbe\u5f0f\u5217\u8868\u4e2d\u3002\u9009\u9879'-d'\u4ece\u5217\u8868\u4e2d\u5220\u9664\u6307\u5b9a\u7684\u8868\u8fbe\u5f0f\u3002 \u5982\u679c\u5728\u6ca1\u6709\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u8c03\u7528display\uff0c\u5b83\u5c06\u6253\u5370\u5217\u8868\u4e2d\u6240\u6709\u8868\u8fbe\u5f0f\u7684\u503c\u3002 down \u00b6 \u5c06\u5f53\u524d\u5e27\u5411\u4e0b\u79fb\u52a8\u3002 down [<m>] down [<m>] <command> \u5c06\u5f53\u524d\u5e27\u5411\u4e0b\u79fb\u52a8 \u3002\u7b2c\u4e8c\u79cd\u5f62\u5f0f\u662f\u5728\u7ed9\u5b9a\u7684\u5e27\u4e0a\u8fd0\u884c\u8be5\u547d\u4ee4\u3002 dump \u00b6 \u4ece\u5f53\u524d\u8fdb\u7a0b\u72b6\u6001\u521b\u5efa\u4e00\u4e2a\u6838\u5fc3\u8f6c\u50a8\u3002 dump <output file> \u6838\u5fc3\u8f6c\u50a8\u603b\u662f\u7528ELF\u5199\u7684\uff0c\u5373\u4f7f\u662f\u5728\u4e0d\u4e60\u60ef\u8fd9\u6837\u505a\u7684\u7cfb\u7edf\u4e0a\uff08windows, macOS\uff09\u3002\u5bf9\u4e8elinux/amd64\u4ee5\u5916\u7684\u73af\u5883\uff0c\u7ebf\u7a0b\u548c\u5bc4\u5b58\u5668\u7684\u8f6c\u50a8\u683c\u5f0f\u53ea\u6709Delve\u53ef\u4ee5\u8bfb\u56de\u3002 edit \u00b6 Open where you are in $DELVE_EDITOR or $EDITOR edit [locspec] \u5982\u679c\u7701\u7565locspec\uff0cedit\u5c06\u5728\u7f16\u8f91\u5668\u4e2d\u6253\u5f00\u5f53\u524d\u7684\u6e90\u6587\u4ef6\uff0c\u5426\u5219\u5b83\u5c06\u6253\u5f00\u6307\u5b9a\u7684\u4f4d\u7f6e\u3002 \u522b\u540d: ed examinemem \u00b6 \u67e5\u770b\u5185\u5b58\uff1a examinemem [-fmt <format>] [-count|-len <count>] [-size <size>] <address> examinemem [-fmt <format>] [-count|-len <count>] [-size <size>] -x <expression> Format\u4ee3\u8868\u6570\u636e\u683c\u5f0f\uff0c\u5176\u503c\u662f\u8fd9\u4e2a\u5217\u8868\u4e2d\u7684\u4e00\u4e2a\uff08\u9ed8\u8ba4\u4e3a\u5341\u516d\u8fdb\u5236\uff09\uff1abin\uff08\u4e8c\u8fdb\u5236\uff09\uff0coct\uff08\u516b\u8fdb\u5236\uff09\uff0cdec\uff08\u5341\u8fdb\u5236\uff09\uff0chex\uff08\u5341\u516d\u8fdb\u5236\uff09\uff0caddr\uff08\u5730\u5740\uff09\u3002 \u957f\u5ea6\u662f\u5b57\u8282\u6570\uff08\u9ed8\u8ba4\u4e3a1\uff09\uff0c\u5fc5\u987b\u5c0f\u4e8e\u6216\u7b49\u4e8e1000\u3002 \u5730\u5740\u662f\u8981\u68c0\u67e5\u7684\u76ee\u6807\u7684\u5185\u5b58\u4f4d\u7f6e\u3002\u8bf7\u6ce8\u610f\u201c-len\u5df2\u7ecf\u88ab\u201c-count\u201d\u548c\u201c-size\u201d\u6240\u6dd8\u6c70\u3002 \u8868\u8fbe\u5f0f\u53ef\u4ee5\u662f\u4e00\u4e2a\u6574\u6570\u8868\u8fbe\u5f0f\u6216\u8981\u68c0\u67e5\u7684\u5185\u5b58\u4f4d\u7f6e\u7684\u6307\u9488\u503c\u3002 \u6bd4\u5982\u8bf4\u3002 x -fmt hex -count 20 -size 1 0xc00008af38 x -fmt hex -count 20 -size 1 -x 0xc00008af38 + 8 x -fmt hex -count 20 -size 1 -x &myVar x -fmt hex -count 20 -size 1 -x myPtrVar \u522b\u540d: x exit \u00b6 \u9000\u51fa\u8c03\u8bd5\u3002 exit [-c] \u5f53\u8fde\u63a5\u5230\u4e00\u4e2a\u7528--accept-multiclient\u542f\u52a8\u7684 headless \u5b9e\u4f8b\u65f6\uff0c\u5728\u65ad\u5f00\u8fde\u63a5\u524d\u901a\u8fc7-c\u6765\u6062\u590d\u76ee\u6807\u8fdb\u7a0b\u7684\u6267\u884c\u3002 \u522b\u540d\uff1aquit q frame \u00b6 \u8bbe\u7f6e\u5f53\u524d\u5e27\uff0c\u6216\u5728\u4e0d\u540c\u7684\u5e27\u4e0a\u6267\u884c\u547d\u4ee4\u3002 frame <m> # \u8bbe\u7f6e\u5e27 frame <m> <command> # \u5728\u7ed9\u5b9a\u5e27\u4e0a\u6267\u884c\u547d\u4ee4 funcs \u00b6 \u6253\u5370\u51fd\u6570\u5217\u8868 funcs [<regex>] \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u4e0e\u4e4b\u5339\u914d\u7684\u51fd\u6570\u624d\u4f1a\u88ab\u8fd4\u56de\u3002 goroutine \u00b6 \u663e\u793a\u6216\u6539\u53d8\u5f53\u524d\u7684Goroutine\u3002 goroutine goroutine <id> goroutine <id> <command> \u5728\u6ca1\u6709\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u8c03\u7528\uff0c\u5b83\u5c06\u663e\u793a\u5173\u4e8e\u5f53\u524dgoroutine\u7684\u4fe1\u606f\u3002 \u7528\u4e00\u4e2a\u53c2\u6570\u8c03\u7528\uff0c\u5b83\u5c06\u5207\u6362\u5230\u6307\u5b9a\u7684goroutine\u3002 \u7528\u66f4\u591a\u7684\u53c2\u6570\u8c03\u7528\uff0c\u5b83\u5c06\u5728\u6307\u5b9a\u7684goroutine\u4e0a\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\u3002 \u522b\u540d\uff1agr goroutines \u00b6 \u5217\u51fa\u7a0b\u5e8fgoroutines\u3002 goroutines [-u (default: user location)|-r (runtime location)|-g (go statement location)|-s (start location)] [-t (stack trace)] [-l (labels)] \u6253\u5370\u51fa\u6bcf\u4e2agoroutine\u7684\u4fe1\u606f\u3002\u8be5\u6807\u5fd7\u63a7\u5236\u4e86\u6bcf\u4e2agoroutine\u6240\u663e\u793a\u7684\u4fe1\u606f\uff1a -u \u663e\u793a\u7528\u6237\u4ee3\u7801\u4e2d\u6700\u9876\u5c42\u6808\u5e27\u7684\u4f4d\u7f6e -r \u663e\u793a\u6700\u9876\u5c42\u7684\u6808\u5e27\u7684\u4f4d\u7f6e (\u5305\u62ec\u79c1\u6709\u8fd0\u884c\u65f6\u51fd\u6570\u5185\u90e8\u7684\u5e27) -g \u663e\u793a\u521b\u5efagoroutine\u7684go\u6307\u4ee4\u7684\u4f4d\u7f6e -s \u663e\u793a\u51fd\u6570\u5f00\u59cb\u7684\u4f4d\u7f6e -t \u663e\u793agoroutine\u7684\u5806\u6808\u8ddf\u8e2a\u8bb0\u5f55 -l \u663e\u793agoroutine\u7684\u6807\u7b7e \u5982\u679c\u6ca1\u6709\u6307\u5b9a\u6807\u5fd7\uff0c\u9ed8\u8ba4\u4e3a-u\u3002 \u522b\u540d\uff1agrs help \u00b6 \u6253\u5370\u5e2e\u52a9\u4fe1\u606f\u3002 help [command] \u952e\u5165 \"help\"\uff0c\u5e76\u52a0\u4e0a\u547d\u4ee4\u540d\uff0c\u4ee5\u83b7\u5f97\u66f4\u591a\u76f8\u5173\u4fe1\u606f\u3002 libraries \u00b6 \u5217\u51fa\u5df2\u52a0\u8f7d\u7684\u52a8\u6001\u5e93\u3002 list \u00b6 \u67e5\u770b\u6e90\u7801\u3002 [goroutine <n>] [frame <m>] list [<linespec>] \u663e\u793a\u5f53\u524d\u6267\u884c\u70b9\u6216\u63d0\u4f9b\u7684linespec\u5468\u56f4\u7684\u6e90\u7801\u3002 \u6bd4\u5982: frame 1 list 69 list testvariables.go:10000 list main.main:30 list 40 \u522b\u540d: ls l locals \u00b6 \u6253\u5370\u5c40\u90e8\u53d8\u91cf\u3002 [goroutine <n>] [frame <m>] locals [-v] [<regex>] The name of variables that are shadowed in the current scope will be shown in parenthesis. \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u540d\u79f0\u4e0e\u4e4b\u5339\u914d\u7684\u5c40\u90e8\u53d8\u91cf\u624d\u4f1a\u88ab\u8fd4\u56de\u3002\u5982\u679c\u6307\u5b9a\u4e86-v\uff0c\u5c06\u663e\u793a\u6bcf\u4e2a\u5c40\u90e8\u53d8\u91cf\u7684\u66f4\u591a\u4fe1\u606f\u3002 next \u00b6 \u8d70\u5230\u4e0b\u4e00\u4e2a\u4ee3\u7801\u884c\u3002 next [count] \u53ef\u9009\u7684[count]\u53c2\u6570\u5141\u8bb8\u8df3\u8fc7\u591a\u884c\u3002 \u522b\u540d\uff1an on \u00b6 \u5f53\u65ad\u70b9\u547d\u4e2d\uff0c\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\u3002 on <breakpoint name or id> <command>. \u652f\u6301\u7684\u547d\u4ee4\uff1a\uff08print\u3001stack and goroutine\uff09 print \u00b6 \u6253\u5370\u8868\u8fbe\u5f0f\u503c [goroutine <n>] [frame <m>] print [%format] <expression> \u5173\u4e8e\u652f\u6301\u7684\u8868\u8fbe\u5f0f\u7684\u63cf\u8ff0\uff0c\u8bf7\u53c2\u89c1 Documentation/cli/expr.md \u3002 \u53ef\u9009\u7684 format \u53c2\u6570\u662f\u4e00\u4e2a\u683c\u5f0f\u6307\u5b9a\u7b26\uff0c\u5c31\u50cf fmt \u5305\u6240\u4f7f\u7528\u7684\u90a3\u6837\u3002\u4f8b\u5982\uff0c\"print %x v \"\u5c06\u628av\u6253\u5370\u6210\u4e00\u4e2a\u5341\u516d\u8fdb\u5236\u7684\u6570\u5b57\u3002 \u522b\u540d\uff1ap rebuild \u00b6 \u91cd\u5efa\u76ee\u6807\u53ef\u6267\u884c\u6587\u4ef6\u5e76\u91cd\u65b0\u542f\u52a8\u5b83\u3002\u5982\u679c\u8be5\u53ef\u6267\u884c\u6587\u4ef6\u4e0d\u662f\u7531delve\u6784\u5efa\u7684\uff0c\u5b83\u5c31\u4e0d\u8d77\u4f5c\u7528\u3002 regs \u00b6 \u6253\u5370CPU\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\u3002 regs [-a] \u53c2\u6570-a\u663e\u793a\u66f4\u591a\u7684\u5bc4\u5b58\u5668\u3002\u5355\u4e2a\u5bc4\u5b58\u5668\u4e5f\u53ef\u4ee5\u901a\u8fc7\u201cprint\u201d\u548c\u201cdisplay\u201d\u6765\u663e\u793a\u3002\u53c2\u89c1 Documentation/cli/expr.md. restart \u00b6 \u91cd\u542f\u8fdb\u7a0b\u3002 For recorded targets the command takes the following forms: restart resets to the start of the recording restart [checkpoint] resets the recording to the given checkpoint restart -r [newargv...] [redirects...] re-records the target process For live targets the command takes the following forms: restart [newargv...] [redirects...] restarts the process \u5982\u679c\u7701\u7565newargv\uff0c\u8fdb\u7a0b\u5c06\u4ee5\u76f8\u540c\u7684\u53c2\u6570\u5411\u91cf\u91cd\u65b0\u542f\u52a8\uff08\u6216\u91cd\u65b0\u8bb0\u5f55\uff09\u3002 \u5982\u679c\u6307\u5b9a\u4e86-noargs\uff0c\u5219\u53c2\u6570\u5411\u91cf\u88ab\u6e05\u9664\u3002 \u53ef\u4ee5\u5728\u65b0\u7684\u53c2\u6570\u5217\u8868\u540e\u6307\u5b9a\u4e00\u4e2a\u6587\u4ef6\u91cd\u5b9a\u5411\u5217\u8868\uff0c\u4ee5\u8986\u76d6\u4f7f\u7528\"--\u91cd\u5b9a\u5411 \"\u547d\u4ee4\u884c\u9009\u9879\u5b9a\u4e49\u7684\u91cd\u5b9a\u5411\u3002\u4f7f\u7528\u7684\u662f\u7c7b\u4f3c\u4e8eUnix shells\u7684\u8bed\u6cd5\u3002 <input.txt redirects the standard input of the target process from input.txt >output.txt redirects the standard output of the target process to output.txt 2>error.txt redirects the standard error of the target process to error.txt \u522b\u540d\uff1ar set \u00b6 \u6539\u53d8\u53d8\u91cf\u7684\u503c\u3002 [goroutine <n>] [frame <m>] set <variable> = <value> \u5173\u4e8e\u652f\u6301\u7684\u8868\u8fbe\u5f0f\u7684\u63cf\u8ff0\uff0c\u8bf7\u53c2\u89c1 Documentation/cli/expr.md \u3002\u53ea\u6709\u6570\u5b57\u578b\u53d8\u91cf\u548c\u6307\u9488\u53ef\u4ee5\u88ab\u6539\u53d8\u3002 source \u00b6 \u6267\u884c\u4e00\u4e2a\u5305\u542bdelve\u547d\u4ee4\u5217\u8868\u7684\u6587\u4ef6\u3002 source <path> \u5982\u679c path \u4ee5.star\u6269\u5c55\u540d\u7ed3\u5c3e\uff0c\u5b83\u5c06\u88ab\u89e3\u91ca\u4e3a\u4e00\u4e2astarlark\u811a\u672c\u3002\u8bed\u6cd5\u89c1 Documentation/cli/starlark.md \u3002 \u5982\u679c path \u662f\u4e00\u4e2a\u5355\u4e00\u7684\u2019-\u2018\u5b57\u7b26\uff0c\u4e00\u4e2a\u4ea4\u4e92\u5f0f\u7684starlark\u89e3\u91ca\u5668\u5c06\u88ab\u542f\u52a8\u3002\u952e\u5165\u201dexit\u201c\u6765\u9000\u51fa\u3002 sources \u00b6 \u6253\u5370\u6e90\u6587\u4ef6\u7684\u6e05\u5355\u3002 sources [<regex>] \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u4e0e\u4e4b\u5339\u914d\u7684\u6e90\u6587\u4ef6\u624d\u4f1a\u88ab\u8fd4\u56de\u3002 stack \u00b6 \u6253\u5370\u5806\u6808\u8ddf\u8e2a\u3002 [goroutine <n>] [frame <m>] stack [<depth>] [-full] [-offsets] [-defer] [-a <n>] [-adepth <depth>] [-mode <mode>] -full every stackframe is decorated with the value of its local variables and arguments. -offsets prints frame offset of each frame. -defer prints deferred function call stack for each frame. -a <n> prints stacktrace of n ancestors of the selected goroutine (target process must have tracebackancestors enabled) -adepth <depth> configures depth of ancestor stacktrace -mode <mode> specifies the stacktrace mode, possible values are: normal - attempts to automatically switch between cgo frames and go frames simple - disables automatic switch between cgo and go fromg - starts from the registers stored in the runtime.g struct \u522b\u540d\uff1abt step \u00b6 \u5355\u6b65\u6267\u884c\u7a0b\u5e8f \u522b\u540d\uff1as step-instruction \u00b6 \u5355\u6b65\u6267\u884ccpu\u6307\u4ee4 \u522b\u540d\uff1asi stepout \u00b6 \u8d70\u51fa\u5f53\u524d\u51fd\u6570 \u522b\u540d\uff1aso thread \u00b6 \u5207\u6362\u5230\u6307\u5b9a\u7684\u7ebf\u7a0b\u3002 thread <id> \u522b\u540d\uff1atr threads \u00b6 \u6253\u5370\u51fa\u6bcf\u4e2a\u88ab\u8ffd\u8e2a\u7ebf\u7a0b\u7684\u4fe1\u606f\u3002 toggle \u00b6 \u6253\u5f00\u6216\u5173\u95ed\u4e00\u4e2a\u65ad\u70b9\u3002 toggle <breakpoint name or id> trace \u00b6 \u8bbe\u7f6e\u8ddf\u8e2a\u70b9\u3002 trace [name] <linespec> \u8ddf\u8e2a\u70b9\u662f\u4e00\u4e2a\u4e0d\u4f1a\u505c\u6b62\u7a0b\u5e8f\u6267\u884c\u7684\u65ad\u70b9\uff0c\u76f8\u53cd\uff0c\u5f53\u8ddf\u8e2a\u70b9\u88ab\u51fb\u4e2d\u65f6\uff0c\u4f1a\u663e\u793a\u4e00\u4e2a\u901a\u77e5\u3002\u8bf7\u53c2\u9605 Documentation/cli/locspec.md \u4e86\u89e3linespec\u7684\u8bed\u6cd5\u3002 \u4e5f\u8bf7\u53c2\u89c1: \"help on\", \"help cond\" and \"help clear\" \u522b\u540d\uff1at types \u00b6 \u6253\u5370\u7c7b\u578b\u5217\u8868\u3002 types [<regex>] \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u4e0e\u4e4b\u5339\u914d\u7684\u7c7b\u578b\u624d\u4f1a\u88ab\u8fd4\u56de\u3002 up \u00b6 \u5c06\u5f53\u524d\u5e27\u5411\u4e0a\u79fb\u52a8\u3002 up [<m>] # \u5c06\u5f53\u524d\u5e27\u5411\u4e0a\u79fb\u52a8<m> up [<m>] <command> # \u5728\u7ed9\u5b9a\u7684\u5e27\u4e0a\u8fd0\u884c\u8be5\u547d\u4ee4 vars \u00b6 \u6253\u5370\u5305\u53d8\u91cf\u3002 vars [-v] [<regex>] \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u540d\u79f0\u4e0e\u4e4b\u5339\u914d\u7684\u5305\u53d8\u91cf\u624d\u4f1a\u88ab\u8fd4\u56de\u3002\u5982\u679c\u6307\u5b9a\u4e86-v\uff0c\u5c06\u663e\u793a\u5173\u4e8e\u6bcf\u4e2a\u5305\u53d8\u91cf\u7684\u66f4\u591a\u4fe1\u606f\u3002 watch \u00b6 \u8bbe\u7f6e\u89c2\u5bdf\u70b9\u3002 watch [-r|-w|-rw] <expr> -r \u5f53\u5185\u5b58\u4f4d\u7f6e\u88ab\u8bfb\u53d6\u65f6\u505c\u6b62 -w \u5f53\u5185\u5b58\u4f4d\u7f6e\u88ab\u5199\u5165\u65f6\u505c\u6b62 -rw \u5f53\u5185\u5b58\u4f4d\u7f6e\u88ab\u8bfb\u53d6\u6216\u5199\u5165\u65f6\u505c\u6b62 \u5185\u5b58\u4f4d\u7f6e\u662f\u4e0e'print'\u6240\u4f7f\u7528\u7684\u8868\u8fbe\u5f0f\u8bed\u8a00\u4e00\u6837\u6765\u6307\u5b9a\u7684\uff0c\u4f8b\u5982\uff1a watch v \u5c06\u89c2\u5bdf\u53d8\u91cf\u201dv\u201c\u7684\u5730\u5740\u3002 \u53c2\u8003: \"help print\". whatis \u00b6 \u6253\u5370\u8868\u8fbe\u5f0f\u7684\u7c7b\u578b\u3002 whatis <expression> \u5e38\u89c1\u95ee\u9898 \u00b6 \u5982\u4f55\u5728docker\u4e2d\u4f7f\u7528dlv \u00b6 \u542f\u52a8docker\u5bb9\u5668\u65f6\uff0c\u589e\u52a0\u53c2\u6570 --security-opt=seccomp:unconfined \u3002 \u4f60\u53ef\u4ee5\u50cf\u8fd9\u6837\u5728\u5bb9\u5668\u5185\u542f\u52a8\u4e00\u4e2aDelve\u7684 headless \u5b9e\u4f8b: $ dlv exec --headless --listen :4040 /path/to/executable \u7136\u540e\u4ece\u5bb9\u5668\u5916\u8fde\u63a5\u5230\u5b83: $ dlv connect :4040 \u7a0b\u5e8f\u4e0d\u4f1a\u5f00\u59cb\u6267\u884c\uff0c\u76f4\u5230\u4f60\u8fde\u63a5\u5230Delve\u5e76\u53d1\u9001 continue \u547d\u4ee4\u3002 \u5982\u679c\u4f60\u60f3\u8ba9\u7a0b\u5e8f\u7acb\u5373\u5f00\u59cb\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5411Delve\u4f20\u9012 --continue \u548c --accept-multiclient \u9009\u9879\u6765\u5b9e\u73b0: $ dlv exec --headless --continue --listen :4040 --accept-multiclient /path/to/executable \u6ce8\u610f\uff0c\u4e0eDelve\u7684\u8fde\u63a5\u662f\u672a\u7ecf\u8ba4\u8bc1\u7684\uff0c\u5c06\u5141\u8bb8\u4efb\u610f\u7684\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u3002 \u8bf7\u4e0d\u8981\u5728\u751f\u4ea7\u4e2d\u8fd9\u6837\u505a \u3002 \u5982\u4f55\u4f7f\u7528Delve\u6765\u8c03\u8bd5CLI\u5e94\u7528\u7a0b\u5e8f \u00b6 \u5728\u4e00\u4e2a\u5355\u72ec\u7684\u7ec8\u7aef\u4e2d\u8fd0\u884c\u4f60\u7684CLI\u5e94\u7528\u7a0b\u5e8f\uff0c\u7136\u540e\u901a\u8fc7 dlv attach \u8c03\u8bd5\u3002 \u901a\u8fc7 dlv debug --headless \u5728 headless \u6a21\u5f0f\u4e0b\u8fd0\u884cDelve\uff0c\u7136\u540e\u4ece\u53e6\u4e00\u4e2a\u7ec8\u7aef\u8fde\u63a5\u5230\u5b83\u3002\u8fd9\u5c06\u4f7f\u8be5\u8fdb\u7a0b\u5904\u4e8e\u524d\u53f0\uff0c\u5e76\u5141\u8bb8\u5b83\u8bbf\u95ee\u7ec8\u7aefTTY\u3002 \u4e3a\u8fdb\u7a0b\u6307\u5b9a\u5b83\u81ea\u5df1\u7684TTY\u3002\u8fd9\u5728UNIX\u7cfb\u7edf\u4e0a\u53ef\u4ee5\u4f7f\u7528 dlv debug \u548c dlv exec \u547d\u4ee4\u901a\u8fc7 --tty \u6807\u5fd7\u6765\u5b9e\u73b0\u3002\u4e3a\u4e86\u83b7\u5f97\u6700\u597d\u7684\u4f53\u9a8c\uff0c\u4f60\u5e94\u8be5\u521b\u5efa\u4f60\u81ea\u5df1\u7684PTY\u5e76\u5c06\u5176\u6307\u5b9a\u4e3aTTY\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7 ptyme \u5b8c\u6210\u3002 \u5982\u4f55\u4f7f\u7528dlv\u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5 \u00b6 \u5efa\u8bae\u6700\u597d\u4e0d\u8981\u5728\u516c\u7f51\u4e0a\u4f7f\u7528\u8fdc\u7a0b\u8c03\u8bd5\u3002\u5982\u679c\u4f60\u5fc5\u987b\u8fdc\u7a0b\u8c03\u8bd5\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528ssh\u96a7\u9053\u6216\u8005VPN\u8fde\u63a5\u3002 \u793a\u4f8b \u8fdc\u7a0b\u670d\u52a1\u7aef: $ dlv exec --headless --listen localhost:4040 /path/to/executable \u672c\u5730\u5ba2\u6237\u7aef: 1. \u8fde\u63a5\u5230\u670d\u52a1\u7aef\u5e76\u4e14\u542f\u52a8\u4e00\u4e2a\u672c\u5730\u7aef\u53e3\u8f6c\u53d1 $ ssh -NL 4040 :localhost:4040 user@remote.ip \u8fde\u63a5\u672c\u5730\u7aef\u53e3 $ dlv connect :4040 \u53c2\u8003\u6587\u7ae0 \u00b6 delve usage Command line client Getting Started delve FAQ","title":"Go\u8bed\u8a00\u8c03\u8bd5"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#go","text":"","title":"Go\u8bed\u8a00\u8c03\u8bd5"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#delve-dlv","text":"","title":"delve (dlv)"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#dlv","text":"Delve\u662f\u4e00\u4e2a\u7528\u4e8eGo\u7a0b\u5e8f\u7684\u6e90\u7801\u7ea7\u8c03\u8bd5\u5668\u3002Delve\u4f7f\u4f60\u80fd\u591f\u901a\u8fc7\u63a7\u5236\u7a0b\u5e8f\u7684\u6267\u884c\u3001\u8bc4\u4f30\u53d8\u91cf\u4ee5\u53ca\u63d0\u4f9b\u7ebf\u7a0b/ goroutine \u72b6\u6001\u3001CPU\u5bc4\u5b58\u5668\u72b6\u6001\u7b49\u4fe1\u606f\u4e0e\u4f60\u7684\u7a0b\u5e8f\u8fdb\u884c\u4ea4\u4e92\u3002 \u8c03\u8bd5\u65f6\u53ef\u4ee5\u4f7f\u7528 -- \u5411\u4f60\u8c03\u8bd5\u7684\u7a0b\u5e8f\u4f20\u9012\u53ef\u9009\u6807\u8bc6\uff0c\u4f8b\u5982\uff1a $ dlv exec ./hello -- server --config conf/config.toml \u53ef\u7528\u547d\u4ee4 dlv attach - \u9644\u52a0\u5230\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u5e76\u5f00\u59cb\u8c03\u8bd5\u3002 dlv connect - \u8fde\u63a5\u81f3 headless debug server \u3002 dlv core - \u68c0\u67e5coredump\u6587\u4ef6\u3002 dlv dap - [\u5b9e\u9a8c]\u542f\u52a8\u4e00\u4e2aTCP\u670d\u52a1\u5668\u5e76\u901a\u8fc7DAP\u534f\u8bae\uff08Debug Adaptor Protocol\uff09\u901a\u4fe1\u3002 dlv debug - \u7f16\u8bd1\u5e76\u5f00\u59cb\u8c03\u5f53\u524d\u76ee\u5f55\u4e0b\u7684main\u5305\u6216\u6307\u5b9a\u7684\u5305\u3002 dlv exec - \u6267\u884c\u53ef\u6267\u884c\u6587\u4ef6\u5e76\u5f00\u59cb\u8c03\u8bd5\u3002 dlv replay - \u56de\u653e\u4e00\u4e2arr\u8ddf\u8e2a\u3002 dlv run - \u5e9f\u5f03\u7684\u547d\u4ee4\uff0c\u4f7f\u7528 debug \u4ee3\u66ff\u3002 dlv test - \u7f16\u8bd1\u6d4b\u8bd5\u4e8c\u8fdb\u5236\u6587\u4ef6\u5e76\u5f00\u59cb\u8c03\u8bd5\u7a0b\u5e8f\u3002 dlv trace - \u7f16\u8bd1\u5e76\u5f00\u59cb\u8ffd\u8e2a\u7a0b\u5e8f\u3002 dlv version - \u6253\u5370\u7248\u672c\u3002 dlv log - Help about logging flags dlv backend - Help about the --backend flag dlv redirect - Help about file redirection \u4f7f\u7528\u201c dlv [command] --help \u201d\u67e5\u627e\u5173\u4e8e\u8fd9\u4e2a\u547d\u4ee4\u66f4\u591a\u7684\u4fe1\u606f\u3002 \u5168\u5c40\u9009\u9879 --accept-multiclient \u5141\u8bb8\u4e00\u4e2aheadless server\u652f\u6301\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5 --allow-non-terminal-interactive \u5141\u8bb8\u6ca1\u6709\u7ec8\u7aef\u7684Delve\u7684\u4ea4\u4e92\u5f0f\u4f1a\u8bdd\u4f5c\u4e3astdin\u3001stdout\u548cstderr\u3002 --api-version int \u9009\u62e9headless\u65f6\u7684API\u7248\u672c\u3002\u65b0\u5ba2\u6237\u7aef\u5e94\u8be5\u4f7f\u7528v2\u3002\u53ef\u4ee5\u901a\u8fc7RPCServer.SetApiVersion\u91cd\u7f6e\u3002\u53c2\u89c1Documentation/api/json-rpc/README.md\u3002(\u9ed8\u8ba4\u4e3a1) --backend string \u9009\u62e9\u540e\u7aef (see 'dlv help backend'). (default \"default\") --build-flags string \u4f20\u7ed9\u7f16\u8bd1\u5668\u6784\u5efa\u6807\u5fd7\uff0c\u4f8b\u5982: --build-flags=\"-tags=integration -mod=vendor -cover -v\" --check-go-version \u68c0\u67e5\u6b63\u5728\u4f7f\u7528\u7684Go\u7684\u7248\u672c\u662f\u5426\u4e0eDelve\u517c\u5bb9\u3002(\u9ed8\u8ba4\u4e3atrue) --disable-aslr \u7981\u7528\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316\uff08Address Space Layout Randomization\uff09 --headless \u53ea\u8fd0\u884c\u8c03\u8bd5\u670d\u52a1\u5668\uff0c\u5728headless\u6a21\u5f0f\u4e0b --init string \u542f\u52a8\u6587\u4ef6\uff0c\u7531\u7ec8\u7aef\u5ba2\u6237\u7aef\u6267\u884c -l, --listen string \u8c03\u8bd5\u670d\u52a1\u5668\u76d1\u542c\u5730\u5740(\u9ed8\u8ba4\u4e3a \"127.0.0.1:0\") --log \u542f\u7528\u8c03\u8bd5\u670d\u52a1\u5668\u65e5\u5fd7 --log-dest string \u5c06\u65e5\u5fd7\u5199\u5230\u6307\u5b9a\u7684\u6587\u4ef6\u6216\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e2d\uff08\u89c1'dlv help log'\uff09 --log-output string \u8bbe\u7f6e\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\u7684\u7ec4\u4ef6\uff0c\u7528\u9017\u53f7\u5206\u9694\uff08\u89c1\u2019dlv help log\u2018\uff09 --only-same-user \u53ea\u5141\u8bb8\u6765\u81ea\u542f\u52a8\u6b64Delve\u5b9e\u4f8b\u7684\u540c\u4e00\u7528\u6237\u7684\u8fde\u63a5(\u9ed8\u8ba4\u4e3atrue) -r, --redirect stringArray \u4e3a\u76ee\u6807\u8fdb\u7a0b\u6307\u5b9a\u91cd\u5b9a\u5411\u89c4\u5219\uff08\u89c1'dlv help redirect'\uff09 --wd string \u8fd0\u884c\u8be5\u7a0b\u5e8f\u7684\u5de5\u4f5c\u76ee\u5f55","title":"dlv\u7b80\u4ecb"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#dlv-attach","text":"\u8fd9\u4e2a\u547d\u4ee4\u5c06\u4f7fDelve\u63a7\u5236\u4e00\u4e2a\u5df2\u7ecf\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5e76\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u4f1a\u8bdd\u3002\u5f53\u9000\u51fa\u8c03\u8bd5\u4f1a\u8bdd\u65f6\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u8ba9\u8be5\u8fdb\u7a0b\u7ee7\u7eed\u8fd0\u884c\u6216\u6740\u6b7b\u5b83\u3002 dlv attach pid [executable] \u9009\u9879 --continue \u5728\u542f\u52a8\u65f6\u7ee7\u7eed\u8fdb\u884c\u8c03\u8bd5\u8fdb\u7a0b","title":"dlv attach"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#dlv-exec","text":"\u8fd9\u4e2a\u547d\u4ee4\u5c06\u4f7fDelve\u6267\u884c\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u7acb\u5373\u9644\u52a0\u5230\u8fdb\u7a0b\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u4f1a\u8bdd\u3002\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u4e8c\u8fdb\u5236\u6587\u4ef6\u5728\u7f16\u8bd1\u65f6\u6ca1\u6709\u7981\u7528\u4f18\u5316\u529f\u80fd\uff0c\u53ef\u80fd\u5f88\u96be\u6b63\u786e\u5730\u8c03\u8bd5\u5b83\u3002\u8bf7\u8003\u8651\u5728Go 1.10\u6216\u66f4\u9ad8\u7248\u672c\u4e0a\u7528-gcflags=\"all=-N -l \"\u7f16\u8bd1\u8c03\u8bd5\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5728Go\u7684\u65e9\u671f\u7248\u672c\u4e0a\u7528-gcflags=\"-N -l\"\u3002 dlv exec <path/to/binary> \u9009\u9879 --continue \u5728\u542f\u52a8\u65f6\u7ee7\u7eed\u8fdb\u884c\u8c03\u8bd5\u8fdb\u7a0b --tty string \u6307\u5b9a\u76ee\u6807\u7a0b\u5e8f\u8981\u4f7f\u7528\u7684tty","title":"dlv exec"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#dlv-debug","text":"\u5728\u7981\u7528\u4f18\u5316\u7684\u60c5\u51b5\u4e0b\u7f16\u8bd1\u4f60\u7684\u7a0b\u5e8f\uff0c\u542f\u52a8\u5e76\u9644\u52a0\u5230\u5b83\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u6ca1\u6709\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\uff0cDelve\u5c06\u7f16\u8bd1\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 \"main \"\u5305\uff0c\u5e76\u5f00\u59cb\u8c03\u8bd5\u5b83\u3002\u6216\u8005\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u5305\u7684\u540d\u5b57\uff0cDelve\u5c06\u7f16\u8bd1\u8be5\u5305\uff0c\u5e76\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u4f1a\u8bdd\u3002 dlv debug [package] \u9009\u9879 --continue \u5728\u542f\u52a8\u65f6\u7ee7\u7eed\u8fdb\u884c\u8c03\u8bd5\u8fdb\u7a0b --output string \u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84(default \"./__debug_bin\") --tty string \u6307\u5b9a\u76ee\u6807\u7a0b\u5e8f\u8981\u4f7f\u7528\u7684tty","title":"dlv debug"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#dlv-test","text":"\u7f16\u8bd1\u4e00\u4e2a\u7981\u7528\u4f18\u5316\u7684\u6d4b\u8bd5\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u4f1a\u8bdd\u3002 test\u547d\u4ee4\u5141\u8bb8\u4f60\u5728\u5355\u5143\u6d4b\u8bd5\u7684\u80cc\u666f\u4e0b\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u4f1a\u8bdd\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cDelve\u5c06\u8c03\u8bd5\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6d4b\u8bd5\u7a0b\u5e8f\u3002\u53e6\u5916\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u5305\u7684\u540d\u79f0\uff0cDelve\u5c06\u5728\u8be5\u5305\u4e2d\u8c03\u8bd5\u6d4b\u8bd5\u7a0b\u5e8f\u3002\u53cc\u7834\u6298\u53f7 -- \u53ef\u4ee5\u7528\u6765\u4f20\u9012\u53c2\u6570\u7ed9\u6d4b\u8bd5\u7a0b\u5e8f\u3002 dlv test [package] -- -test.v -other-argument \u53e6\u89c1\uff1a\u201cgo help testflag\u201d\u3002 dlv test [package] \u9009\u9879 --output string \u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84(default \"debug.test\")","title":"dlv test"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_1","text":"","title":"\u5f00\u59cb\u4f7f\u7528"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#main","text":"\u6211\u4eec\u8981\u63a2\u8ba8\u7684\u7b2c\u4e00\u4e2aCLI\u5b50\u547d\u4ee4\u662f debug \u3002\u5982\u679c\u4f60\u548c\u4f60\u7684`main'\u5305\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\u4e0b\uff0c\u8fd9\u4e2a\u5b50\u547d\u4ee4\u53ef\u4ee5\u4e0d\u9700\u8981\u53c2\u6570\u8fd0\u884c\u3002 \u5426\u5219\uff0c\u5b83\u9700\u8981\u6307\u5b9a\u5305\u7684\u8def\u5f84\u3002\u4f8b\u5982\uff0c\u57fa\u4e8e\u4e0b\u9762\u8fd9\u4e2a\u9879\u76ee\u7684\u5e03\u5c40\uff1a . \u251c\u2500\u2500 github.com/me/foo \u251c\u2500\u2500 cmd \u2502 \u2514\u2500\u2500 foo \u2502 \u2514\u2500\u2500 main.go \u251c\u2500\u2500 pkg \u2502 \u2514\u2500\u2500 baz \u2502 \u251c\u2500\u2500 bar.go \u2502 \u2514\u2500\u2500 bar_test.go \u5982\u679c\u4f60\u5f53\u524d\u662f\u5728\u76ee\u5f55 github.com/me/foo/cmd/foo \u4e2d\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728\u547d\u4ee4\u884c\u6267\u884c dlv debug \u3002\u5728\u5176\u4ed6\u4efb\u4f55\u4f4d\u7f6e\uff0c\u6bd4\u5982\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u4f60\u9700\u8981\u63d0\u4f9b\u5305\u540d\uff1a dlv debug github.com/me/foo/cmd/foo \u3002\u8981\u5411\u4f60\u7684\u7a0b\u5e8f\u4f20\u9012\u6807\u5fd7\u7528 -- \u5206\u5f00\uff1a dlv debug github.com/me/foo/cmd/foo -- --arg1 value \u3002 \u8c03\u7528\u8be5\u547d\u4ee4\u5c06\u4f7fDelve\u4ee5\u6700\u9002\u5408\u8c03\u8bd5\u7684\u65b9\u5f0f\u7f16\u8bd1\u7a0b\u5e8f\u3002\u7136\u540e\uff0c\u5b83\u5c06\u6267\u884c\u5e76\u9644\u52a0\u5230\u7a0b\u5e8f\u4e0a\uff0c\u5e76\u5f00\u59cb\u4e00\u4e2a\u8c03\u8bd5\u4f1a\u8bdd\u3002\u73b0\u5728\uff0c\u5f53\u8c03\u8bd5\u4f1a\u8bdd\u5f00\u59cb\u65f6\uff0c\u4f60\u5c31\u5904\u4e8e\u7a0b\u5e8f\u521d\u59cb\u5316\u7684\u6700\u5f00\u59cb\u3002\u4e3a\u4e86\u8fdb\u5165\u4e00\u4e2a\u66f4\u6709\u7528\u7684\u5730\u65b9\u4f60\u4f1a\u60f3\u8bbe\u7f6e\u4e00\u4e2a\u6216\u4e24\u4e2a\u65ad\u70b9\uff0c\u7136\u540e\u7ee7\u7eed\u6267\u884c\u5230\u8be5\u65ad\u70b9\u3002 \u4f8b\u5982\uff0c\u7ee7\u7eed\u6267\u884c\u5230\u4f60\u7684\u7a0b\u5e8f\u7684 main \u51fd\u6570\u3002 $ dlv debug github.com/me/foo/cmd/foo Type 'help' for list of commands. ( dlv ) break main.main Breakpoint 1 set at 0x49ecf3 for main.main () ./test.go:5 ( dlv ) continue > main.main () ./test.go:5 ( hits goroutine ( 1 ) :1 total:1 ) ( PC: 0x49ecf3 ) 1 : package main 2 : 3 : import \"fmt\" 4 : = > 5 : func main () { 6 : fmt.Println ( \"delve test\" ) 7 : } ( dlv )","title":"\u8c03\u8bd5main\u5305"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_2","text":"\u8003\u8651\u5230\u4e0e\u4e0a\u9762\u76f8\u540c\u7684\u76ee\u5f55\u7ed3\u6784\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u4f60\u7684\u6d4b\u8bd5\u5957\u4ef6\u6765\u8c03\u8bd5\u4f60\u7684\u4ee3\u7801\u3002\u4e3a\u6b64\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 dlv test \u5b50\u547d\u4ee4\uff0c\u5b83\u9700\u8981\u4e0e dlv debug \u4e00\u6837\u7684\u53ef\u9009\u5305\u8def\u5f84\uff0c\u5982\u679c\u4e0d\u4f20\u9012\u4efb\u4f55\u53c2\u6570\uff0c\u5219\u4f1a\u6784\u5efa\u5f53\u524d\u76ee\u5f55\u7684\u5305\u3002 $ dlv test github.com/me/foo/pkg/baz Type 'help' for list of commands. ( dlv ) funcs test.Test* /home/me/go/src/github.com/me/foo/pkg/baz/test.TestHi ( dlv ) break TestHi Breakpoint 1 set at 0x536513 for /home/me/go/src/github.com/me/foo/pkg/baz/test.TestHi () ./test_test.go:5 ( dlv ) continue > /home/me/go/src/github.com/me/foo/pkg/baz/test.TestHi () ./bar_test.go:5 ( hits goroutine ( 5 ) :1 total:1 ) ( PC: 0x536513 ) 1 : package baz 2 : 3 : import \"testing\" 4 : = > 5 : func TestHi ( t *testing.T ) { 6 : t.Fatal ( \"implement me!\" ) 7 : } ( dlv ) \u6b63\u5982\u4f60\u6240\u770b\u5230\u7684\uff0c\u6211\u4eec\u5f00\u59cb\u8c03\u8bd5\u6d4b\u8bd5\u4e8c\u8fdb\u5236\uff0c\u901a\u8fc7 funcs \u547d\u4ee4\u627e\u5230\u6211\u4eec\u7684\u6d4b\u8bd5\u51fd\u6570\u3002 funcs \u547d\u4ee4\u627e\u5230\u4e86\u6211\u4eec\u7684\u6d4b\u8bd5\u51fd\u6570\uff0c\u8be5\u547d\u4ee4\u4f7f\u7528\u4e00\u4e2aregexp\u6765\u8fc7\u6ee4\u51fd\u6570\u5217\u8868\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u65ad\u70b9\uff0c\u7136\u540e\u7ee7\u7eed\u6267\u884c\uff0c\u76f4\u5230\u6211\u4eec\u547d\u4e2d\u8fd9\u4e2a\u65ad\u70b9\u3002 \u53ef\u4ee5\u4f7f\u7528 dlv help \u83b7\u53d6\u66f4\u591a\u5173\u4e8e\u5b50\u547d\u4ee4\u7684\u4fe1\u606f\uff0c\u4e00\u65e6\u8fdb\u5165\u8c03\u8bd5\u4f1a\u8bdd\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u952e\u5165 help \u770b\u5230\u6240\u6709\u53ef\u7528\u7684\u547d\u4ee4\u3002 \u5c31\u53ef\u4ee5\u770b\u5230\u6240\u6709\u53ef\u7528\u7684\u547d\u4ee4\u3002","title":"\u8c03\u8bd5\u6d4b\u8bd5\u7a0b\u5e8f"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_3","text":"","title":"\u8c03\u8bd5\u7f16\u8bd1\u5668"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_4","text":"\u5982\u679c $XDG_CONFIG_HOME \u88ab\u8bbe\u7f6e\uff0c\u90a3\u4e48\u914d\u7f6e\u548c\u547d\u4ee4\u5386\u53f2\u6587\u4ef6\u5c31\u4f4d\u4e8e $XDG_CONFIG_HOME/dlv \u3002\u5426\u5219\uff0c\u5b83\u4eec\u5728Linux\u4e0a\u4f4d\u4e8e $HOME/.config/dlv \uff0c\u5728\u5176\u4ed6\u7cfb\u7edf\u4e0a\u4f4d\u4e8e $HOME/.dlv \u3002 \u914d\u7f6e\u6587\u4ef6 config.yml \u5305\u542b\u6240\u6709\u53ef\u914d\u7f6e\u7684\u9009\u9879\u548c\u5b83\u4eec\u7684\u9ed8\u8ba4\u503c\u3002\u547d\u4ee4\u5386\u53f2\u88ab\u4fdd\u5b58\u5728 .dbg_history \u4e2d\u3002","title":"\u914d\u7f6e\u548c\u5386\u53f2\u547d\u4ee4"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_5","text":"","title":"\u8c03\u8bd5\u547d\u4ee4"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_6","text":"Command Description call \u6062\u590d\u8fdb\u7a0b\uff0c\u6ce8\u5165\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\uff08\u5b9e\u9a8c\u6027\u7684\uff01\uff01\uff01\uff09 continue \u8fd0\u884c\u5230\u65ad\u70b9\u6216\u7a0b\u5e8f\u7ed3\u675f next \u8df3\u8f6c\u5230\u4e0b\u4e00\u4e2a\u4ee3\u7801\u884c rebuild \u91cd\u65b0\u6784\u5efa\u76ee\u6807\u53ef\u6267\u884c\u6587\u4ef6\u5e76\u91cd\u65b0\u542f\u52a8\u5b83\u3002\u5982\u679c\u8be5\u53ef\u6267\u884c\u6587\u4ef6\u4e0d\u662f\u7531delve\u6784\u5efa\u7684\uff0c\u5b83\u5c31\u4e0d\u8d77\u4f5c\u7528 restart \u91cd\u542f\u8fdb\u7a0b step \u5355\u6b65\u8c03\u8bd5 step-instruction \u5355\u6b65\u8c03\u8bd5CPU\u6307\u4ee4 stepout \u8df3\u51fa\u5f53\u524d\u51fd\u6570","title":"\u8fd0\u884c\u7a0b\u5e8f"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_7","text":"Command Description break \u8bbe\u7f6e\u65ad\u70b9 breakpoints \u6253\u5370\u51fa\u751f\u6548\u65ad\u70b9\u7684\u4fe1\u606f clear \u5220\u9664\u65ad\u70b9 clearall \u5220\u9664\u591a\u4e2a\u65ad\u70b9 condition \u8bbe\u7f6e\u65ad\u70b9\u6761\u4ef6 on \u5f53\u4e00\u4e2a\u65ad\u70b9\u88ab\u51fb\u4e2d\u65f6\uff0c\u6267\u884c\u4e00\u4e2a\u547d\u4ee4 toggle \u6253\u5f00\u6216\u5173\u95ed\u4e00\u4e2a\u65ad\u70b9 trace \u8bbe\u7f6e\u8ddf\u8e2a\u70b9 watch \u8bbe\u7f6e\u76d1\u63a7\u70b9","title":"\u64cd\u4f5c\u65ad\u70b9"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_8","text":"Command Description args \u6253\u5370\u51fd\u6570\u53c2\u6570 display \u6bcf\u6b21\u7a0b\u5e8f\u505c\u6b62\u65f6\uff0c\u6253\u5370\u4e00\u4e2a\u8868\u8fbe\u5f0f\u7684\u503c examinemem \u68c0\u67e5\u5185\u5b58 locals \u6253\u5370\u672c\u5730\u53d8\u91cf print \u8ba1\u7b97\u8868\u8fbe\u5f0f regs \u6253\u5370\u5bc4\u5b58\u5668\u7684\u503c set \u4fee\u6539\u53d8\u91cf\u503c vars \u6253\u5370\u5305\u53d8\u91cf whatis \u83b7\u53d6\u8868\u8fbe\u5f0f\u7c7b\u578b","title":"\u67e5\u770b\u7a0b\u5e8f\u53d8\u91cf\u548c\u5185\u5b58"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#goroutine","text":"Command Description goroutine \u663e\u793a\u6216\u5207\u6362\u5f53\u524d\u7684Goroutine goroutines \u5217\u51fa\u7a0b\u5e8f\u6240\u6709goroutine thread \u5207\u6362\u5230\u6307\u5b9a\u7ebf\u7a0b threads \u6253\u5370\u51fa\u6bcf\u4e2a\u88ab\u8ffd\u8e2a\u7ebf\u7a0b\u7684\u4fe1\u606f\u3002","title":"\u67e5\u770b\u548c\u5207\u6362goroutine\u548c\u7ebf\u7a0b"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_9","text":"Command Description deferred \u5728\u4e00\u4e2a\u5ef6\u8fdf\u8c03\u7528\u7684\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u547d\u4ee4\u3002 down \u5c06\u5f53\u524d\u5e27\u5411\u4e0b\u79fb\u52a8 frame \u8bbe\u7f6e\u5f53\u524d\u5e27\uff0c\u6216\u5728\u4e0d\u540c\u7684\u5e27\u4e0a\u6267\u884c\u547d\u4ee4 stack \u6253\u5370\u5806\u6808\u8bb0\u5f55 up \u5c06\u5f53\u524d\u5e27\u5411\u4e0a\u79fb\u52a8","title":"\u67e5\u770b\u8c03\u7528\u5806\u6808\u548c\u9009\u62e9\u6808\u5e27"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_10","text":"Command Description check \u5728\u5f53\u524d\u4f4d\u7f6e\u521b\u5efa\u4e00\u4e2a\u68c0\u67e5\u70b9 checkpoints \u6253\u5370\u51fa\u73b0\u6709\u68c0\u67e5\u70b9\u7684\u4fe1\u606f clear-checkpoint \u5220\u9664\u68c0\u67e5\u70b9 config \u6539\u53d8\u914d\u7f6e\u53c2\u6570 disassemble \u53cd\u6c47\u7f16 dump \u4ece\u5f53\u524d\u8fdb\u7a0b\u72b6\u6001\u521b\u5efa\u4e00\u4e2acoredump edit Open where you are in $DELVE_EDITOR or $EDITOR exit \u9000\u51fa funcs \u6253\u5370\u51fd\u6570\u5217\u8868 help \u6253\u5370\u5e2e\u52a9\u4fe1\u606f libraries \u5217\u51fa\u52a0\u8f7d\u7684\u52a8\u6001\u5e93 list \u663e\u793a\u6e90\u7801 source \u6267\u884c\u4e00\u4e2a\u5305\u542bdlv\u547d\u4ee4\u5217\u8868\u7684\u6587\u4ef6 sources \u6253\u5370\u6e90\u6587\u4ef6\u5217\u8868 types \u6253\u5370\u7c7b\u578b\u5217\u8868","title":"\u5176\u4ed6\u547d\u4ee4"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#args","text":"\u6253\u5370\u51fd\u6570\u53c2\u6570\u3002 [goroutine <n>] [frame <m>] args [-v] [<regex>] \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u540d\u79f0\u4e0e\u4e4b\u5339\u914d\u7684\u51fd\u6570\u53c2\u6570\u624d\u4f1a\u88ab\u8fd4\u56de\u3002\u5982\u679c\u6307\u5b9a\u4e86-v\uff0c\u5c06\u663e\u793a\u6bcf\u4e2a\u51fd\u6570\u53c2\u6570\u7684\u66f4\u591a\u4fe1\u606f\u3002","title":"args"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#break","text":"\u8bbe\u7f6e\u65ad\u70b9\u3002 break [name] <linespec> \u53c2\u89c1 Documentation/cli/locspec.md \u4e86\u89e3linespec\u7684\u8bed\u6cd5\u3002 \u4e5f\u8bf7\u53c2\u89c1\uff1a\u201dhelp on\u201c\u3001\u201chelp cond\u201d\u548c\u201chelp clear\u201d\u3002 \u522b\u540d: b","title":"break"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#breakpoints","text":"\u6253\u5370\u51fa\u751f\u6548\u65ad\u70b9\u7684\u4fe1\u606f\u3002 \u522b\u540d: bp","title":"breakpoints"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#call","text":"\u6062\u590d\u8fdb\u7a0b\uff0c\u6ce8\u5165\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\uff08\u5b9e\u9a8c\u6027\u7684\uff01\uff01\uff01\uff09 call [-unsafe] <function call expression> \u5f53\u524d\u9650\u5236: - \u53ea\u6709\u6307\u5411\u6808\u5206\u914d\u7684\u5bf9\u8c61\u7684\u6307\u9488\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002 - \u53ea\u652f\u6301\u4e00\u4e9b\u81ea\u52a8\u7c7b\u578b\u8f6c\u6362\u3002 - functions can only be called on running goroutines that are not executing the runtime. - \u5f53\u524d\u7684goroutine\u6808\u4e0a\u9700\u8981\u6709\u81f3\u5c11256\u5b57\u8282\u7684\u7a7a\u95f2\u7a7a\u95f4\u3002 - functions can only be called when the goroutine is stopped at a safe point. - \u8c03\u7528\u4e00\u4e2a\u51fd\u6570\u5c06\u6062\u590d\u6240\u6709goroutine\u7684\u6267\u884c\u3002 - \u53ea\u652f\u6301Linux\u7684\u672c\u5730\u540e\u7aef.","title":"call"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#check","text":"\u5728\u5f53\u524d\u4f4d\u7f6e\u521b\u5efa\u4e00\u4e2a\u68c0\u67e5\u70b9\u3002 checkpoint [note] \u201dnote\u201c\u662f\u4efb\u610f\u7684\u6587\u672c\uff0c\u53ef\u7528\u4e8e\u6807\u8bc6\u68c0\u67e5\u70b9\uff0c\u5982\u679c\u6ca1\u6709\u6307\u660e\uff0c\u5219\u9ed8\u8ba4\u4e3a\u201dfilename:line position\u201d\u3002 \u522b\u540d: checkpoint","title":"check"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#checkpoints","text":"\u6253\u5370\u51fa\u73b0\u6709\u68c0\u67e5\u70b9\u7684\u4fe1\u606f\u3002","title":"checkpoints"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#clear","text":"\u5220\u9664\u65ad\u70b9\u3002 clear <breakpoint name or id>","title":"clear"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#clear-checkpoint","text":"\u5220\u9664\u68c0\u67e5\u70b9\u3002 clear-checkpoint <id> \u5225\u540d: clearcheck","title":"clear-checkpoint"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#clearall","text":"\u5220\u9664\u591a\u4e2a\u65ad\u70b9\u3002 clearall [<linespec>] If called with the linespec argument it will delete all the breakpoints matching the linespec. If linespec is omitted all breakpoints are deleted. \u5982\u679c\u8c03\u7528\u6307\u5b9alinespec\u53c2\u6570\uff0c\u5b83\u5c06\u5220\u9664\u6240\u6709\u4e0elinespec\u5339\u914d\u7684\u65ad\u70b9\u3002\u5982\u679c\u7701\u7565linespec\uff0c\u5219\u6240\u6709\u65ad\u70b9\u90fd\u4f1a\u88ab\u5220\u9664\u3002","title":"clearall"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#condition","text":"\u8bbe\u7f6e\u65ad\u70b9\u6761\u4ef6\u3002 condition <breakpoint name or id> <boolean expression>. condition -hitcount <breakpoint name or id> <operator> <argument> \u6307\u5b9a\u65ad\u70b9\u3001\u8ddf\u8e2a\u70b9\u6216\u89c2\u5bdf\u70b9\u53ea\u6709\u5728\u5e03\u5c14\u8868\u8fbe\u5f0f\u4e3a\u771f\u65f6\u624d\u4f1a\u547d\u4e2d\u3002 \u901a\u8fc7-hitcount\u9009\u9879\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u65ad\u70b9\u6761\u4ef6\u7684\u547d\u4e2d\u6570\uff0c\u652f\u6301\u4ee5\u4e0b\u8fd0\u7b97\u7b26\uff1a condition -hitcount bp > n condition -hitcount bp >= n condition -hitcount bp < n condition -hitcount bp <= n condition -hitcount bp == n condition -hitcount bp != n condition -hitcount bp % n \u201c% n\u201d\u5f62\u5f0f\u610f\u5473\u7740\u5f53hitcount\u662fn\u7684\u500d\u6570\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u5728\u65ad\u70b9\u5904\u505c\u6b62\u3002 \u522b\u540d: cond","title":"condition"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#config","text":"\u6539\u53d8\u914d\u7f6e\u53c2\u6570\u3002 config -list \u663e\u793a\u6240\u6709\u914d\u7f6e\u53c2\u6570\u3002 config -save \u5c06\u914d\u7f6e\u6587\u4ef6\u4fdd\u5b58\u5230\u78c1\u76d8\uff0c\u8986\u76d6\u5f53\u524d\u914d\u7f6e\u6587\u4ef6\u3002 config <parameter> <value> \u6539\u53d8\u914d\u7f6e\u53c2\u6570\u503c\u3002 config substitute-path <from> <to> config substitute-path <from> \u6dfb\u52a0\u6216\u5220\u9664\u4e00\u4e2a\u8def\u5f84\u66ff\u6362\u89c4\u5219\u3002 config alias <command> <alias> config alias <alias> \u5c06 \u5b9a\u4e49\u4e3a \u7684\u522b\u540d\u6216\u5220\u9664\u4e00\u4e2a\u522b\u540d\u3002","title":"config"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#continue","text":"\u8fd0\u884c\u81f3\u65ad\u70b9\u6216\u7a0b\u5e8f\u7ec8\u6b62\u3002 continue [<linespec>] Optional linespec argument allows you to continue until a specific location is reached. The program will halt if a breakpoint is hit before reaching the specified location. \u53ef\u9009\u7684linespec\u53c2\u6570\u5141\u8bb8\u4f60\u7ee7\u7eed\u6267\u884c\u76f4\u5230\u5230\u8fbe\u4e00\u4e2a\u7279\u5b9a\u7684\u4f4d\u7f6e\u3002\u5982\u679c\u5728\u5230\u8fbe\u6307\u5b9a\u4f4d\u7f6e\u4e4b\u524d\u65ad\u70b9\u547d\u4e2d\uff0c\u7a0b\u5e8f\u5c06\u505c\u6b62\u8fd0\u884c\u3002 \u4f8b\u5982: continue main.main continue encoding/json.Marshal \u522b\u540d: c","title":"continue"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#deferred","text":"\u5728\u4e00\u4e2a\u5ef6\u8fdf\u8c03\u7528\u7684\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u547d\u4ee4\u3002 deferred <n> <command> \u5728\u5f53\u524d\u5e27\u4e2d\u7b2cn\u4e2a\u5ef6\u8fdf\u8c03\u7528\u7684\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u6307\u5b9a\u7684\u547d\u4ee4\uff08print, args, locals\uff09\u3002","title":"deferred"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#disassemble","text":"\u53cd\u6c47\u7f16\u3002 [goroutine <n>] [frame <m>] disassemble [-a <start> <end>] [-l <locspec>] \u5982\u679c\u6ca1\u6709\u6307\u5b9a\u53c2\u6570\uff0c\u5728\u9009\u5b9a\u7684\u6808\u5e27\u4e2d\u6b63\u5728\u6267\u884c\u7684\u51fd\u6570\u5c06\u88ab\u53cd\u6c47\u7f16\u3002 -a <start> <end> \u53cd\u6c47\u7f16\u6307\u5b9a\u7684\u5730\u5740\u8303\u56f4 -l <locspec> \u53cd\u6c47\u7f16\u6307\u5b9a\u7684\u51fd\u6570 \u522b\u540d: disass","title":"disassemble"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#display","text":"\u6bcf\u6b21\u7a0b\u5e8f\u505c\u6b62\u65f6\uff0c\u6253\u5370\u8868\u8fbe\u5f0f\u7684\u503c\u3002 display -a [%format] <expression> display -d <number> \u9009\u9879'-a'\u5c06\u4e00\u4e2a\u8868\u8fbe\u5f0f\u6dfb\u52a0\u5230\u6bcf\u6b21\u7a0b\u5e8f\u505c\u6b62\u65f6\u6253\u5370\u7684\u8868\u8fbe\u5f0f\u5217\u8868\u4e2d\u3002\u9009\u9879'-d'\u4ece\u5217\u8868\u4e2d\u5220\u9664\u6307\u5b9a\u7684\u8868\u8fbe\u5f0f\u3002 \u5982\u679c\u5728\u6ca1\u6709\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u8c03\u7528display\uff0c\u5b83\u5c06\u6253\u5370\u5217\u8868\u4e2d\u6240\u6709\u8868\u8fbe\u5f0f\u7684\u503c\u3002","title":"display"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#down","text":"\u5c06\u5f53\u524d\u5e27\u5411\u4e0b\u79fb\u52a8\u3002 down [<m>] down [<m>] <command> \u5c06\u5f53\u524d\u5e27\u5411\u4e0b\u79fb\u52a8 \u3002\u7b2c\u4e8c\u79cd\u5f62\u5f0f\u662f\u5728\u7ed9\u5b9a\u7684\u5e27\u4e0a\u8fd0\u884c\u8be5\u547d\u4ee4\u3002","title":"down"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#dump","text":"\u4ece\u5f53\u524d\u8fdb\u7a0b\u72b6\u6001\u521b\u5efa\u4e00\u4e2a\u6838\u5fc3\u8f6c\u50a8\u3002 dump <output file> \u6838\u5fc3\u8f6c\u50a8\u603b\u662f\u7528ELF\u5199\u7684\uff0c\u5373\u4f7f\u662f\u5728\u4e0d\u4e60\u60ef\u8fd9\u6837\u505a\u7684\u7cfb\u7edf\u4e0a\uff08windows, macOS\uff09\u3002\u5bf9\u4e8elinux/amd64\u4ee5\u5916\u7684\u73af\u5883\uff0c\u7ebf\u7a0b\u548c\u5bc4\u5b58\u5668\u7684\u8f6c\u50a8\u683c\u5f0f\u53ea\u6709Delve\u53ef\u4ee5\u8bfb\u56de\u3002","title":"dump"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#edit","text":"Open where you are in $DELVE_EDITOR or $EDITOR edit [locspec] \u5982\u679c\u7701\u7565locspec\uff0cedit\u5c06\u5728\u7f16\u8f91\u5668\u4e2d\u6253\u5f00\u5f53\u524d\u7684\u6e90\u6587\u4ef6\uff0c\u5426\u5219\u5b83\u5c06\u6253\u5f00\u6307\u5b9a\u7684\u4f4d\u7f6e\u3002 \u522b\u540d: ed","title":"edit"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#examinemem","text":"\u67e5\u770b\u5185\u5b58\uff1a examinemem [-fmt <format>] [-count|-len <count>] [-size <size>] <address> examinemem [-fmt <format>] [-count|-len <count>] [-size <size>] -x <expression> Format\u4ee3\u8868\u6570\u636e\u683c\u5f0f\uff0c\u5176\u503c\u662f\u8fd9\u4e2a\u5217\u8868\u4e2d\u7684\u4e00\u4e2a\uff08\u9ed8\u8ba4\u4e3a\u5341\u516d\u8fdb\u5236\uff09\uff1abin\uff08\u4e8c\u8fdb\u5236\uff09\uff0coct\uff08\u516b\u8fdb\u5236\uff09\uff0cdec\uff08\u5341\u8fdb\u5236\uff09\uff0chex\uff08\u5341\u516d\u8fdb\u5236\uff09\uff0caddr\uff08\u5730\u5740\uff09\u3002 \u957f\u5ea6\u662f\u5b57\u8282\u6570\uff08\u9ed8\u8ba4\u4e3a1\uff09\uff0c\u5fc5\u987b\u5c0f\u4e8e\u6216\u7b49\u4e8e1000\u3002 \u5730\u5740\u662f\u8981\u68c0\u67e5\u7684\u76ee\u6807\u7684\u5185\u5b58\u4f4d\u7f6e\u3002\u8bf7\u6ce8\u610f\u201c-len\u5df2\u7ecf\u88ab\u201c-count\u201d\u548c\u201c-size\u201d\u6240\u6dd8\u6c70\u3002 \u8868\u8fbe\u5f0f\u53ef\u4ee5\u662f\u4e00\u4e2a\u6574\u6570\u8868\u8fbe\u5f0f\u6216\u8981\u68c0\u67e5\u7684\u5185\u5b58\u4f4d\u7f6e\u7684\u6307\u9488\u503c\u3002 \u6bd4\u5982\u8bf4\u3002 x -fmt hex -count 20 -size 1 0xc00008af38 x -fmt hex -count 20 -size 1 -x 0xc00008af38 + 8 x -fmt hex -count 20 -size 1 -x &myVar x -fmt hex -count 20 -size 1 -x myPtrVar \u522b\u540d: x","title":"examinemem"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#exit","text":"\u9000\u51fa\u8c03\u8bd5\u3002 exit [-c] \u5f53\u8fde\u63a5\u5230\u4e00\u4e2a\u7528--accept-multiclient\u542f\u52a8\u7684 headless \u5b9e\u4f8b\u65f6\uff0c\u5728\u65ad\u5f00\u8fde\u63a5\u524d\u901a\u8fc7-c\u6765\u6062\u590d\u76ee\u6807\u8fdb\u7a0b\u7684\u6267\u884c\u3002 \u522b\u540d\uff1aquit q","title":"exit"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#frame","text":"\u8bbe\u7f6e\u5f53\u524d\u5e27\uff0c\u6216\u5728\u4e0d\u540c\u7684\u5e27\u4e0a\u6267\u884c\u547d\u4ee4\u3002 frame <m> # \u8bbe\u7f6e\u5e27 frame <m> <command> # \u5728\u7ed9\u5b9a\u5e27\u4e0a\u6267\u884c\u547d\u4ee4","title":"frame"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#funcs","text":"\u6253\u5370\u51fd\u6570\u5217\u8868 funcs [<regex>] \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u4e0e\u4e4b\u5339\u914d\u7684\u51fd\u6570\u624d\u4f1a\u88ab\u8fd4\u56de\u3002","title":"funcs"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#goroutine_1","text":"\u663e\u793a\u6216\u6539\u53d8\u5f53\u524d\u7684Goroutine\u3002 goroutine goroutine <id> goroutine <id> <command> \u5728\u6ca1\u6709\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u8c03\u7528\uff0c\u5b83\u5c06\u663e\u793a\u5173\u4e8e\u5f53\u524dgoroutine\u7684\u4fe1\u606f\u3002 \u7528\u4e00\u4e2a\u53c2\u6570\u8c03\u7528\uff0c\u5b83\u5c06\u5207\u6362\u5230\u6307\u5b9a\u7684goroutine\u3002 \u7528\u66f4\u591a\u7684\u53c2\u6570\u8c03\u7528\uff0c\u5b83\u5c06\u5728\u6307\u5b9a\u7684goroutine\u4e0a\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\u3002 \u522b\u540d\uff1agr","title":"goroutine"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#goroutines","text":"\u5217\u51fa\u7a0b\u5e8fgoroutines\u3002 goroutines [-u (default: user location)|-r (runtime location)|-g (go statement location)|-s (start location)] [-t (stack trace)] [-l (labels)] \u6253\u5370\u51fa\u6bcf\u4e2agoroutine\u7684\u4fe1\u606f\u3002\u8be5\u6807\u5fd7\u63a7\u5236\u4e86\u6bcf\u4e2agoroutine\u6240\u663e\u793a\u7684\u4fe1\u606f\uff1a -u \u663e\u793a\u7528\u6237\u4ee3\u7801\u4e2d\u6700\u9876\u5c42\u6808\u5e27\u7684\u4f4d\u7f6e -r \u663e\u793a\u6700\u9876\u5c42\u7684\u6808\u5e27\u7684\u4f4d\u7f6e (\u5305\u62ec\u79c1\u6709\u8fd0\u884c\u65f6\u51fd\u6570\u5185\u90e8\u7684\u5e27) -g \u663e\u793a\u521b\u5efagoroutine\u7684go\u6307\u4ee4\u7684\u4f4d\u7f6e -s \u663e\u793a\u51fd\u6570\u5f00\u59cb\u7684\u4f4d\u7f6e -t \u663e\u793agoroutine\u7684\u5806\u6808\u8ddf\u8e2a\u8bb0\u5f55 -l \u663e\u793agoroutine\u7684\u6807\u7b7e \u5982\u679c\u6ca1\u6709\u6307\u5b9a\u6807\u5fd7\uff0c\u9ed8\u8ba4\u4e3a-u\u3002 \u522b\u540d\uff1agrs","title":"goroutines"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#help","text":"\u6253\u5370\u5e2e\u52a9\u4fe1\u606f\u3002 help [command] \u952e\u5165 \"help\"\uff0c\u5e76\u52a0\u4e0a\u547d\u4ee4\u540d\uff0c\u4ee5\u83b7\u5f97\u66f4\u591a\u76f8\u5173\u4fe1\u606f\u3002","title":"help"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#libraries","text":"\u5217\u51fa\u5df2\u52a0\u8f7d\u7684\u52a8\u6001\u5e93\u3002","title":"libraries"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#list","text":"\u67e5\u770b\u6e90\u7801\u3002 [goroutine <n>] [frame <m>] list [<linespec>] \u663e\u793a\u5f53\u524d\u6267\u884c\u70b9\u6216\u63d0\u4f9b\u7684linespec\u5468\u56f4\u7684\u6e90\u7801\u3002 \u6bd4\u5982: frame 1 list 69 list testvariables.go:10000 list main.main:30 list 40 \u522b\u540d: ls l","title":"list"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#locals","text":"\u6253\u5370\u5c40\u90e8\u53d8\u91cf\u3002 [goroutine <n>] [frame <m>] locals [-v] [<regex>] The name of variables that are shadowed in the current scope will be shown in parenthesis. \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u540d\u79f0\u4e0e\u4e4b\u5339\u914d\u7684\u5c40\u90e8\u53d8\u91cf\u624d\u4f1a\u88ab\u8fd4\u56de\u3002\u5982\u679c\u6307\u5b9a\u4e86-v\uff0c\u5c06\u663e\u793a\u6bcf\u4e2a\u5c40\u90e8\u53d8\u91cf\u7684\u66f4\u591a\u4fe1\u606f\u3002","title":"locals"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#next","text":"\u8d70\u5230\u4e0b\u4e00\u4e2a\u4ee3\u7801\u884c\u3002 next [count] \u53ef\u9009\u7684[count]\u53c2\u6570\u5141\u8bb8\u8df3\u8fc7\u591a\u884c\u3002 \u522b\u540d\uff1an","title":"next"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#on","text":"\u5f53\u65ad\u70b9\u547d\u4e2d\uff0c\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\u3002 on <breakpoint name or id> <command>. \u652f\u6301\u7684\u547d\u4ee4\uff1a\uff08print\u3001stack and goroutine\uff09","title":"on"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#print","text":"\u6253\u5370\u8868\u8fbe\u5f0f\u503c [goroutine <n>] [frame <m>] print [%format] <expression> \u5173\u4e8e\u652f\u6301\u7684\u8868\u8fbe\u5f0f\u7684\u63cf\u8ff0\uff0c\u8bf7\u53c2\u89c1 Documentation/cli/expr.md \u3002 \u53ef\u9009\u7684 format \u53c2\u6570\u662f\u4e00\u4e2a\u683c\u5f0f\u6307\u5b9a\u7b26\uff0c\u5c31\u50cf fmt \u5305\u6240\u4f7f\u7528\u7684\u90a3\u6837\u3002\u4f8b\u5982\uff0c\"print %x v \"\u5c06\u628av\u6253\u5370\u6210\u4e00\u4e2a\u5341\u516d\u8fdb\u5236\u7684\u6570\u5b57\u3002 \u522b\u540d\uff1ap","title":"print"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#rebuild","text":"\u91cd\u5efa\u76ee\u6807\u53ef\u6267\u884c\u6587\u4ef6\u5e76\u91cd\u65b0\u542f\u52a8\u5b83\u3002\u5982\u679c\u8be5\u53ef\u6267\u884c\u6587\u4ef6\u4e0d\u662f\u7531delve\u6784\u5efa\u7684\uff0c\u5b83\u5c31\u4e0d\u8d77\u4f5c\u7528\u3002","title":"rebuild"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#regs","text":"\u6253\u5370CPU\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\u3002 regs [-a] \u53c2\u6570-a\u663e\u793a\u66f4\u591a\u7684\u5bc4\u5b58\u5668\u3002\u5355\u4e2a\u5bc4\u5b58\u5668\u4e5f\u53ef\u4ee5\u901a\u8fc7\u201cprint\u201d\u548c\u201cdisplay\u201d\u6765\u663e\u793a\u3002\u53c2\u89c1 Documentation/cli/expr.md.","title":"regs"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#restart","text":"\u91cd\u542f\u8fdb\u7a0b\u3002 For recorded targets the command takes the following forms: restart resets to the start of the recording restart [checkpoint] resets the recording to the given checkpoint restart -r [newargv...] [redirects...] re-records the target process For live targets the command takes the following forms: restart [newargv...] [redirects...] restarts the process \u5982\u679c\u7701\u7565newargv\uff0c\u8fdb\u7a0b\u5c06\u4ee5\u76f8\u540c\u7684\u53c2\u6570\u5411\u91cf\u91cd\u65b0\u542f\u52a8\uff08\u6216\u91cd\u65b0\u8bb0\u5f55\uff09\u3002 \u5982\u679c\u6307\u5b9a\u4e86-noargs\uff0c\u5219\u53c2\u6570\u5411\u91cf\u88ab\u6e05\u9664\u3002 \u53ef\u4ee5\u5728\u65b0\u7684\u53c2\u6570\u5217\u8868\u540e\u6307\u5b9a\u4e00\u4e2a\u6587\u4ef6\u91cd\u5b9a\u5411\u5217\u8868\uff0c\u4ee5\u8986\u76d6\u4f7f\u7528\"--\u91cd\u5b9a\u5411 \"\u547d\u4ee4\u884c\u9009\u9879\u5b9a\u4e49\u7684\u91cd\u5b9a\u5411\u3002\u4f7f\u7528\u7684\u662f\u7c7b\u4f3c\u4e8eUnix shells\u7684\u8bed\u6cd5\u3002 <input.txt redirects the standard input of the target process from input.txt >output.txt redirects the standard output of the target process to output.txt 2>error.txt redirects the standard error of the target process to error.txt \u522b\u540d\uff1ar","title":"restart"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#set","text":"\u6539\u53d8\u53d8\u91cf\u7684\u503c\u3002 [goroutine <n>] [frame <m>] set <variable> = <value> \u5173\u4e8e\u652f\u6301\u7684\u8868\u8fbe\u5f0f\u7684\u63cf\u8ff0\uff0c\u8bf7\u53c2\u89c1 Documentation/cli/expr.md \u3002\u53ea\u6709\u6570\u5b57\u578b\u53d8\u91cf\u548c\u6307\u9488\u53ef\u4ee5\u88ab\u6539\u53d8\u3002","title":"set"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#source","text":"\u6267\u884c\u4e00\u4e2a\u5305\u542bdelve\u547d\u4ee4\u5217\u8868\u7684\u6587\u4ef6\u3002 source <path> \u5982\u679c path \u4ee5.star\u6269\u5c55\u540d\u7ed3\u5c3e\uff0c\u5b83\u5c06\u88ab\u89e3\u91ca\u4e3a\u4e00\u4e2astarlark\u811a\u672c\u3002\u8bed\u6cd5\u89c1 Documentation/cli/starlark.md \u3002 \u5982\u679c path \u662f\u4e00\u4e2a\u5355\u4e00\u7684\u2019-\u2018\u5b57\u7b26\uff0c\u4e00\u4e2a\u4ea4\u4e92\u5f0f\u7684starlark\u89e3\u91ca\u5668\u5c06\u88ab\u542f\u52a8\u3002\u952e\u5165\u201dexit\u201c\u6765\u9000\u51fa\u3002","title":"source"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#sources","text":"\u6253\u5370\u6e90\u6587\u4ef6\u7684\u6e05\u5355\u3002 sources [<regex>] \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u4e0e\u4e4b\u5339\u914d\u7684\u6e90\u6587\u4ef6\u624d\u4f1a\u88ab\u8fd4\u56de\u3002","title":"sources"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#stack","text":"\u6253\u5370\u5806\u6808\u8ddf\u8e2a\u3002 [goroutine <n>] [frame <m>] stack [<depth>] [-full] [-offsets] [-defer] [-a <n>] [-adepth <depth>] [-mode <mode>] -full every stackframe is decorated with the value of its local variables and arguments. -offsets prints frame offset of each frame. -defer prints deferred function call stack for each frame. -a <n> prints stacktrace of n ancestors of the selected goroutine (target process must have tracebackancestors enabled) -adepth <depth> configures depth of ancestor stacktrace -mode <mode> specifies the stacktrace mode, possible values are: normal - attempts to automatically switch between cgo frames and go frames simple - disables automatic switch between cgo and go fromg - starts from the registers stored in the runtime.g struct \u522b\u540d\uff1abt","title":"stack"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#step","text":"\u5355\u6b65\u6267\u884c\u7a0b\u5e8f \u522b\u540d\uff1as","title":"step"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#step-instruction","text":"\u5355\u6b65\u6267\u884ccpu\u6307\u4ee4 \u522b\u540d\uff1asi","title":"step-instruction"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#stepout","text":"\u8d70\u51fa\u5f53\u524d\u51fd\u6570 \u522b\u540d\uff1aso","title":"stepout"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#thread","text":"\u5207\u6362\u5230\u6307\u5b9a\u7684\u7ebf\u7a0b\u3002 thread <id> \u522b\u540d\uff1atr","title":"thread"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#threads","text":"\u6253\u5370\u51fa\u6bcf\u4e2a\u88ab\u8ffd\u8e2a\u7ebf\u7a0b\u7684\u4fe1\u606f\u3002","title":"threads"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#toggle","text":"\u6253\u5f00\u6216\u5173\u95ed\u4e00\u4e2a\u65ad\u70b9\u3002 toggle <breakpoint name or id>","title":"toggle"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#trace","text":"\u8bbe\u7f6e\u8ddf\u8e2a\u70b9\u3002 trace [name] <linespec> \u8ddf\u8e2a\u70b9\u662f\u4e00\u4e2a\u4e0d\u4f1a\u505c\u6b62\u7a0b\u5e8f\u6267\u884c\u7684\u65ad\u70b9\uff0c\u76f8\u53cd\uff0c\u5f53\u8ddf\u8e2a\u70b9\u88ab\u51fb\u4e2d\u65f6\uff0c\u4f1a\u663e\u793a\u4e00\u4e2a\u901a\u77e5\u3002\u8bf7\u53c2\u9605 Documentation/cli/locspec.md \u4e86\u89e3linespec\u7684\u8bed\u6cd5\u3002 \u4e5f\u8bf7\u53c2\u89c1: \"help on\", \"help cond\" and \"help clear\" \u522b\u540d\uff1at","title":"trace"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#types","text":"\u6253\u5370\u7c7b\u578b\u5217\u8868\u3002 types [<regex>] \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u4e0e\u4e4b\u5339\u914d\u7684\u7c7b\u578b\u624d\u4f1a\u88ab\u8fd4\u56de\u3002","title":"types"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#up","text":"\u5c06\u5f53\u524d\u5e27\u5411\u4e0a\u79fb\u52a8\u3002 up [<m>] # \u5c06\u5f53\u524d\u5e27\u5411\u4e0a\u79fb\u52a8<m> up [<m>] <command> # \u5728\u7ed9\u5b9a\u7684\u5e27\u4e0a\u8fd0\u884c\u8be5\u547d\u4ee4","title":"up"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#vars","text":"\u6253\u5370\u5305\u53d8\u91cf\u3002 vars [-v] [<regex>] \u5982\u679c\u6307\u5b9a\u4e86regex\uff0c\u53ea\u6709\u540d\u79f0\u4e0e\u4e4b\u5339\u914d\u7684\u5305\u53d8\u91cf\u624d\u4f1a\u88ab\u8fd4\u56de\u3002\u5982\u679c\u6307\u5b9a\u4e86-v\uff0c\u5c06\u663e\u793a\u5173\u4e8e\u6bcf\u4e2a\u5305\u53d8\u91cf\u7684\u66f4\u591a\u4fe1\u606f\u3002","title":"vars"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#watch","text":"\u8bbe\u7f6e\u89c2\u5bdf\u70b9\u3002 watch [-r|-w|-rw] <expr> -r \u5f53\u5185\u5b58\u4f4d\u7f6e\u88ab\u8bfb\u53d6\u65f6\u505c\u6b62 -w \u5f53\u5185\u5b58\u4f4d\u7f6e\u88ab\u5199\u5165\u65f6\u505c\u6b62 -rw \u5f53\u5185\u5b58\u4f4d\u7f6e\u88ab\u8bfb\u53d6\u6216\u5199\u5165\u65f6\u505c\u6b62 \u5185\u5b58\u4f4d\u7f6e\u662f\u4e0e'print'\u6240\u4f7f\u7528\u7684\u8868\u8fbe\u5f0f\u8bed\u8a00\u4e00\u6837\u6765\u6307\u5b9a\u7684\uff0c\u4f8b\u5982\uff1a watch v \u5c06\u89c2\u5bdf\u53d8\u91cf\u201dv\u201c\u7684\u5730\u5740\u3002 \u53c2\u8003: \"help print\".","title":"watch"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#whatis","text":"\u6253\u5370\u8868\u8fbe\u5f0f\u7684\u7c7b\u578b\u3002 whatis <expression>","title":"whatis"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_11","text":"","title":"\u5e38\u89c1\u95ee\u9898"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#dockerdlv","text":"\u542f\u52a8docker\u5bb9\u5668\u65f6\uff0c\u589e\u52a0\u53c2\u6570 --security-opt=seccomp:unconfined \u3002 \u4f60\u53ef\u4ee5\u50cf\u8fd9\u6837\u5728\u5bb9\u5668\u5185\u542f\u52a8\u4e00\u4e2aDelve\u7684 headless \u5b9e\u4f8b: $ dlv exec --headless --listen :4040 /path/to/executable \u7136\u540e\u4ece\u5bb9\u5668\u5916\u8fde\u63a5\u5230\u5b83: $ dlv connect :4040 \u7a0b\u5e8f\u4e0d\u4f1a\u5f00\u59cb\u6267\u884c\uff0c\u76f4\u5230\u4f60\u8fde\u63a5\u5230Delve\u5e76\u53d1\u9001 continue \u547d\u4ee4\u3002 \u5982\u679c\u4f60\u60f3\u8ba9\u7a0b\u5e8f\u7acb\u5373\u5f00\u59cb\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5411Delve\u4f20\u9012 --continue \u548c --accept-multiclient \u9009\u9879\u6765\u5b9e\u73b0: $ dlv exec --headless --continue --listen :4040 --accept-multiclient /path/to/executable \u6ce8\u610f\uff0c\u4e0eDelve\u7684\u8fde\u63a5\u662f\u672a\u7ecf\u8ba4\u8bc1\u7684\uff0c\u5c06\u5141\u8bb8\u4efb\u610f\u7684\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u3002 \u8bf7\u4e0d\u8981\u5728\u751f\u4ea7\u4e2d\u8fd9\u6837\u505a \u3002","title":"\u5982\u4f55\u5728docker\u4e2d\u4f7f\u7528dlv"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#delvecli","text":"\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u7ec8\u7aef\u4e2d\u8fd0\u884c\u4f60\u7684CLI\u5e94\u7528\u7a0b\u5e8f\uff0c\u7136\u540e\u901a\u8fc7 dlv attach \u8c03\u8bd5\u3002 \u901a\u8fc7 dlv debug --headless \u5728 headless \u6a21\u5f0f\u4e0b\u8fd0\u884cDelve\uff0c\u7136\u540e\u4ece\u53e6\u4e00\u4e2a\u7ec8\u7aef\u8fde\u63a5\u5230\u5b83\u3002\u8fd9\u5c06\u4f7f\u8be5\u8fdb\u7a0b\u5904\u4e8e\u524d\u53f0\uff0c\u5e76\u5141\u8bb8\u5b83\u8bbf\u95ee\u7ec8\u7aefTTY\u3002 \u4e3a\u8fdb\u7a0b\u6307\u5b9a\u5b83\u81ea\u5df1\u7684TTY\u3002\u8fd9\u5728UNIX\u7cfb\u7edf\u4e0a\u53ef\u4ee5\u4f7f\u7528 dlv debug \u548c dlv exec \u547d\u4ee4\u901a\u8fc7 --tty \u6807\u5fd7\u6765\u5b9e\u73b0\u3002\u4e3a\u4e86\u83b7\u5f97\u6700\u597d\u7684\u4f53\u9a8c\uff0c\u4f60\u5e94\u8be5\u521b\u5efa\u4f60\u81ea\u5df1\u7684PTY\u5e76\u5c06\u5176\u6307\u5b9a\u4e3aTTY\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7 ptyme \u5b8c\u6210\u3002","title":"\u5982\u4f55\u4f7f\u7528Delve\u6765\u8c03\u8bd5CLI\u5e94\u7528\u7a0b\u5e8f"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#dlv_1","text":"\u5efa\u8bae\u6700\u597d\u4e0d\u8981\u5728\u516c\u7f51\u4e0a\u4f7f\u7528\u8fdc\u7a0b\u8c03\u8bd5\u3002\u5982\u679c\u4f60\u5fc5\u987b\u8fdc\u7a0b\u8c03\u8bd5\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528ssh\u96a7\u9053\u6216\u8005VPN\u8fde\u63a5\u3002 \u793a\u4f8b \u8fdc\u7a0b\u670d\u52a1\u7aef: $ dlv exec --headless --listen localhost:4040 /path/to/executable \u672c\u5730\u5ba2\u6237\u7aef: 1. \u8fde\u63a5\u5230\u670d\u52a1\u7aef\u5e76\u4e14\u542f\u52a8\u4e00\u4e2a\u672c\u5730\u7aef\u53e3\u8f6c\u53d1 $ ssh -NL 4040 :localhost:4040 user@remote.ip \u8fde\u63a5\u672c\u5730\u7aef\u53e3 $ dlv connect :4040","title":"\u5982\u4f55\u4f7f\u7528dlv\u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5"},{"location":"Golang/Go%E8%AF%AD%E8%A8%80%E8%B0%83%E8%AF%95/#_12","text":"delve usage Command line client Getting Started delve FAQ","title":"\u53c2\u8003\u6587\u7ae0"},{"location":"Golang/runtime/","text":"//go:nosplit //go:noscape //go:linkname timeSleep time.Sleep //go:nowritebarrierrec","title":"Runtime"},{"location":"Golang/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/","text":"\u7f16\u8bd1\u539f\u7406\u57fa\u7840 \u00b6 \u7f16\u8bd1\u8fc7\u7a0b \u00b6 \u8bcd\u6cd5\u5206\u6790 \u00b6 \u8bed\u6cd5\u5206\u6790 \u00b6 \u8bed\u4e49\u5206\u6790 \u00b6 \u4e2d\u95f4\u4ee3\u7801\u751f\u6210\u4e0e\u4f18\u5316 \u00b6 \u673a\u5668\u7801\u751f\u6210 \u00b6 Parser\u573a\u666f\u793a\u4f8b \u00b6","title":"\u7f16\u8bd1\u539f\u7406\u57fa\u7840"},{"location":"Golang/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/#_1","text":"","title":"\u7f16\u8bd1\u539f\u7406\u57fa\u7840"},{"location":"Golang/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/#_2","text":"","title":"\u7f16\u8bd1\u8fc7\u7a0b"},{"location":"Golang/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/#_3","text":"","title":"\u8bcd\u6cd5\u5206\u6790"},{"location":"Golang/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/#_4","text":"","title":"\u8bed\u6cd5\u5206\u6790"},{"location":"Golang/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/#_5","text":"","title":"\u8bed\u4e49\u5206\u6790"},{"location":"Golang/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/#_6","text":"","title":"\u4e2d\u95f4\u4ee3\u7801\u751f\u6210\u4e0e\u4f18\u5316"},{"location":"Golang/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/#_7","text":"","title":"\u673a\u5668\u7801\u751f\u6210"},{"location":"Golang/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/#parser","text":"","title":"Parser\u573a\u666f\u793a\u4f8b"}]}